/* ===== CSS Variables ===== */
/* Alpine-inspired color scheme for ski racing */
/* Optimized for outdoor visibility with high contrast */
:root {
  /* Primary Alpine Blues */
  --primary: #0ea5e9; /* Alpine blue - mountain lake */
  --primary-dark: #0284c7; /* Deeper alpine blue */
  --primary-light: #38bdf8; /* Ice blue - glacier */
  --secondary: #e31837; /* Red - brand accent */
  --secondary-light: #60a5fa; /* Light blue for gradients */
  --accent: #ffffff;

  /* Timing Point Colors */
  --start-color: #f97316; /* Sunset orange for Start */
  --start-color-dark: #ea580c; /* Darker orange */
  --finish-color: #10b981; /* Forest green for Finish */
  --finish-color-dark: #059669; /* Darker green */

  /* Surfaces */
  --background: #0a0a0a; /* Near-black for depth */
  --surface: #141414; /* Slightly lighter for surfaces */
  --surface-elevated: #1e1e1e; /* Elevated surfaces */

  /* Text */
  --text-primary: #ffffff; /* Pure white for max contrast */
  --text-secondary: #d0d0d0; /* Brighter secondary text for outdoor */
  --text-tertiary: #909090; /* Brighter tertiary text for outdoor */

  /* Status Colors */
  --success: #10b981; /* Matches finish color */
  --warning: #fbbf24;
  --error: #ef4444;

  /* GPS Status */
  --gps-active: #10b981;
  --gps-searching: #fbbf24;
  --gps-inactive: #ef4444;

  /* Layout */
  --safe-top: env(safe-area-inset-top);
  --safe-bottom: env(safe-area-inset-bottom);
  --radius: 12px; /* Slightly larger radius for modern feel */
  --radius-sm: 8px; /* Smaller radius for compact elements */
}

/* ===== Reset & Base ===== */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

html {
  height: 100%;
  background: var(--background);
}

body {
  /* Base height with fallbacks for different contexts:
     - 100%: standard fallback
     - -webkit-fill-available: iOS Safari browser with toolbar
     - 100dvh: dynamic viewport height (adjusts with browser chrome)
  */
  height: 100%;
  height: -webkit-fill-available;
  overflow: hidden;
  font-family: "Outfit", -apple-system, sans-serif;
  background: var(--background);
  color: var(--text-primary);
  line-height: 1.5;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Modern viewport units for browsers that support them */
@supports (height: 100dvh) {
  body {
    height: 100dvh; /* Dynamic viewport height - adjusts with browser UI */
  }
}

/* PWA standalone mode - no browser chrome, use large viewport height */
@media all and (display-mode: standalone) {
  body {
    height: 100%;
    height: -webkit-fill-available;
  }

  @supports (height: 100lvh) {
    body {
      height: 100lvh; /* Large viewport height - assumes no browser UI */
    }
  }
}

/* ===== Ripple Effect ===== */
/* Material Design-style ripple synced with haptic feedback */
.ripple-container {
  position: relative;
  overflow: hidden;
}

.ripple {
  position: absolute;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.3);
  transform: scale(0);
  animation: rippleEffect 0.5s ease-out forwards;
  pointer-events: none;
}

.ripple-primary {
  background: rgba(59, 130, 246, 0.4);
}

.ripple-success {
  background: rgba(74, 222, 128, 0.4);
}

.ripple-secondary {
  background: rgba(227, 24, 55, 0.4);
}

@keyframes rippleEffect {
  0% {
    transform: scale(0);
    opacity: 1;
  }
  100% {
    transform: scale(2.5);
    opacity: 0;
  }
}

/* ===== App Container ===== */
/*
 * Do NOT use position: fixed - it breaks iOS PWA viewport sizing.
 * Instead, use height: 100% to inherit from body which has proper viewport units.
 * Note: bottom safe area is on tab-bar so its background fills the safe area.
 */
.app {
  display: flex;
  flex-direction: column;
  height: 100%;
  max-width: 430px;
  margin: 0 auto;
  padding-top: env(safe-area-inset-top, 0px);
  background: var(--background);
}

/* ===== Main Content ===== */
#main {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  position: relative;
}

/* ===== Header ===== */
.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 4px 16px;
  background: var(--surface);
  border-bottom: 1px solid var(--surface-elevated);
}

.header-title {
  font-size: 1.125rem;
  font-weight: 600;
}

.header-status {
  display: flex;
  align-items: center;
  gap: 6px;
  flex-shrink: 0;
  max-width: 50%;
}

.sync-indicator {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 6px 10px;
  background: transparent;
  border: none;
  border-radius: var(--radius);
  font-size: 0.8rem;
  font-weight: 600;
}

.sync-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: var(--text-tertiary);
}

.sync-dot.connected {
  background: var(--success);
  box-shadow:
    0 0 8px var(--success),
    0 0 16px rgba(74, 222, 128, 0.4);
}

.sync-dot.error {
  background: var(--error);
}

.sync-dot.offline {
  background: var(--warning);
}

.sync-dot.syncing {
  background: var(--primary);
  animation: syncPulse 1s ease-in-out infinite;
}

@keyframes syncPulse {
  0%,
  100% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(1.3);
    opacity: 0.7;
  }
}

.sync-device-count {
  font-size: 0.7rem;
  font-weight: 600;
  color: var(--text-secondary);
  margin-left: 2px;
}

/* Judges Ready Indicator */
.judges-ready-indicator {
  display: flex;
  align-items: center;
  gap: 3px;
  margin-left: 6px;
  padding: 2px 6px;
  background: rgba(34, 197, 94, 0.15);
  border-radius: var(--radius);
  color: var(--success);
}

.judges-ready-indicator svg {
  flex-shrink: 0;
}

.judges-ready-count {
  font-size: 0.75rem;
  font-weight: 600;
  font-family: "JetBrains Mono", monospace;
}

.judges-ready-indicator.all-ready {
  background: var(--success);
  color: white;
  animation: pulse-ready 1s ease-in-out;
}

@keyframes pulse-ready {
  0%,
  100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.05);
  }
}

/* Individual Judge Ready Indicator (shown in gate judge mode instead of GPS) */
.judge-ready-indicator {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 3px 8px;
  border-radius: var(--radius);
  font-size: 0.75rem;
  font-weight: 600;
  background: rgba(0, 0, 0, 0.3);
  white-space: nowrap;
}

.judge-ready-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: var(--error);
  animation: pulse 2s infinite;
  flex-shrink: 0;
}

.judge-ready-text {
  font-weight: 600;
  color: var(--text-secondary);
}

/* None ready - red */
.judge-ready-indicator.none-ready .judge-ready-dot {
  background: var(--error);
  box-shadow: 0 0 8px var(--error);
}

/* Some ready - yellow */
.judge-ready-indicator.some-ready .judge-ready-dot {
  background: var(--warning);
  box-shadow: 0 0 8px var(--warning);
}

/* All ready - green */
.judge-ready-indicator.all-ready .judge-ready-dot {
  background: var(--success);
  box-shadow: 0 0 8px var(--success);
}

.judge-ready-indicator.all-ready .judge-ready-text {
  color: var(--success);
}

.entry-count-badge {
  padding: 4px 10px;
  background: linear-gradient(
    135deg,
    rgba(249, 115, 22, 0.85) 0%,
    rgba(234, 88, 12, 0.75) 100%
  );
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  color: white;
  border-radius: var(--radius);
  font-size: 0.85rem;
  font-weight: 700;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
  border: 1px solid rgba(255, 255, 255, 0.2);
  box-shadow:
    0 0 12px rgba(249, 115, 22, 0.4),
    0 2px 8px rgba(0, 0, 0, 0.2);
}

/* ===== Views ===== */
.view {
  display: none !important;
  flex-direction: column;
  flex: 1;
  overflow: hidden;
}

.view.active {
  display: flex !important;
}

/* ===== Tab Bar ===== */
.tab-bar {
  display: flex;
  background: var(--surface);
  border-top: 1px solid var(--surface-elevated);
  flex-shrink: 0;
  /* Safe area padding so tab bar background fills the bottom safe area */
  padding-bottom: env(safe-area-inset-bottom, 0px);
}

.tab-btn {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
  padding: 6px 8px 4px;
  border: none;
  background: transparent;
  color: var(--text-tertiary);
  font-size: 0.7rem;
  cursor: pointer;
  transition:
    color 0.25s cubic-bezier(0.4, 0, 0.2, 1),
    transform 0.15s ease;
  position: relative;
}

.tab-btn svg {
  width: 20px;
  height: 20px;
}

.tab-btn::after {
  content: "";
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%) scaleX(0);
  width: 40px;
  height: 3px;
  background: var(--primary);
  border-radius: 0 0 2px 2px;
  transition: transform 0.25s cubic-bezier(0.4, 0, 0.2, 1);
}

.tab-btn:active {
  transform: scale(0.95);
}

.tab-btn.active {
  color: var(--primary);
}

.tab-btn.active::after {
  transform: translateX(-50%) scaleX(1);
}

.tab-btn svg {
  width: 24px;
  height: 24px;
  transition: transform 0.2s ease;
}

.tab-btn.active svg {
  transform: scale(1.05);
}

/* Gate Judge mode tab reordering - Gate tab first, then Results, then Settings */
.tab-bar.gate-judge-mode #gate-judge-tab {
  order: 1;
}

.tab-bar.gate-judge-mode [data-view="results"] {
  order: 2;
}

.tab-bar.gate-judge-mode [data-view="settings"] {
  order: 3;
}

.tab-bar.gate-judge-mode #timer-tab {
  order: 4;
}

/* ===== GPS Indicator ===== */
.gps-indicator {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 6px 10px;
  background: transparent;
  border: none;
  border-radius: var(--radius);
  font-size: 0.8rem;
  font-weight: 600;
}

.gps-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: var(--gps-inactive);
}

.gps-dot.active {
  background: var(--gps-active);
  animation: gpsPulse 2s ease-in-out infinite;
  box-shadow:
    0 0 8px var(--gps-active),
    0 0 16px rgba(74, 222, 128, 0.4);
}

.gps-dot.searching {
  background: var(--gps-searching);
  animation: gpsPulse 1s ease-in-out infinite;
}

.gps-dot.paused {
  background: var(--gps-active);
  /* No animation - indicates GPS is enabled but paused (not on timer view) */
}

@keyframes gpsPulse {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
}

/* ===== Camera Indicator ===== */
.camera-indicator {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 4px;
  color: var(--primary);
  opacity: 0.9;
}

.camera-indicator svg {
  display: block;
}

/* ===== Voice Mode Indicator ===== */
.voice-indicator {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 4px 8px;
  border-radius: var(--radius);
  font-size: 0.7rem;
  font-weight: 600;
  background: rgba(0, 0, 0, 0.3);
  white-space: nowrap;
}

.voice-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--text-tertiary);
  flex-shrink: 0;
}

.voice-status-text {
  color: var(--text-secondary);
}

/* Listening - green pulsing */
.voice-indicator.listening .voice-dot {
  background: var(--success);
  box-shadow: 0 0 8px var(--success);
  animation: voicePulse 1.5s ease-in-out infinite;
}

.voice-indicator.listening .voice-status-text {
  color: var(--success);
}

/* Processing - yellow */
.voice-indicator.processing .voice-dot {
  background: var(--warning);
  box-shadow: 0 0 8px var(--warning);
  animation: voicePulse 0.5s ease-in-out infinite;
}

.voice-indicator.processing .voice-status-text {
  color: var(--warning);
}

/* Confirming - blue */
.voice-indicator.confirming .voice-dot {
  background: var(--primary);
  box-shadow: 0 0 8px var(--primary);
  animation: voicePulse 1s ease-in-out infinite;
}

.voice-indicator.confirming .voice-status-text {
  color: var(--primary);
}

/* Offline - red */
.voice-indicator.offline .voice-dot {
  background: var(--error);
  box-shadow: 0 0 8px var(--error);
}

.voice-indicator.offline .voice-status-text {
  color: var(--error);
}

/* Error - red */
.voice-indicator.error .voice-dot {
  background: var(--error);
  box-shadow: 0 0 8px var(--error);
}

.voice-indicator.error .voice-status-text {
  color: var(--error);
}

@keyframes voicePulse {
  0%,
  100% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(1.3);
    opacity: 0.7;
  }
}

/* ===== Empty State ===== */
.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 48px 24px;
  color: var(--text-secondary);
  text-align: center;
}

.empty-state svg {
  opacity: 0.5;
  margin-bottom: 16px;
}

.empty-state .empty-icon {
  font-size: 2.5rem;
  margin-bottom: 12px;
  opacity: 0.4;
  filter: grayscale(0.3);
}

.empty-state .empty-subtitle {
  font-size: 0.8rem;
  color: var(--text-tertiary);
  margin-top: 4px;
}

/* Snowflake loading indicator */
.snowflake-loading {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 12px;
  padding: 32px 24px;
  color: var(--text-secondary);
}

.snowflake-loading .loading-text {
  font-size: 0.875rem;
  color: var(--text-tertiary);
}

/* ===== Accessibility ===== */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

.skip-link {
  position: absolute;
  top: -100%;
  left: 0;
  padding: 12px 16px;
  background: var(--primary);
  color: white;
  z-index: 10000;
  transition: top 0.2s;
}

.skip-link:focus {
  top: 0;
}

/* ===== Responsive ===== */
@media (max-height: 700px) {
  .timer-view {
    gap: 4px;
    padding: 8px;
  }

  .clock-container {
    padding: 2px 0;
  }

  .number-pad {
    gap: 5px;
  }

  .num-btn {
    font-size: 1.25rem;
    font-weight: 700;
  }

  .timestamp-btn {
    padding: 25px 20px;
    font-size: 2rem;
  }

  .bib-display {
    padding: 6px 12px;
  }

  .bib-value {
    font-size: 2.5rem;
  }

  .timing-point-btn {
    padding: 10px 8px;
  }
}

@media (max-height: 600px) {
  .timer-view {
    gap: 3px;
    padding: 6px;
  }

  .number-pad {
    gap: 4px;
  }

  .num-btn {
    font-size: 1.125rem;
    font-weight: 700;
  }

  .timestamp-btn {
    padding: 20px 16px;
    font-size: 1.75rem;
  }
}

/* ===== Landscape Mode ===== */
@media (orientation: landscape) {
  /* Remove max-width constraint and add side safe areas for notch */
  .app {
    max-width: 100%;
    padding-left: env(safe-area-inset-left, 0px);
    padding-right: env(safe-area-inset-right, 0px);
  }

  /* Timer View - CSS Grid two-column layout */
  /* Left: bib (large) + numpad | Right: clock + controls + last + timestamp */
  .timer-view.active {
    display: grid !important;
    grid-template-columns: 40% 1fr;
    grid-template-rows: auto auto auto 1fr;
    grid-template-areas:
      "bib        clock"
      "bib        controls"
      "numpad     last"
      "numpad     timestamp";
    padding: 8px 20px 24px;
    gap: 8px 20px;
    align-items: stretch;
  }

  /* Left column: Large bib display (same styling as portrait) */
  .timer-view .bib-display {
    grid-area: bib;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin: 0;
    padding: 12px;
    background: var(--background);
    border-radius: var(--radius);
    border: 1px solid var(--surface-elevated);
  }

  .timer-view .bib-label {
    font-size: 0.875rem;
    margin-bottom: 4px;
  }

  .timer-view .bib-value {
    font-size: clamp(2.5rem, 8vw, 4rem);
    min-width: auto;
    letter-spacing: 0.05em;
  }

  /* Left column: Number pad */
  .timer-view .number-pad {
    grid-area: numpad;
    max-height: none;
    gap: 4px;
    align-self: stretch;
  }

  .timer-view .num-btn {
    font-size: clamp(0.875rem, 2.5vw, 1.25rem);
  }

  /* Right column: Clock container with time, date, and timing controls */
  .timer-view .clock-container {
    grid-area: clock;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .timer-view .clock-container .clock-time {
    font-size: clamp(1.75rem, 6vw, 3rem) !important;
  }

  .timer-view .clock-container .clock-date-row {
    flex-wrap: wrap;
    justify-content: space-evenly !important;
    gap: 12px;
    margin-top: 4px;
  }

  .timer-view .timing-controls {
    grid-area: controls;
    display: flex !important;
    flex-direction: row !important;
    justify-content: center;
    align-items: center;
    gap: 8px;
  }

  .timer-view .timing-point-btn {
    max-width: 60px;
    min-height: 44px;
    padding: 5px 8px;
    font-size: 0.75rem;
  }

  .timer-view .run-btn {
    max-width: 44px;
    min-height: 44px;
    padding: 4px 6px;
    font-size: 0.7rem;
  }

  /* Right column: Large timestamp button */
  .timer-view .timestamp-btn {
    grid-area: timestamp;
    min-height: unset;
    padding: 16px;
    font-size: clamp(1.5rem, 5vw, 2.5rem);
    border-radius: 48px;
    align-self: stretch;
  }

  /* Right column: Last recorded (between clock and timestamp) */
  .timer-view .last-recorded {
    grid-area: last;
    justify-content: center;
    padding: 8px 16px;
    margin: 4px 0;
    font-size: 0.875rem;
    align-self: center;
    background: var(--surface);
    border-radius: var(--radius);
  }

  /* Settings View - better use of width */
  .settings-view {
    padding: 8px 24px;
  }

  .settings-content {
    max-width: 600px;
    margin: 0 auto;
  }

  /* Header adjustments - more compact in landscape */
  .header {
    padding: 2px 12px;
    padding-left: max(12px, env(safe-area-inset-left, 0px));
    padding-right: max(12px, env(safe-area-inset-right, 0px));
  }

  .header h1 {
    font-size: 1rem;
  }

  .header-status {
    font-size: 0.7rem;
  }

  /* Tab bar adjustments for landscape - more compact */
  .tab-bar {
    padding-left: max(8px, env(safe-area-inset-left, 0px));
    padding-right: max(8px, env(safe-area-inset-right, 0px));
    padding-bottom: env(safe-area-inset-bottom, 0px);
  }

  .tab-btn {
    padding: 6px 12px 4px;
    font-size: 0.7rem;
    min-height: 40px;
  }

  .tab-btn svg {
    width: 18px;
    height: 18px;
  }

  /* Modal adjustments for landscape */
  .modal-content {
    max-width: 500px;
    max-height: 85vh;
  }
}

/* Landscape with very short height (phones) */
@media (orientation: landscape) and (max-height: 500px) {
  .timer-view.active {
    padding: 4px 10px 10px;
    gap: 6px 12px;
  }

  .timer-view .bib-display {
    padding: 6px;
  }

  .timer-view .bib-value {
    font-size: clamp(1.75rem, 6vw, 2.5rem);
  }

  .timer-view .bib-label {
    font-size: 0.75rem;
    margin-bottom: 2px;
  }

  .timer-view .clock-container .clock-time {
    font-size: clamp(1.25rem, 4vw, 2rem) !important;
  }

  .timer-view .clock-container .clock-date-row {
    gap: 6px;
  }

  .timer-view .clock-container .clock-date {
    font-size: 0.7rem !important;
  }

  .timer-view .timing-controls {
    gap: 6px;
    margin-top: 2px;
  }

  .timer-view .timing-point-btn {
    padding: 3px 6px;
    font-size: 0.7rem;
    max-width: 50px;
    min-height: 44px;
  }

  .timer-view .run-btn {
    padding: 2px 4px;
    font-size: 0.65rem;
    max-width: 44px;
    min-height: 44px;
  }

  .timer-view .number-pad {
    gap: 2px;
  }

  .timer-view .num-btn {
    font-size: 0.8rem;
  }

  .timer-view .timestamp-btn {
    padding: 10px;
    font-size: clamp(1rem, 3.5vw, 1.75rem);
    border-radius: 32px;
  }

  .timer-view .last-recorded {
    padding: 3px 6px;
    font-size: 0.65rem;
  }

  .header {
    padding: 2px 12px;
    padding-left: max(12px, env(safe-area-inset-left, 0px));
    padding-right: max(12px, env(safe-area-inset-right, 0px));
  }

  .tab-bar {
    padding-left: max(12px, env(safe-area-inset-left, 0px));
    padding-right: max(12px, env(safe-area-inset-right, 0px));
    padding-bottom: env(safe-area-inset-bottom, 0px);
  }

  .tab-btn {
    padding: 6px 10px 4px;
    font-size: 0.7rem;
    min-height: 40px;
    gap: 1px;
  }

  .tab-btn svg {
    width: 16px;
    height: 16px;
  }

  /* Settings more compact */
  .setting-row {
    padding: 6px 0;
  }

  .setting-title {
    font-size: 0.85rem;
  }

  .setting-description {
    font-size: 0.7rem;
  }

  /* Timer View: Ensure number pad shows all 4 rows */
  .timer-view .number-pad {
    min-height: 120px; /* Minimum space for 4 rows of buttons */
    grid-template-rows: repeat(4, minmax(28px, 1fr));
  }
}

/* ===== Print Styles ===== */
@media print {
  .tab-bar,
  .header,
  .action-btn,
  .modal-overlay {
    display: none !important;
  }

  .results-list {
    overflow: visible;
  }

  body {
    background: white;
    color: black;
  }
}

/* ===== Liquid Glass UI Enhancements ===== */
/* These enhance existing elements with glassmorphism effects */

/* Timestamp Button Glass Enhancement */
.timestamp-btn.glass-surface-1 {
  background: linear-gradient(
    var(--glass-gradient-angle, 135deg),
    var(--primary) 0%,
    var(--primary-light) 50%,
    var(--primary-dark) 100%
  );
  border: 2px solid rgba(255, 255, 255, 0.2);
  box-shadow:
    0 0 40px rgba(14, 165, 233, 0.5),
    0 0 80px rgba(14, 165, 233, 0.25),
    0 8px 32px rgba(0, 0, 0, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.3);
  position: relative;
  overflow: hidden;
}

.timestamp-btn.glass-surface-1::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: radial-gradient(
    ellipse at calc(50% + var(--motion-tilt-x, 0) * 30%)
      calc(30% + var(--motion-tilt-y, 0) * 20%),
    rgba(255, 255, 255, 0.3) 0%,
    transparent 50%
  );
  pointer-events: none;
  z-index: 1;
}

.timestamp-btn.glass-surface-1 span {
  position: relative;
  z-index: 2;
}

/* Header Glass Enhancement - matches bib display style */
.header.glass-frosted-top {
  background: linear-gradient(
    135deg,
    rgba(255, 255, 255, 0.06) 0%,
    rgba(255, 255, 255, 0.02) 100%
  );
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

/* Tab Bar Glass Enhancement */
.tab-bar.glass-frosted {
  background: linear-gradient(
    180deg,
    rgba(20, 20, 20, 0.85) 0%,
    rgba(20, 20, 20, 0.95) 100%
  );
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border-top: 1px solid rgba(255, 255, 255, 0.08);
  position: relative;
}

/* Number Pad Glass Enhancement - lighter than bib display */
.num-btn.glass-surface-3 {
  background: linear-gradient(
    var(--glass-gradient-angle, 135deg),
    rgba(255, 255, 255, 0.12) 0%,
    rgba(255, 255, 255, 0.06) 100%
  );
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  box-shadow:
    0 2px 8px rgba(0, 0, 0, 0.2),
    inset 0 1px 0 rgba(255, 255, 255, 0.15);
}

.num-btn.glass-surface-3:active {
  background: rgba(255, 255, 255, 0.18);
  box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
}

/* Modal Glass Enhancement */
.modal-content.glass-surface-1 {
  background: linear-gradient(
    var(--glass-gradient-angle, 135deg),
    rgba(25, 25, 25, 0.92) 0%,
    rgba(20, 20, 20, 0.88) 100%
  );
  backdrop-filter: blur(24px);
  -webkit-backdrop-filter: blur(24px);
  border: 1px solid rgba(255, 255, 255, 0.12);
  box-shadow:
    0 8px 32px rgba(0, 0, 0, 0.4),
    0 0 0 1px rgba(255, 255, 255, 0.05) inset;
}

/* Confirmation Overlay Glass Enhancement */
.confirmation-overlay.glass-surface-1 .confirmation-content {
  background: linear-gradient(
    var(--glass-gradient-angle, 135deg),
    rgba(10, 10, 10, 0.92) 0%,
    rgba(15, 15, 15, 0.88) 100%
  );
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 4px solid rgba(255, 255, 255, 0.18);
  box-shadow:
    0 8px 32px rgba(0, 0, 0, 0.5),
    0 0 0 1px rgba(255, 255, 255, 0.08) inset;
}

/* Setting Row Glass Enhancement */
.setting-row.glass-surface-3 {
  background: transparent;
  border-radius: var(--radius);
  transition:
    background 0.3s ease,
    box-shadow 0.3s ease;
}

.setting-row.glass-surface-3:hover {
  background: rgba(255, 255, 255, 0.03);
}

/* Timing Point Buttons Glass Enhancement */
.timing-point-btn.glass-surface-3 {
  background: linear-gradient(
    135deg,
    rgba(255, 255, 255, 0.06) 0%,
    rgba(255, 255, 255, 0.02) 100%
  );
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border: 2px solid rgba(255, 255, 255, 0.08);
}

/* Start button - Orange glow */
.timing-point-btn.glass-surface-3[data-point="S"] {
  border-color: rgba(249, 115, 22, 0.2);
}

.timing-point-btn.glass-surface-3.active[data-point="S"] {
  background: linear-gradient(
    135deg,
    var(--start-color) 0%,
    var(--start-color-dark) 100%
  );
  border-color: var(--start-color);
  box-shadow:
    0 0 25px rgba(249, 115, 22, 0.5),
    0 0 50px rgba(249, 115, 22, 0.25),
    0 4px 12px rgba(0, 0, 0, 0.3);
}

/* Finish button - Green glow */
.timing-point-btn.glass-surface-3[data-point="F"] {
  border-color: rgba(16, 185, 129, 0.2);
}

.timing-point-btn.glass-surface-3.active[data-point="F"] {
  background: linear-gradient(
    135deg,
    var(--finish-color) 0%,
    var(--finish-color-dark) 100%
  );
  border-color: var(--finish-color);
  box-shadow:
    0 0 25px rgba(16, 185, 129, 0.5),
    0 0 50px rgba(16, 185, 129, 0.25),
    0 4px 12px rgba(0, 0, 0, 0.3);
}

/* Run Buttons Glass Enhancement */
.run-btn.glass-surface-3 {
  background: linear-gradient(
    135deg,
    rgba(255, 255, 255, 0.08) 0%,
    rgba(255, 255, 255, 0.04) 100%
  );
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: var(--text-primary);
}

/* Run buttons - Alpine blue glow */
.run-btn.glass-surface-3.active {
  background: linear-gradient(
    135deg,
    rgba(37, 99, 235, 0.85) 0%,
    rgba(14, 165, 233, 0.6) 100%
  );
  border-color: rgba(147, 197, 253, 0.9);
  color: #fff;
  box-shadow: 0 0 18px rgba(59, 130, 246, 0.55);
}

/* Clock Container Subtle Enhancement */
.clock-container.glass-enabled {
  position: relative;
}

/* Results Header Glass Enhancement */
.results-header.glass-frosted-top {
  background: linear-gradient(
    180deg,
    rgba(20, 20, 20, 0.95) 0%,
    rgba(20, 20, 20, 0.85) 100%
  );
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border-bottom: 1px solid rgba(255, 255, 255, 0.06);
}

/* Results Actions Glass Enhancement */
.results-actions.glass-frosted {
  background: linear-gradient(
    0deg,
    rgba(20, 20, 20, 0.95) 0%,
    rgba(20, 20, 20, 0.85) 100%
  );
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border-top: 1px solid rgba(255, 255, 255, 0.06);
}

/* Bib Display Glass Enhancement */
.bib-display.glass-surface-2 {
  background: linear-gradient(
    135deg,
    rgba(255, 255, 255, 0.06) 0%,
    rgba(255, 255, 255, 0.02) 100%
  );
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: var(--radius);
}

/* ===== Ambient Mode ===== */
/* Battery-saving, ultra-minimal UI for inactive timer view */

/* Hide all UI except clock when ambient mode is active */
body.ambient-mode .timer-view .timing-controls,
body.ambient-mode .timer-view .bib-entry-section,
body.ambient-mode .timer-view .number-pad,
body.ambient-mode .header,
body.ambient-mode .tab-bar {
  display: none !important;
}

/* Pure black OLED-friendly background */
body.ambient-mode .timer-view {
  background: #000000;
  justify-content: center;
  align-items: center;
}

/* Larger clock in ambient mode */
body.ambient-mode .timer-view .clock-container {
  padding: 0;
  background: transparent;
}

body.ambient-mode .timer-view .clock-time {
  font-size: clamp(48px, 15vw, 80px) !important;
  color: rgba(255, 255, 255, 0.85);
}

/* Hide date row in ambient mode - just show time */
body.ambient-mode .timer-view .clock-date-row {
  display: none !important;
}

/* Giant invisible tap target covering entire screen */
body.ambient-mode .timer-view .timestamp-btn {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
  z-index: 100;
  border-radius: 0;
  min-height: unset;
}

/* Subtle pulse indicator at bottom */
body.ambient-mode .timer-view::after {
  content: "";
  position: fixed;
  bottom: 40px;
  left: 50%;
  transform: translateX(-50%);
  width: 60px;
  height: 4px;
  border-radius: 2px;
  background: rgba(255, 255, 255, 0.15);
  animation: ambientPulse 3s ease-in-out infinite;
}

@keyframes ambientPulse {
  0%,
  100% {
    opacity: 0.3;
  }
  50% {
    opacity: 0.8;
  }
}

/* Ensure ambient mode fills the entire screen */
body.ambient-mode .app {
  background: #000000;
}

body.ambient-mode #main {
  background: #000000;
}

/* ===== Power Saver: Stop infinite animations to save GPU ===== */
.power-saver .sync-dot.syncing,
.power-saver .gps-dot.searching,
.power-saver .gps-dot.active,
.power-saver .voice-indicator.listening .voice-dot,
.power-saver .voice-indicator.processing .voice-dot,
.power-saver .voice-indicator.confirming .voice-dot,
.power-saver .ambient-touch-indicator {
  animation: none;
}
