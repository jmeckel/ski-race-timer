<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0A0E14">
    <meta name="description" content="GPS-synchronized ski race timing application">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ski Timer">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32.png">
    <title>Ski Race Timer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Outfit:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00D4FF;
            --primary-dark: #0099CC;
            --secondary: #FF6B35;
            --secondary-light: #FF8F5E;
            --accent: #7CFF6B;
            --background: #0A0E14;
            --surface: #151B23;
            --surface-elevated: #1E2732;
            --text-primary: #FFFFFF;
            --text-secondary: #8B9AAB;
            --text-tertiary: #5A6673;
            --success: #4ADE80;
            --warning: #FBBF24;
            --error: #EF4444;
            --gps-active: #4ADE80;
            --gps-searching: #FBBF24;
            --gps-inactive: #EF4444;
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        html, body { 
            height: 100%; 
            overflow: hidden;
            position: fixed;
            width: 100%;
        }
        body { 
            font-family: 'Outfit', -apple-system, sans-serif; 
            background: var(--background); 
            color: var(--text-primary);
        }
        .app-container { 
            max-width: 430px; 
            margin: 0 auto; 
            height: 100%;
            display: flex; 
            flex-direction: column; 
            background: linear-gradient(135deg, var(--background) 0%, rgba(21, 27, 35, 0.5) 50%, var(--background) 100%);
            padding-top: var(--safe-top);
            padding-bottom: var(--safe-bottom);
        }
        .tab-bar { 
            display: flex; 
            background: var(--surface); 
            border-top: 1px solid var(--surface-elevated); 
            padding: 6px 0;
            flex-shrink: 0;
        }
        .tab-item { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 2px; padding: 6px; background: none; border: none; color: var(--text-tertiary); cursor: pointer; transition: color 0.2s; }
        .tab-item svg { width: 22px; height: 22px; }
        .tab-item span { font-size: 10px; font-weight: 500; }
        .tab-item.active { color: var(--primary); }
        .view { display: none; flex: 1; min-height: 0; overflow: hidden; }
        .view.active { display: flex; flex-direction: column; }
        
        /* Timing View - uses flexbox to distribute space */
        #timing-view {
            padding: 2vmin;
            gap: 1.5vmin;
        }
        .timing-header { 
            display: flex; 
            align-items: center; 
            justify-content: space-between;
            flex-shrink: 0;
        }
        .gps-indicator { 
            display: flex; 
            align-items: center; 
            gap: 6px; 
            padding: 6px 10px; 
            background: var(--surface); 
            border-radius: 16px; 
            font-size: 11px; 
            font-weight: 500; 
        }
        .gps-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--gps-active); box-shadow: 0 0 6px var(--gps-active); animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        .clock-display { 
            text-align: center;
            flex-shrink: 0;
        }
        .clock-time { 
            font-family: 'JetBrains Mono', monospace; 
            font-size: clamp(32px, 10vw, 48px); 
            font-weight: 700; 
            letter-spacing: -1px; 
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--primary) 100%); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            background-clip: text;
            line-height: 1.1;
        }
        .clock-date { font-size: 11px; color: var(--text-secondary); margin-top: 2px; }
        
        .bib-section { 
            flex-shrink: 0;
        }
        .bib-label { font-size: 10px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px; }
        .bib-display { 
            font-family: 'JetBrains Mono', monospace; 
            font-size: clamp(28px, 9vw, 40px); 
            font-weight: 700; 
            color: var(--text-primary); 
            background: var(--surface); 
            border-radius: 10px; 
            padding: 10px 16px; 
            text-align: center;
        }
        .bib-display.empty { color: var(--text-tertiary); }
        
        .timing-points { 
            display: flex; 
            gap: 6px;
            flex-shrink: 0;
        }
        .timing-point { 
            flex: 1; 
            padding: 8px 4px; 
            background: var(--surface); 
            border: 2px solid transparent; 
            border-radius: 10px; 
            color: var(--text-secondary); 
            font-weight: 600; 
            font-size: 13px; 
            cursor: pointer; 
            transition: all 0.2s; 
            text-align: center; 
        }
        .timing-point.active { background: rgba(0, 212, 255, 0.1); border-color: var(--primary); color: var(--primary); }
        .timing-point.start { background: rgba(74, 222, 128, 0.1); border-color: var(--success); color: var(--success); }
        .timing-point.finish { background: rgba(255, 107, 53, 0.1); border-color: var(--secondary); color: var(--secondary); }
        
        .number-pad { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 6px;
            flex: 1;
            min-height: 0;
        }
        .num-btn { 
            background: var(--surface); 
            border: none; 
            border-radius: 10px; 
            color: var(--text-primary); 
            font-size: clamp(20px, 6vw, 28px); 
            font-weight: 600; 
            cursor: pointer; 
            transition: all 0.15s; 
            display: flex; 
            align-items: center; 
            justify-content: center;
        }
        .num-btn:active { background: var(--surface-elevated); transform: scale(0.95); }
        .num-btn.delete { background: rgba(239, 68, 68, 0.2); color: var(--error); }
        .num-btn.clear { font-size: 14px; color: var(--text-secondary); }
        
        .timestamp-btn { 
            padding: 14px; 
            background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-light) 100%); 
            border: none; 
            border-radius: 12px; 
            color: white; 
            font-size: clamp(16px, 5vw, 22px); 
            font-weight: 800; 
            text-transform: uppercase; 
            letter-spacing: 2px; 
            cursor: pointer; 
            transition: all 0.15s; 
            box-shadow: 0 6px 24px rgba(255, 107, 53, 0.4);
            flex-shrink: 0;
        }
        .timestamp-btn:active { transform: scale(0.98); box-shadow: 0 3px 12px rgba(255, 107, 53, 0.4); }
        
        /* Results View */
        #results-view {
            padding: 2vmin;
            gap: 2vmin;
        }
        .results-header { display: flex; align-items: center; justify-content: space-between; flex-shrink: 0; }
        .results-title { font-size: 22px; font-weight: 700; }
        .results-actions { display: flex; gap: 6px; }
        .action-btn { padding: 6px 12px; background: var(--surface); border: none; border-radius: 6px; color: var(--text-secondary); font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.2s; }
        .action-btn:hover { background: var(--surface-elevated); color: var(--text-primary); }
        .action-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .action-btn.danger { color: var(--error); }
        .results-stats { display: flex; gap: 8px; flex-shrink: 0; }
        .stat-card { flex: 1; padding: 10px; background: var(--surface); border-radius: 10px; text-align: center; }
        .stat-value { font-size: 20px; font-weight: 700; color: var(--primary); }
        .stat-label { font-size: 9px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; margin-top: 2px; }
        .results-list { flex: 1; overflow-y: auto; min-height: 0; -webkit-overflow-scrolling: touch; }
        .result-item { display: flex; align-items: center; gap: 10px; padding: 10px; background: var(--surface); border-radius: 10px; margin-bottom: 6px; }
        .result-checkbox { width: 22px; height: 22px; border: 2px solid var(--text-tertiary); border-radius: 5px; cursor: pointer; display: none; align-items: center; justify-content: center; flex-shrink: 0; }
        .result-checkbox.checked { background: var(--primary); border-color: var(--primary); }
        .result-checkbox.checked::after { content: '✓'; color: var(--background); font-weight: bold; font-size: 12px; }
        .select-mode .result-checkbox { display: flex; }
        .result-bib { font-family: 'JetBrains Mono', monospace; font-size: 16px; font-weight: 700; min-width: 50px; cursor: pointer; }
        .result-point { padding: 3px 6px; border-radius: 5px; font-size: 11px; font-weight: 600; flex-shrink: 0; }
        .result-info { flex: 1; min-width: 0; }
        .result-time { font-family: 'JetBrains Mono', monospace; font-size: 14px; font-weight: 600; }
        .result-date { font-size: 11px; color: var(--text-secondary); }
        .result-delete { padding: 6px; background: none; border: none; color: var(--text-tertiary); cursor: pointer; border-radius: 6px; transition: all 0.2s; flex-shrink: 0; }
        .result-delete:hover { background: rgba(239, 68, 68, 0.2); color: var(--error); }
        .select-mode .result-delete { display: none; }
        .empty-state { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 32px; text-align: center; }
        .empty-icon { width: 48px; height: 48px; color: var(--text-tertiary); margin-bottom: 12px; }
        .empty-title { font-size: 16px; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px; }
        .empty-text { font-size: 13px; color: var(--text-tertiary); }
        
        /* Settings View */
        #settings-view {
            padding: 2vmin;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        .settings-header { margin-bottom: 12px; flex-shrink: 0; }
        .settings-title { font-size: 22px; font-weight: 700; }
        .settings-section { margin-bottom: 16px; }
        .settings-section-title { font-size: 10px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }
        .settings-card { background: var(--surface); border-radius: 10px; overflow: hidden; }
        .settings-row { display: flex; align-items: center; padding: 12px; border-bottom: 1px solid var(--surface-elevated); }
        .settings-row:last-child { border-bottom: none; }
        .settings-row-icon { width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; margin-right: 10px; flex-shrink: 0; }
        .settings-row-icon svg { width: 18px; height: 18px; }
        .settings-row-label { flex: 1; font-size: 14px; }
        .settings-row-value { font-size: 13px; color: var(--text-secondary); }
        .toggle { width: 44px; height: 26px; background: var(--surface-elevated); border-radius: 13px; position: relative; cursor: pointer; transition: all 0.3s; flex-shrink: 0; }
        .toggle::after { content: ''; position: absolute; width: 22px; height: 22px; background: var(--text-secondary); border-radius: 50%; top: 2px; left: 2px; transition: all 0.3s; }
        .toggle.on { background: var(--primary); }
        .toggle.on::after { left: 20px; background: white; }
        .lang-toggle { padding: 6px 12px; background: var(--surface-elevated); border: none; border-radius: 6px; color: var(--text-primary); font-size: 13px; font-weight: 600; cursor: pointer; }
        .about-card { padding: 16px; text-align: center; }
        .about-icon { width: 48px; height: 48px; margin: 0 auto 12px; color: var(--primary); }
        .about-icon svg { width: 100%; height: 100%; }
        .about-title { font-size: 20px; font-weight: 700; margin-bottom: 2px; }
        .about-subtitle { font-size: 12px; color: var(--text-secondary); margin-bottom: 16px; }
        .about-features { display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px; }
        .about-feature { display: flex; align-items: center; gap: 10px; font-size: 12px; color: var(--text-secondary); }
        .about-feature svg { width: 16px; height: 16px; color: var(--primary); flex-shrink: 0; }
        .about-version { font-size: 11px; color: var(--text-tertiary); }
        
        /* Overlays */
        .confirmation-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(10, 14, 20, 0.9); display: none; align-items: center; justify-content: center; z-index: 200; }
        .confirmation-overlay.show { display: flex; }
        .confirmation-card { background: var(--surface); border-radius: 20px; padding: 24px; text-align: center; animation: scaleIn 0.3s ease; }
        @keyframes scaleIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .confirmation-icon { width: 48px; height: 48px; color: var(--success); margin-bottom: 12px; }
        .confirmation-bib { font-family: 'JetBrains Mono', monospace; font-size: 26px; font-weight: 700; margin-bottom: 6px; }
        .confirmation-time { font-family: 'JetBrains Mono', monospace; font-size: 20px; color: var(--primary); }
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(10, 14, 20, 0.9); display: none; align-items: center; justify-content: center; z-index: 200; }
        .modal-overlay.show { display: flex; }
        .modal-card { background: var(--surface); border-radius: 14px; padding: 20px; width: 90%; max-width: 300px; }
        .modal-title { font-size: 16px; font-weight: 600; margin-bottom: 6px; }
        .modal-subtitle { font-family: 'JetBrains Mono', monospace; font-size: 13px; color: var(--text-secondary); margin-bottom: 12px; }
        .modal-input { width: 100%; padding: 12px; background: var(--surface-elevated); border: 2px solid transparent; border-radius: 10px; color: var(--text-primary); font-family: 'JetBrains Mono', monospace; font-size: 20px; text-align: center; margin-bottom: 12px; }
        .modal-input:focus { outline: none; border-color: var(--primary); }
        .modal-buttons { display: flex; gap: 10px; }
        .modal-btn { flex: 1; padding: 12px; border: none; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; }
        .modal-btn.cancel { background: var(--surface-elevated); color: var(--text-secondary); }
        .modal-btn.save { background: var(--primary); color: var(--background); }
        
        /* Small screen adjustments */
        @media (max-height: 700px) {
            .clock-date { display: none; }
            .about-features { display: none; }
        }
        @media (max-height: 600px) {
            .bib-label { display: none; }
            .timing-header { display: none; }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div id="timing-view" class="view active">
            <div class="timing-header">
                <div class="gps-indicator">
                    <div class="gps-dot" id="gps-dot"></div>
                    <span id="gps-status">GPS Synced</span>
                </div>
            </div>
            <div class="clock-display">
                <div class="clock-time" id="clock-time">00:00:00.000</div>
                <div class="clock-date" id="clock-date">Monday, January 13, 2025</div>
            </div>
            <div class="bib-section">
                <div class="bib-label" id="bib-label">BIB</div>
                <div class="bib-display" id="bib-display">---</div>
            </div>
            <div class="timing-points">
                <button class="timing-point start active" data-point="S" id="point-start">Start</button>
                <button class="timing-point" data-point="I1">I1</button>
                <button class="timing-point" data-point="I2">I2</button>
                <button class="timing-point" data-point="I3">I3</button>
                <button class="timing-point finish" data-point="F" id="point-finish">Finish</button>
            </div>
            <div class="number-pad">
                <button class="num-btn" data-num="1">1</button>
                <button class="num-btn" data-num="2">2</button>
                <button class="num-btn" data-num="3">3</button>
                <button class="num-btn" data-num="4">4</button>
                <button class="num-btn" data-num="5">5</button>
                <button class="num-btn" data-num="6">6</button>
                <button class="num-btn" data-num="7">7</button>
                <button class="num-btn" data-num="8">8</button>
                <button class="num-btn" data-num="9">9</button>
                <button class="num-btn clear" id="btn-clear">C</button>
                <button class="num-btn" data-num="0">0</button>
                <button class="num-btn delete" id="btn-delete">⌫</button>
            </div>
            <button class="timestamp-btn" id="timestamp-btn">TIMESTAMP</button>
        </div>

        <div id="results-view" class="view">
            <div class="results-header">
                <h1 class="results-title" id="results-title">Results</h1>
                <div class="results-actions" id="results-actions">
                    <button class="action-btn" id="select-btn">Select</button>
                    <button class="action-btn" id="export-btn">Export</button>
                </div>
                <div class="results-actions" id="select-actions" style="display: none;">
                    <button class="action-btn" id="cancel-select-btn">Cancel</button>
                    <button class="action-btn danger" id="delete-selected-btn">Delete</button>
                </div>
            </div>
            <div class="results-stats">
                <div class="stat-card"><div class="stat-value" id="stat-total">0</div><div class="stat-label" id="label-total">Total</div></div>
                <div class="stat-card"><div class="stat-value" id="stat-racers">0</div><div class="stat-label" id="label-racers">Racers</div></div>
                <div class="stat-card"><div class="stat-value" id="stat-event">--</div><div class="stat-label" id="label-event">Event</div></div>
            </div>
            <div class="results-list" id="results-list"></div>
            <div class="empty-state" id="empty-state">
                <svg class="empty-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.2 3.2.8-1.3-4.5-2.7V7z"/></svg>
                <div class="empty-title" id="empty-title">No Times Recorded</div>
                <div class="empty-text" id="empty-text">Recorded timestamps will appear here</div>
            </div>
        </div>

        <div id="settings-view" class="view">
            <div class="settings-header"><h1 class="settings-title" id="settings-title">Settings</h1></div>
            <div class="settings-section">
                <div class="settings-section-title" id="gps-section-title">GPS Status</div>
                <div class="settings-card">
                    <div class="settings-row">
                        <div class="settings-row-icon" style="color: var(--success);"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg></div>
                        <span class="settings-row-label" id="settings-gps-status">GPS Synced</span>
                        <button class="action-btn" onclick="simulateGPSSync()" id="sync-btn">Sync</button>
                    </div>
                    <div class="settings-row">
                        <div class="settings-row-icon" style="color: var(--primary);"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/></svg></div>
                        <span class="settings-row-label" id="accuracy-label">Accuracy</span>
                        <span class="settings-row-value">±10ms</span>
                    </div>
                </div>
            </div>
            <div class="settings-section">
                <div class="settings-section-title" id="timing-section-title">Timing Settings</div>
                <div class="settings-card">
                    <div class="settings-row">
                        <div class="settings-row-icon" style="color: var(--accent);"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg></div>
                        <span class="settings-row-label" id="auto-increment-label">Auto-increment Bib</span>
                        <div id="toggle-auto" class="toggle on" onclick="toggleSetting(this)"></div>
                    </div>
                    <div class="settings-row">
                        <div class="settings-row-icon" style="color: var(--secondary);"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M0 15.998V22h6l14-14-6-6L0 15.998zm23.71-9.42L21.29.29a1.003 1.003 0 0 0-1.42 0L18 2.17 21.83 6l1.88-1.88a.996.996 0 0 0 0-1.42z"/></svg></div>
                        <span class="settings-row-label" id="haptic-label">Haptic Feedback</span>
                        <div id="toggle-haptic" class="toggle on" onclick="toggleSetting(this)"></div>
                    </div>
                    <div class="settings-row">
                        <div class="settings-row-icon" style="color: var(--text-secondary);"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/></svg></div>
                        <span class="settings-row-label" id="language-label">Language</span>
                        <button class="lang-toggle" id="lang-toggle" onclick="toggleLanguage()">EN</button>
                    </div>
                </div>
            </div>
            <div class="settings-section">
                <div class="settings-section-title" id="about-section-title">About</div>
                <div class="settings-card">
                    <div class="about-card">
                        <div class="about-icon"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.2 3.2.8-1.3-4.5-2.7V7z"/></svg></div>
                        <h2 class="about-title">Ski Race Timer</h2>
                        <p class="about-subtitle">GPS-Synchronized Race Timing</p>
                        <div class="about-features">
                            <div class="about-feature"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg><span>GPS-synced timestamps</span></div>
                            <div class="about-feature"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M13 2.05v2.02c3.95.49 7 3.85 7 7.93 0 3.21-1.92 6-4.72 7.28L13 17v5h5l-1.22-1.22C19.91 19.07 22 15.76 22 12c0-5.18-3.95-9.45-9-9.95zM11 2.05C5.94 2.55 2 6.81 2 12c0 3.76 2.09 7.07 5.22 8.78L6 22h5v-5l-2.28 2.28C6.92 18 5 15.21 5 12c0-4.08 3.05-7.44 7-7.93V2.05z"/></svg><span>Millisecond precision</span></div>
                            <div class="about-feature"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2v9.67z"/></svg><span>CSV & JSON export</span></div>
                            <div class="about-feature"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M15.5 1h-8C6.12 1 5 2.12 5 3.5v17C5 21.88 6.12 23 7.5 23h8c1.38 0 2.5-1.12 2.5-2.5v-17C18 2.12 16.88 1 15.5 1zm-4 21c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm4.5-4H7V4h9v14z"/></svg><span>Designed for outdoor use</span></div>
                        </div>
                        <p class="about-version">Version 1.0.0 • PWA</p>
                    </div>
                </div>
            </div>
        </div>

        <nav class="tab-bar">
            <button class="tab-item active" data-view="timing-view"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.2 3.2.8-1.3-4.5-2.7V7z"/></svg><span id="tab-timer">Timer</span></button>
            <button class="tab-item" data-view="results-view"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/></svg><span id="tab-results">Results</span></button>
            <button class="tab-item" data-view="settings-view"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg><span id="tab-settings">Settings</span></button>
        </nav>

        <div id="confirmation-overlay" class="confirmation-overlay">
            <div class="confirmation-card">
                <svg class="confirmation-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg>
                <div class="confirmation-bib" id="confirm-bib">Bib 001</div>
                <div class="confirmation-time" id="confirm-time">10:30:45.123</div>
            </div>
        </div>

        <div id="edit-modal" class="modal-overlay">
            <div class="modal-card">
                <div class="modal-title" id="edit-modal-title">Edit Bib Number</div>
                <div class="modal-subtitle" id="edit-modal-time">10:30:45.123</div>
                <input type="number" id="edit-bib-input" class="modal-input" placeholder="---" min="1" max="999">
                <div class="modal-buttons">
                    <button class="modal-btn cancel" onclick="closeEditModal()" id="edit-cancel-btn">Cancel</button>
                    <button class="modal-btn save" onclick="saveEditBib()" id="edit-save-btn">Save</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const translations = {
            en: { gpsSync: 'GPS Synced', gpsSyncing: 'Syncing...', bib: 'BIB', timestamp: 'TIMESTAMP', start: 'Start', finish: 'Finish', results: 'Results', total: 'Total', racers: 'Racers', event: 'Event', select: 'Select', cancel: 'Cancel', delete: 'Delete', export: 'Export', noTimesRecorded: 'No Times Recorded', noTimesDesc: 'Recorded timestamps will appear here', noBib: 'No Bib', editBibNumber: 'Edit Bib Number', save: 'Save', settings: 'Settings', gpsStatus: 'GPS Status', sync: 'Sync', accuracy: 'Accuracy', timingSettings: 'Timing Settings', autoIncrementBib: 'Auto-increment Bib', hapticFeedback: 'Haptic Feedback', language: 'Language', about: 'About', timer: 'Timer' },
            de: { gpsSync: 'GPS synchronisiert', gpsSyncing: 'Synchronisieren...', bib: 'STARTNR', timestamp: 'ZEITSTEMPEL', start: 'Start', finish: 'Ziel', results: 'Ergebnisse', total: 'Gesamt', racers: 'Fahrer', event: 'Event', select: 'Auswählen', cancel: 'Abbrechen', delete: 'Löschen', export: 'Exportieren', noTimesRecorded: 'Keine Zeiten erfasst', noTimesDesc: 'Erfasste Zeitstempel erscheinen hier', noBib: 'Keine Nr.', editBibNumber: 'Startnummer bearbeiten', save: 'Speichern', settings: 'Einstellungen', gpsStatus: 'GPS Status', sync: 'Sync', accuracy: 'Genauigkeit', timingSettings: 'Zeitmessung', autoIncrementBib: 'Startnr. automatisch erhöhen', hapticFeedback: 'Haptisches Feedback', language: 'Sprache', about: 'Über', timer: 'Timer' }
        };
        let currentLang = localStorage.getItem('skiTimerLang') || 'en';
        let bibInput = '';
        let selectedPoint = 'S';
        let entries = JSON.parse(localStorage.getItem('skiTimerEntries') || '[]');
        let selectMode = false;
        let selectedEntries = new Set();
        let editingEntryId = null;

        function t(key) { return translations[currentLang][key] || key; }
        function updateTranslations() {
            document.getElementById('gps-status').textContent = t('gpsSync');
            document.getElementById('bib-label').textContent = t('bib');
            document.getElementById('timestamp-btn').textContent = t('timestamp');
            document.getElementById('point-start').textContent = t('start');
            document.getElementById('point-finish').textContent = t('finish');
            document.getElementById('results-title').textContent = t('results');
            document.getElementById('label-total').textContent = t('total');
            document.getElementById('label-racers').textContent = t('racers');
            document.getElementById('label-event').textContent = t('event');
            document.getElementById('select-btn').textContent = t('select');
            document.getElementById('export-btn').textContent = t('export');
            document.getElementById('cancel-select-btn').textContent = t('cancel');
            document.getElementById('delete-selected-btn').textContent = t('delete');
            document.getElementById('empty-title').textContent = t('noTimesRecorded');
            document.getElementById('empty-text').textContent = t('noTimesDesc');
            document.getElementById('settings-title').textContent = t('settings');
            document.getElementById('gps-section-title').textContent = t('gpsStatus');
            document.getElementById('settings-gps-status').textContent = t('gpsSync');
            document.getElementById('sync-btn').textContent = t('sync');
            document.getElementById('accuracy-label').textContent = t('accuracy');
            document.getElementById('timing-section-title').textContent = t('timingSettings');
            document.getElementById('auto-increment-label').textContent = t('autoIncrementBib');
            document.getElementById('haptic-label').textContent = t('hapticFeedback');
            document.getElementById('language-label').textContent = t('language');
            document.getElementById('about-section-title').textContent = t('about');
            document.getElementById('tab-timer').textContent = t('timer');
            document.getElementById('tab-results').textContent = t('results');
            document.getElementById('tab-settings').textContent = t('settings');
            document.getElementById('edit-modal-title').textContent = t('editBibNumber');
            document.getElementById('edit-cancel-btn').textContent = t('cancel');
            document.getElementById('edit-save-btn').textContent = t('save');
            document.getElementById('lang-toggle').textContent = currentLang.toUpperCase();
        }
        function toggleLanguage() { currentLang = currentLang === 'en' ? 'de' : 'en'; localStorage.setItem('skiTimerLang', currentLang); updateTranslations(); updateResults(); vibrate(15); }
        document.querySelectorAll('.tab-item').forEach(tab => { tab.addEventListener('click', () => { document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active')); document.querySelectorAll('.view').forEach(v => v.classList.remove('active')); tab.classList.add('active'); document.getElementById(tab.dataset.view).classList.add('active'); vibrate(10); }); });
        document.querySelectorAll('.timing-point').forEach(point => { point.addEventListener('click', () => { document.querySelectorAll('.timing-point').forEach(p => p.classList.remove('active')); point.classList.add('active'); selectedPoint = point.dataset.point; vibrate(15); }); });
        document.querySelectorAll('.num-btn[data-num]').forEach(btn => { btn.addEventListener('click', () => { if (bibInput.length < 3) { bibInput += btn.dataset.num; updateBibDisplay(); vibrate(10); } }); });
        document.getElementById('btn-clear').addEventListener('click', () => { bibInput = ''; updateBibDisplay(); vibrate(15); });
        document.getElementById('btn-delete').addEventListener('click', () => { bibInput = bibInput.slice(0, -1); updateBibDisplay(); vibrate(15); });
        function updateBibDisplay() { const display = document.getElementById('bib-display'); if (bibInput) { display.textContent = bibInput.padStart(3, '0'); display.classList.remove('empty'); } else { display.textContent = '---'; display.classList.add('empty'); } }
        document.getElementById('timestamp-btn').addEventListener('click', () => {
            const now = new Date(); const hasBib = bibInput.length > 0;
            entries.push({ id: Date.now(), bib: hasBib ? bibInput.padStart(3, '0') : null, point: selectedPoint, timestamp: now.toISOString() });
            localStorage.setItem('skiTimerEntries', JSON.stringify(entries));
            document.getElementById('confirm-bib').textContent = hasBib ? 'Bib ' + bibInput.padStart(3, '0') : t('noBib');
            document.getElementById('confirm-time').textContent = formatTime(now);
            document.getElementById('confirmation-overlay').classList.add('show');
            vibrate([50, 30, 100]);
            setTimeout(() => { document.getElementById('confirmation-overlay').classList.remove('show'); }, 1500);
            if (document.getElementById('toggle-auto').classList.contains('on') && hasBib) { const nextBib = (parseInt(bibInput) + 1).toString(); if (nextBib.length <= 3) { bibInput = nextBib; updateBibDisplay(); } } else if (!hasBib) { bibInput = ''; updateBibDisplay(); }
            updateResults();
        });
        function updateClock() { const now = new Date(); document.getElementById('clock-time').textContent = formatTime(now); document.getElementById('clock-date').textContent = now.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }); }
        function formatTime(date) { const d = new Date(date); return d.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' }) + '.' + d.getMilliseconds().toString().padStart(3, '0'); }
        function formatDate(date) { return new Date(date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' }); }
        function getPointColor(point) { const colors = { 'S': 'var(--success)', 'I1': 'var(--primary)', 'I2': 'var(--primary)', 'I3': 'var(--primary)', 'F': 'var(--secondary)' }; return colors[point] || 'var(--text-secondary)'; }
        function updateResults() {
            const list = document.getElementById('results-list'); const empty = document.getElementById('empty-state'); const selectBtn = document.getElementById('select-btn');
            document.getElementById('stat-total').textContent = entries.length;
            document.getElementById('stat-racers').textContent = new Set(entries.filter(e => e.bib).map(e => e.bib)).size;
            if (entries.length === 0) { list.style.display = 'none'; empty.style.display = 'flex'; selectBtn.disabled = true; if (selectMode) exitSelectMode(); return; }
            list.style.display = 'block'; empty.style.display = 'none'; selectBtn.disabled = false;
            const sorted = [...entries].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            list.innerHTML = sorted.map(entry => '<div class="result-item" data-id="' + entry.id + '"><div class="result-checkbox ' + (selectedEntries.has(entry.id) ? 'checked' : '') + '" onclick="toggleSelect(' + entry.id + ')"></div><div class="result-bib" onclick="openEditModal(' + entry.id + ')">' + (entry.bib || t('noBib')) + '</div><div class="result-point" style="background: ' + getPointColor(entry.point) + '20; color: ' + getPointColor(entry.point) + ';">' + entry.point + '</div><div class="result-info"><div class="result-time">' + formatTime(entry.timestamp) + '</div><div class="result-date">' + formatDate(entry.timestamp) + '</div></div><button class="result-delete" onclick="deleteEntry(' + entry.id + ')"><svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg></button></div>').join('');
        }
        function deleteEntry(id) { entries = entries.filter(e => e.id !== id); localStorage.setItem('skiTimerEntries', JSON.stringify(entries)); updateResults(); vibrate(20); }
        document.getElementById('select-btn').addEventListener('click', () => { selectMode = true; selectedEntries.clear(); document.getElementById('results-list').classList.add('select-mode'); document.getElementById('results-actions').style.display = 'none'; document.getElementById('select-actions').style.display = 'flex'; updateResults(); vibrate(15); });
        document.getElementById('cancel-select-btn').addEventListener('click', exitSelectMode);
        function exitSelectMode() { selectMode = false; selectedEntries.clear(); document.getElementById('results-list').classList.remove('select-mode'); document.getElementById('results-actions').style.display = 'flex'; document.getElementById('select-actions').style.display = 'none'; updateResults(); vibrate(15); }
        function toggleSelect(id) { if (selectedEntries.has(id)) { selectedEntries.delete(id); } else { selectedEntries.add(id); } updateResults(); vibrate(10); }
        document.getElementById('delete-selected-btn').addEventListener('click', () => { entries = entries.filter(e => !selectedEntries.has(e.id)); localStorage.setItem('skiTimerEntries', JSON.stringify(entries)); exitSelectMode(); vibrate([20, 10, 50]); });
        document.getElementById('export-btn').addEventListener('click', () => { if (entries.length === 0) return; const sorted = [...entries].sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp)); const csv = 'Bib,Timestamp,TimingPoint\n' + sorted.map(e => (e.bib || '') + ',' + e.timestamp + ',' + e.point).join('\n'); const blob = new Blob([csv], { type: 'text/csv' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'ski-times-' + new Date().toISOString().split('T')[0] + '.csv'; a.click(); URL.revokeObjectURL(url); vibrate([20, 30, 50]); });
        function openEditModal(id) { if (selectMode) return; editingEntryId = id; const entry = entries.find(e => e.id === id); document.getElementById('edit-modal-time').textContent = formatTime(entry.timestamp); document.getElementById('edit-bib-input').value = entry.bib || ''; document.getElementById('edit-modal').classList.add('show'); vibrate(15); }
        function closeEditModal() { document.getElementById('edit-modal').classList.remove('show'); editingEntryId = null; vibrate(10); }
        function saveEditBib() { const input = document.getElementById('edit-bib-input').value; const entry = entries.find(e => e.id === editingEntryId); if (entry) { entry.bib = input ? input.padStart(3, '0') : null; localStorage.setItem('skiTimerEntries', JSON.stringify(entries)); updateResults(); } closeEditModal(); vibrate([20, 30]); }
        function toggleSetting(el) { el.classList.toggle('on'); vibrate(15); }
        function simulateGPSSync() { const dot = document.getElementById('gps-dot'); const status = document.getElementById('gps-status'); const settingsStatus = document.getElementById('settings-gps-status'); dot.style.background = 'var(--gps-searching)'; dot.style.boxShadow = '0 0 6px var(--gps-searching)'; status.textContent = t('gpsSyncing'); if (settingsStatus) settingsStatus.textContent = t('gpsSyncing'); setTimeout(() => { dot.style.background = 'var(--gps-active)'; dot.style.boxShadow = '0 0 6px var(--gps-active)'; status.textContent = t('gpsSync'); if (settingsStatus) settingsStatus.textContent = t('gpsSync'); vibrate([20, 30, 50]); }, 1500); vibrate(15); }
        function vibrate(pattern) { if ('vibrate' in navigator && document.getElementById('toggle-haptic').classList.contains('on')) { navigator.vibrate(pattern); } }
        document.addEventListener('touchend', (e) => { const now = Date.now(); if (now - (window.lastTouchEnd || 0) < 300) { e.preventDefault(); } window.lastTouchEnd = now; }, { passive: false });
        updateTranslations(); updateBibDisplay(); updateResults(); updateClock(); setInterval(updateClock, 50);
        if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js').catch(err => console.log('SW registration failed:', err)); }
    </script>
</body>
</html>
