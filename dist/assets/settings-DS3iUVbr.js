import{r as B,L as k,m as ue,V as A,t as l,s as r,d as E,W as j,X as ge,a as p,f as W,Y as fe,Z as me,_ as Z,a0 as ie,Q as pe,p as S,a1 as ye,o as u,c as z,n as D,e as he,h as Q,U as Ee,P as J,a2 as Ie,a3 as Y,a4 as ve,a5 as Se,a6 as ke}from"./chief-judge-CSBb83aQ.js";import{o as v,c as h,u as be}from"./gate-judge-JcuLKP2m.js";const X=new k;let y=null;async function q(e,t){const n=await me(e,t);return n.success&&T(),n}async function we(){A()}function ee(e){return/^\d{4}$/.test(e)}function T(){const e=r.getState().currentLang,t=A(),n=document.getElementById("admin-pin-status"),a=document.getElementById("change-pin-btn-text");n&&(n.textContent=t?l("pinSet",e):l("pinNotSet",e)),a&&(a.textContent=t?l("changePin",e):l("setPin",e))}function Re(){const e=r.getState().currentLang,t=A(),n=document.getElementById("change-pin-modal"),a=document.getElementById("change-pin-modal-title"),i=document.getElementById("current-pin-row"),c=document.getElementById("current-pin-input"),s=document.getElementById("new-pin-input"),o=document.getElementById("confirm-pin-input");n&&(c&&(c.value=""),s&&(s.value=""),o&&(o.value=""),ce(),t?(i&&(i.style.display="block"),a&&(a.textContent=l("changePin",e))):(i&&(i.style.display="none"),a&&(a.textContent=l("setPin",e))),v(n),t&&c?c.focus():s&&s.focus())}function ce(){["current-pin-error","pin-mismatch-error","pin-format-error"].forEach(t=>{const n=document.getElementById(t);n&&(n.style.display="none")})}async function Ce(){const e=r.getState().currentLang,t=A(),n=document.getElementById("current-pin-input"),a=document.getElementById("new-pin-input"),i=document.getElementById("confirm-pin-input"),c=document.getElementById("save-pin-btn"),s=document.getElementById("current-pin-error"),o=document.getElementById("pin-mismatch-error"),d=document.getElementById("pin-format-error");ce();const g=(n==null?void 0:n.value)||"",m=(a==null?void 0:a.value)||"",R=(i==null?void 0:i.value)||"";if(!ee(m)){d&&(d.style.display="block"),a&&a.focus(),E();return}if(m!==R){o&&(o.style.display="block"),i&&(i.value="",i.focus()),E();return}if(t){if(!ee(g)){s&&(s.style.display="block"),n&&n.focus(),E();return}const I=(c==null?void 0:c.textContent)||"";c&&(c.disabled=!0,c.textContent=l("saving",e));try{const f=await fetch("/api/v1/admin/pin",{method:"POST",headers:{...j(),"Content-Type":"application/json"},body:JSON.stringify({currentPin:g,newPin:m})});if(f.status===401){s&&(s.style.display="block"),n&&(n.value="",n.focus()),E();return}if(!f.ok)throw new Error(`HTTP ${f.status}`);if(ge(),!(await q(m)).success){p(l("pinSyncFailed",e),"error"),E();return}const de=document.getElementById("change-pin-modal");h(de),p(l("pinSaved",e),"success"),W(),T()}catch(f){fe("Admin","handleSavePin",f,"pinSyncFailed"),p(l("pinSyncFailed",e),"error"),E()}finally{c&&(c.disabled=!1,c.textContent=I)}}else{const I=(c==null?void 0:c.textContent)||"";c&&(c.disabled=!0,c.textContent=l("saving",e));try{if(!(await q(m)).success){p(l("pinSyncFailed",e),"error"),E();return}const P=document.getElementById("change-pin-modal");h(P),p(l("pinSaved",e),"success"),W(),T()}finally{c&&(c.disabled=!1,c.textContent=I)}}}function K(e){return new Promise(t=>{if(A()){t(!0);return}const n=document.getElementById("admin-pin-modal"),a=document.getElementById("admin-pin-modal-title"),i=document.getElementById("admin-pin-modal-text"),c=document.getElementById("admin-pin-verify-input"),s=document.getElementById("admin-pin-error");if(!n||!c){t(!1);return}a&&(a.textContent=l("enterAdminPin",e)),i&&(i.textContent=l("enterPinToJoinRace",e)),s&&(s.style.display="none"),c.value="",y={type:"raceJoin",resolve:t},v(n),setTimeout(()=>c.focus(),100)})}function ut(e){return new Promise(t=>{const n=document.getElementById("admin-pin-modal"),a=document.getElementById("admin-pin-modal-title"),i=document.getElementById("admin-pin-modal-text"),c=document.getElementById("admin-pin-verify-input"),s=document.getElementById("admin-pin-error");if(!n||!c){t(!1);return}a&&(a.textContent=l("enterChiefJudgePin",e)),i&&(i.textContent=l("enterPinForChiefJudgeInfo",e)),s&&(s.style.display="none"),c.value="",y={type:"chiefJudge",resolve:t},v(n),setTimeout(()=>c.focus(),100)})}async function te(){const e=document.getElementById("admin-pin-verify-input"),t=document.getElementById("admin-pin-error"),n=document.getElementById("admin-pin-modal");if(!e||!n||!y)return;const a=e.value.trim(),i=y.type==="chiefJudge"?"chiefJudge":void 0;(await q(a,i)).success?(h(n),e.value="",t&&(t.style.display="none"),y.resolve(!0),y=null):(t&&(t.style.display="block"),e.value="",e.focus(),E())}function xe(){const e=document.getElementById("admin-pin-modal"),t=document.getElementById("admin-pin-verify-input");h(e),t&&(t.value=""),y&&(y.resolve(!1),y=null)}function gt(){return y?(y.resolve(!1),y=null,!0):!1}function U(){return y!==null}function Be(){we().then(()=>{T()}).catch(a=>{B.error("Failed to initialize admin PIN:",a)}),T();const e=document.getElementById("change-pin-btn");e&&X.add(e,"click",Re);const t=document.getElementById("save-pin-btn");t&&X.add(t,"click",Ce),["admin-pin-verify-input","current-pin-input","new-pin-input","confirm-pin-input"].forEach(a=>{const i=document.getElementById(a);i&&ue(i)})}const H=new k,oe="/api/v1/admin/races";let $=null;function Ae(){const e=document.getElementById("admin-pin-modal"),t=document.getElementById("admin-pin-verify-input"),n=document.getElementById("admin-pin-error"),a=document.getElementById("admin-pin-modal-title"),i=document.getElementById("admin-pin-modal-text"),c=r.getState().currentLang;e&&t&&n&&(t.value="",n.style.display="none",a&&(a.textContent=l("enterAdminPin",c)),i&&(i.textContent=l("enterPinText",c)),v(e),t.focus())}async function ne(){const e=document.getElementById("admin-pin-verify-input"),t=document.getElementById("admin-pin-error"),n=document.getElementById("admin-pin-modal");if(!e||!n)return;const a=e.value.trim();(await q(a)).success?(h(n),e.value="",t&&(t.style.display="none"),Pe()):(t&&(t.style.display="block"),e.value="",e.focus(),E())}function Pe(){const e=document.getElementById("race-management-modal");e&&(v(e),G())}async function G(){const e=document.getElementById("race-list"),t=document.getElementById("race-list-loading"),n=document.getElementById("race-list-empty"),a=r.getState().currentLang;if(e){e.setAttribute("aria-busy","true"),t&&(t.style.display="block"),n&&(n.style.display="none"),e.querySelectorAll(".race-item").forEach(i=>i.remove());try{const i=await Z(oe,{headers:j()},1e4);if(!i.ok){if(i.status===401){const o=document.getElementById("race-management-modal");h(o),p(l("authError",a),"error"),B.error("API auth failed - check ADMIN_PIN env variable matches SERVER_API_PIN");return}throw new Error(`HTTP ${i.status}`)}const s=(await i.json()).races||[];if(e.setAttribute("aria-busy","false"),t&&(t.style.display="none"),s.length===0){n&&(n.style.display="block");return}s.forEach(o=>{const d=Te(o,a);e.appendChild(d)})}catch(i){ie("Admin","loadRaceList",i,"loadError"),p(l("loadError",a),"error"),e.setAttribute("aria-busy","false"),t&&(t.style.display="none")}}}function Te(e,t){const n=document.createElement("div");n.className="race-item",n.setAttribute("data-race-id",e.raceId);const a=document.createElement("div");a.className="race-info";const i=document.createElement("span");i.className="race-id",i.textContent=e.raceId.toUpperCase();const c=document.createElement("span");c.className="race-meta";const s=e.entryCount===1?l("entry",t):l("entries",t),o=e.deviceCount===1?l("device",t):l("devices",t);c.textContent=`${e.entryCount} ${s}, ${e.deviceCount} ${o}`,a.appendChild(i),a.appendChild(c);const d=document.createElement("button");return d.className="race-delete-btn danger",d.textContent=l("delete",t),d.addEventListener("click",()=>Le(e.raceId)),n.appendChild(a),n.appendChild(d),n}function Le(e){const t=r.getState().currentLang;$=e;const n=document.getElementById("delete-race-confirm-modal"),a=document.getElementById("delete-race-confirm-text");a&&(a.textContent=`${l("confirmDeleteRaceText",t)} "${e.toUpperCase()}"?`),n&&v(n)}async function De(){if(!$)return;const e=$,t=r.getState().currentLang,n=document.getElementById("delete-race-confirm-modal");h(n);try{const a=await Z(`${oe}?raceId=${encodeURIComponent(e)}`,{method:"DELETE",headers:j()},1e4);if(!a.ok){if(a.status===401){const c=document.getElementById("race-management-modal");h(c),p(l("authError",t),"error"),B.error("API auth failed - check ADMIN_PIN env variable matches SERVER_API_PIN");return}throw new Error(`HTTP ${a.status}`)}const i=await a.json();if(i.success)p(`${l("raceDeletedSuccess",t)} ${e.toUpperCase()}`,"success"),pe(),G();else throw new Error(i.error||l("unknownError",t))}catch(a){ie("Admin","deleteRace",a,"deleteError")}finally{$=null}}function $e(){const e=document.getElementById("manage-races-btn");e&&H.add(e,"click",Ae);const t=document.getElementById("refresh-races-btn");t&&H.add(t,"click",G);const n=document.getElementById("confirm-delete-race-btn");n&&H.add(n,"click",De)}const M=new k;function ft(e,t){return new Promise(n=>{const a=document.getElementById("race-change-modal");if(!a){n("cancel");return}const i=a.querySelector(".modal-title"),c=a.querySelector(".modal-text"),s=document.getElementById("race-change-export-btn"),o=document.getElementById("race-change-delete-btn"),d=document.getElementById("race-change-keep-btn"),g=a.querySelector('[data-action="cancel"]');e==="synced"?(i&&(i.textContent=l("raceChangeTitle",t)),c&&(c.textContent=l("raceChangeSyncedText",t)),s&&(s.style.display=""),d&&(d.style.display="none")):(i&&(i.textContent=l("raceChangeTitle",t)),c&&(c.textContent=l("raceChangeUnsyncedText",t)),s&&(s.style.display="none"),d&&(d.style.display=""));const m=()=>{h(a),s==null||s.removeEventListener("click",R),o==null||o.removeEventListener("click",I),d==null||d.removeEventListener("click",f),g==null||g.removeEventListener("click",P)},R=()=>{m(),n("export")},I=()=>{m(),n("delete")},f=()=>{m(),n("keep")},P=()=>{m(),n("cancel")};s==null||s.addEventListener("click",R),o==null||o.addEventListener("click",I),d==null||d.addEventListener("click",f),g==null||g.addEventListener("click",P),v(a)})}function mt(e){const{raceId:t,message:n}=e.detail,a=r.getState().currentLang,i=document.getElementById("race-deleted-text");i&&(i.textContent=`${l("raceDeletedFor",a)} "${t}". ${n||l("raceDeletedText",a)}`);const c=document.getElementById("race-deleted-modal");c&&v(c),r.updateSettings({sync:!1}),r.setRaceId("");const s=document.getElementById("sync-toggle");s&&(s.checked=!1);const o=document.getElementById("race-id-input");o&&(o.value=""),E()}function pt(e){const{message:t}=e.detail,n=r.getState().currentLang;p(t||l("sessionExpired",n),"warning",5e3),K(n).then(a=>{if(a){const i=r.getState();i.settings.sync&&i.raceId&&S.initialize(),p(l("authSuccess",n),"success")}}).catch(a=>B.error("Re-auth failed:",a)),E()}async function yt(){const e=document.getElementById("photo-sync-modal");if(!e)return;const t=r.getState().currentLang,n=document.getElementById("photos-upload-count"),a=document.getElementById("photos-download-count"),i=document.getElementById("photos-total-size");n&&(n.textContent=l("loading",t)),a&&(a.textContent=l("loading",t)),i&&(i.textContent=l("loading",t)),v(e);const c=await S.getPhotoSyncStats();n&&(n.textContent=String(c.uploadCount)),a&&(a.textContent=String(c.downloadCount)),i&&(i.textContent=ye(c.totalSize));const s=document.getElementById("photo-sync-confirm-btn");s&&(s.textContent=l("enableSync",t))}function Me(){const e=document.getElementById("photo-sync-modal"),t=document.getElementById("photo-sync-cancel-btn"),n=document.getElementById("photo-sync-confirm-btn");t&&M.add(t,"click",()=>{h(e)}),n&&M.add(n,"click",()=>{r.updateSettings({syncPhotos:!0});const a=document.getElementById("sync-photos-toggle");a&&(a.checked=!0),h(e);const i=r.getState();i.settings.sync&&i.raceId&&S.forceRefresh(),W()}),e&&M.add(e,"click",a=>{a.target===e&&h(e)})}function Ve(){const e=document.getElementById("race-deleted-ok-btn");e&&M.add(e,"click",()=>{const t=document.getElementById("race-deleted-modal");h(t)}),Me()}const _=new k;function ht(){Be(),$e(),Ve();const e=document.getElementById("admin-pin-verify-btn");e&&_.add(e,"click",()=>{U()?te():ne()});const t=document.getElementById("admin-pin-verify-input");t&&_.add(t,"keydown",(a=>{a.key==="Enter"&&(U()?te():ne())}));const n=document.getElementById("admin-pin-modal");n&&_.add(n,"click",a=>{a.target===n&&U()&&xe()})}const Ne={"5.18":{name:"Powder Streif",description:{en:"Battery power saver for longer outdoor timing. Improved PIN security and faster voice notes.",de:"Batterieschoner für längere Zeitmessung im Freien. Verbesserte PIN-Sicherheit und schnellere Sprachnotizen."}},"5.19":{name:"Firn Lauberhorn",description:{en:"Under-the-hood reliability upgrade. Stronger server-side input validation and improved code quality.",de:"Verbesserungen unter der Haube. Stärkere serverseitige Eingabevalidierung und verbesserte Codequalität."}},"5.20":{name:"Corn Saslong",description:{en:"Offline banner, undo for deletions, reorganized settings, and standardized event cleanup across the app.",de:"Offline-Banner, Rückgängig-Funktion für Löschungen, neu organisierte Einstellungen und standardisierte Ereignisbereinigung."}},"5.21":{name:"Sleet Kandahar",description:{en:"Responsive layout fixes for all screen sizes. Dial and numbers scale smoothly from iPhone SE to iPad landscape.",de:"Responsive Layout-Korrekturen für alle Bildschirmgrößen. Zifferblatt und Zahlen skalieren fließend vom iPhone SE bis iPad Querformat."}},"5.22":{name:"Crust Stelvio",description:{en:"Signals-based reactivity, view code splitting, reduced-motion support, and 3,700+ new tests for rock-solid reliability.",de:"Signalbasierte Reaktivität, View-Code-Splitting, Reduced-Motion-Unterstützung und 3.700+ neue Tests für maximale Zuverlässigkeit."}},"5.23":{name:"Graupel Hahnenkamm",description:{en:"Swipe-to-edit/delete in results, click-outside modal dismiss, auto-bib flash cue, and split settings effects for better performance.",de:"Wischen zum Bearbeiten/Löschen in Ergebnissen, Modal-Schließen per Klick außerhalb, Auto-Bib-Blitz-Hinweis und aufgeteilte Einstellungs-Effekte für bessere Leistung."}}};function qe(e){const t=e.split(".");if(t.length<2)return null;const n=`${t[0]}.${t[1]}`,a=Ne[n];if(!a)return null;const i=r.getState().currentLang;return{name:a.name,description:a.description[i]||a.description.en}}const L=new k;function Fe(){const e=u("device-name-input");e&&L.add(e,"change",()=>{r.setDeviceName(e.value.trim())}),ze(),L.add(window,"update-role-toggle",()=>se()),Je()}function ze(){const e=u("role-toggle");e&&L.add(e,"click",t=>{const a=t.target.closest(".role-card-setting");if(!a)return;const i=a.getAttribute("data-role");i&&i!==r.getState().deviceRole&&(r.setDeviceRole(i),se(),be(),z(),i==="gateJudge"&&!r.getState().gateAssignment&&v(u("gate-assignment-modal")),i!=="gateJudge"&&r.getState().currentView==="gateJudge"&&r.setView("timer"))})}function se(){const e=u("role-toggle");if(!e)return;const t=r.getState();e.querySelectorAll(".role-card-setting").forEach(n=>{const i=n.getAttribute("data-role")===t.deviceRole;n.classList.toggle("active",i),n.setAttribute("aria-checked",String(i))})}function Je(){const e=u("advanced-settings-toggle"),t=u("advanced-settings-section");!e||!t||(e.setAttribute("role","button"),e.setAttribute("aria-expanded",t.classList.contains("expanded")?"true":"false"),L.add(e,"click",()=>{const n=t.classList.toggle("expanded");e.setAttribute("aria-expanded",String(n)),z()}))}function Ue(){const e=r.getState(),t=u("device-name-input");t&&(t.value=e.deviceName)}function He(){L.removeAll()}const C=new k;function _e(e){const t=u("simple-mode-toggle");t&&C.add(t,"change",()=>{r.updateSettings({simple:t.checked}),e();const i=u("admin-section");i&&(i.style.display="block")});const n=u("ambient-mode-toggle");n&&C.add(n,"change",()=>{r.updateSettings({ambientMode:n.checked})}),Oe();const a=u("lang-toggle");if(a){const i=c=>{c&&c!==r.getState().currentLang&&(r.setLanguage(c),window.dispatchEvent(new CustomEvent("settings-language-changed")))};C.add(a,"click",c=>{const o=c.target.getAttribute("data-lang");i(o)}),a.querySelectorAll(".lang-option").forEach(c=>{C.add(c,"keydown",s=>{const o=s,d=c.getAttribute("data-lang");switch(o.key){case"Enter":case" ":o.preventDefault(),i(d);break;case"ArrowLeft":case"ArrowRight":{o.preventDefault();const g=d==="de"?"en":"de",m=a.querySelector(`[data-lang="${g}"]`);m&&(m.focus(),i(g));break}}})})}}function Oe(){const e=u("voice-mode-toggle"),t=u("voice-mode-row");if(!(!e||!t)){if(!D.isSupported()){t.style.display="none";return}e.checked=D.isActive(),C.add(e,"change",async()=>{const n=r.getState().currentLang;if(e.checked){if(!navigator.onLine){p(l("voiceOffline",n),"warning"),e.checked=!1;return}D.enable()||(p(l("voiceError",n),"error"),e.checked=!1)}else D.disable()})}}function We(){const e=r.getState(),{settings:t}=e,n=u("simple-mode-toggle");n&&(n.checked=t.simple);const a=u("admin-section");a&&(a.style.display="block");const i=u("ambient-mode-toggle");i&&(i.checked=t.ambientMode),re()}function re(){const e=r.getState().currentLang,t=u("lang-toggle");t&&t.querySelectorAll(".lang-option").forEach(n=>{const a=n.getAttribute("data-lang")===e;n.classList.toggle("active",a),n.setAttribute("aria-checked",String(a))})}function Ke(){C.removeAll()}function je(e){const t=r.getState().currentLang,n=e.entryCount!==void 0?`${e.entryCount} ${l("entries",t)}`:"",a=he(e.raceId);return`
    <div class="recent-race-item" data-race-id="${Q(e.raceId)}" tabindex="0" role="option" aria-label="${Q(l("race",t))} ${a}${n?`, ${n}`:""}">
      <span class="recent-race-id">${a}</span>
      <span class="recent-race-meta">${n}</span>
    </div>
  `}function Ze(e){return e.map(je).join("")}function Ge(e,t,n){const a=e.querySelectorAll(".recent-race-item");a.forEach((i,c)=>{i.addEventListener("click",()=>{const s=t[c];s&&n(s)}),i.addEventListener("keydown",s=>{const o=s,d=Array.from(a);switch(o.key){case"Enter":case" ":{o.preventDefault();const g=t[c];g&&n(g);break}case"ArrowDown":o.preventDefault(),c<d.length-1&&d[c+1].focus();break;case"ArrowUp":o.preventDefault(),c>0&&d[c-1].focus();break;case"Escape":o.preventDefault(),e.style.display="none";break}})})}const b=new k;let x=null,O=0,le={exists:null,entryCount:0},V=null,N=null;async function Qe(){return new Promise(e=>{V=e,window.dispatchEvent(new CustomEvent("request-photo-sync-warning"))})}async function ae(e,t){return new Promise(n=>{N=n,window.dispatchEvent(new CustomEvent("request-race-change-dialog",{detail:{type:e,lang:t}}))})}function Et(){V&&(V(),V=null)}function It(e){N&&(N(e),N=null)}function Ye(){const e=u("sync-toggle");let t=!1;e&&b.add(e,"change",async()=>{if(t){e.checked=!e.checked;return}t=!0;try{const o=r.getState();if(e.checked&&o.raceId&&!await K(o.currentLang)){e.checked=!1;return}r.updateSettings({sync:e.checked});const d=u("sync-photos-toggle");d&&(d.disabled=!e.checked,e.checked||(d.checked=!1,r.updateSettings({syncPhotos:!1}))),e.checked&&o.raceId?S.initialize():S.cleanup()}finally{t=!1}});const n=u("sync-photos-toggle");n&&b.add(n,"change",async o=>{const d=o.target;d.checked?(o.preventDefault(),d.checked=!1,await Qe()):r.updateSettings({syncPhotos:!1})});const a=u("race-id-input");let i=!1;a&&(b.add(a,"input",()=>{x&&clearTimeout(x);const o=a.value.trim();o?x=setTimeout(()=>et(o),500):F(null,0)}),b.add(a,"change",async()=>{if(!i){i=!0;try{const o=a.value.trim(),d=r.getState(),g=d.entries.length>0,m=d.lastSyncedRaceId!=="",R=o!==d.raceId&&o!=="";if(g&&R)if(m){const f=await ae("synced",d.currentLang);if(f==="export")Ee(),r.clearAll(),r.clearFaultEntries(),await J.clearAll();else if(f==="delete")r.clearAll(),r.clearFaultEntries(),await J.clearAll();else{a.value=d.raceId;return}}else{const f=await ae("unsynced",d.currentLang);if(f==="delete")r.clearAll(),r.clearFaultEntries(),await J.clearAll();else if(f==="cancel"){a.value=d.raceId;return}}if(o&&!Ie(o)){p(l("invalidRaceId",d.currentLang),"error"),a.value=d.raceId,E();return}if(d.settings.sync&&o&&!await K(d.currentLang)){a.value=d.raceId;return}d.settings.sync&&d.raceId&&S.cleanup();const I=o.toLowerCase();a.value=I,r.setRaceId(I),d.settings.sync&&I&&(S.initialize(),r.markCurrentRaceAsSynced())}finally{i=!1}}}));const c=u("settings-recent-races-btn"),s=u("settings-recent-races-dropdown");c&&s&&(b.add(c,"click",()=>{z(),s.style.display==="none"?(tt(s),c.setAttribute("aria-expanded","true")):(s.style.display="none",c.setAttribute("aria-expanded","false"))}),b.add(document,"click",o=>{const d=o.target;!c.contains(d)&&!s.contains(d)&&(s.style.display="none",c.setAttribute("aria-expanded","false"))}))}function Xe(){const e=r.getState(),{settings:t}=e,n=u("sync-toggle");n&&(n.checked=t.sync);const a=u("sync-photos-toggle");a&&(a.checked=t.syncPhotos,a.disabled=!t.sync);const i=u("race-id-input");i&&(i.value=e.raceId)}async function et(e){const t=++O;try{const n=await S.checkRaceExists(e);if(t!==O)return;r.setRaceExistsInCloud(n.exists),F(n.exists,n.entryCount)}catch(n){if(t!==O)return;B.warn("Race exists check failed:",n),F(null,0)}}async function tt(e){const t=r.getState().currentLang;e.innerHTML=`<div class="recent-races-empty">${l("loading",t)}</div>`,e.style.display="block";let n=[];if(A())try{n=await nt()}catch(a){B.warn("Failed to fetch races from API:",a),n=Y()}else n=Y();n.length===0?e.innerHTML=`<div class="recent-races-empty">${l("noRecentRaces",t)}</div>`:(e.innerHTML=Ze(n),Ge(e,n,a=>{at(a,e)}))}async function nt(){const e=ve.getRaw(Se);if(!e)return[];const t=await Z("/api/v1/admin/races",{headers:{Authorization:`Bearer ${e}`}},5e3);if(!t.ok)throw new Error(`API error: ${t.status}`);const a=(await t.json()).races||[],i=new Date;i.setHours(0,0,0,0);const c=i.getTime(),s=a.filter(o=>o.lastUpdated&&o.lastUpdated>=c).map(o=>({raceId:o.raceId,createdAt:o.lastUpdated||Date.now(),lastUpdated:o.lastUpdated||Date.now(),entryCount:o.entryCount})).slice(0,5);return s.forEach(o=>{ke(o.raceId,o.lastUpdated,o.entryCount)}),s}function at(e,t){const n=u("race-id-input");n&&(n.value=e.raceId,n.dispatchEvent(new Event("input",{bubbles:!0})),n.dispatchEvent(new Event("change",{bubbles:!0})),z()),t.style.display="none"}function F(e,t){le={exists:e,entryCount:t};const n=u("race-exists-indicator"),a=u("race-exists-text"),i=r.getState().currentLang;if(!(!n||!a)){if(e===null){n.style.display="none";return}if(n.style.display="inline-flex",n.classList.remove("found","new"),e)if(n.classList.add("found"),t>0){const c=t===1?l("entryInCloud",i):l("entriesInCloud",i);a.textContent=`${t} ${c}`}else a.textContent=l("raceFound",i);else n.classList.add("new"),a.textContent=l("raceNew",i)}}function it(){return le}function ct(){x&&(clearTimeout(x),x=null),b.removeAll()}const w=new k;function vt(){_e(st),Ye(),Fe(),w.add(window,"settings-language-changed",()=>{ot(),re()});const e=u("gps-toggle");e&&w.add(e,"change",()=>{r.updateSettings({gps:e.checked})});const t=u("auto-toggle");t&&w.add(t,"change",()=>{r.updateSettings({auto:t.checked})});const n=u("haptic-toggle");n&&w.add(n,"change",()=>{r.updateSettings({haptic:n.checked})});const a=u("sound-toggle");a&&w.add(a,"change",()=>{r.updateSettings({sound:a.checked})});const i=u("photo-toggle");i&&w.add(i,"change",()=>{r.updateSettings({photoCapture:i.checked})})}function St(){const e=r.getState(),{settings:t}=e;We(),Xe(),Ue();const n=u("gps-toggle"),a=u("auto-toggle"),i=u("haptic-toggle"),c=u("sound-toggle"),s=u("photo-toggle");n&&(n.checked=t.gps),a&&(a.checked=t.auto),i&&(i.checked=t.haptic),c&&(c.checked=t.sound),s&&(s.checked=t.photoCapture)}function ot(){const e=r.getState().currentLang;document.documentElement.lang=e,document.querySelectorAll("[data-i18n]").forEach(a=>{const i=a.getAttribute("data-i18n");i&&(a.textContent=l(i,e))}),document.querySelectorAll("[data-i18n-placeholder]").forEach(a=>{const i=a.getAttribute("data-i18n-placeholder");i&&(a.placeholder=l(i,e))}),document.querySelectorAll("[data-i18n-aria-label]").forEach(a=>{const i=a.getAttribute("data-i18n-aria-label");i&&a.setAttribute("aria-label",l(i,e))});const t=it();F(t.exists,t.entryCount);const n=document.getElementById("app-version-description");if(n){const a=qe("5.23.0");n.textContent=(a==null?void 0:a.description)??""}}function st(){document.querySelectorAll("[data-advanced]").forEach(n=>{n.style.display=""});const t=document.querySelector('[data-point="S"]');t&&(t.style.display=""),rt()}function rt(){const e=r.getState().settings,t=document.documentElement;e.glassEffects?(t.classList.remove("no-glass-effects"),document.querySelectorAll(".glass-enable-target").forEach(n=>{n.classList.add("glass-enabled")})):(t.classList.add("no-glass-effects"),document.querySelectorAll(".glass-enabled").forEach(n=>{n.classList.remove("glass-enabled")})),t.classList.add("no-motion-effects"),e.outdoorMode?t.classList.add("outdoor-mode"):t.classList.remove("outdoor-mode")}function kt(){ct(),Ke(),He(),w.removeAll()}export{ot as a,mt as b,gt as c,pt as d,kt as e,ft as f,It as g,U as h,se as i,st as j,rt as k,Ze as l,Ge as m,qe as n,vt as o,ht as p,Et as r,yt as s,St as u,ut as v};
