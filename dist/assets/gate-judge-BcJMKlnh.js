import{s as l,a as p,t as f,g as xt,e as v,b as et,L as G,m as yt,c as H,f as j,d as S,h as Nt,i as I,j as qt,k as Gt,l as jt,n as Ot,v as h,o as $,p as b,q as ct,r as Jt,u as mt}from"./chief-judge-riJEdY3M.js";const Vt="modulepreload",_t=function(t){return"/"+t},bt={},Ht=function(e,a,s){let o=Promise.resolve();if(a&&a.length>0){let n=function(d){return Promise.all(d.map(u=>Promise.resolve(u).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),r=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));o=n(a.map(d=>{if(d=_t(d),d in bt)return;bt[d]=!0;const u=d.endsWith(".css"),g=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${g}`))return;const m=document.createElement("link");if(m.rel=u?"stylesheet":Vt,u||(m.as="script"),m.crossOrigin="",m.href=d,r&&m.setAttribute("nonce",r),document.head.appendChild(m),u)return new Promise((A,L)=>{m.addEventListener("load",A),m.addEventListener("error",()=>L(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(n){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=n,window.dispatchEvent(c),!c.defaultPrevented)throw n}return o.then(n=>{for(const c of n||[])c.status==="rejected"&&i(c.reason);return e().catch(i)})},Pt=["a[href]","button:not([disabled])","textarea:not([disabled])","input:not([disabled])","select:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","),X=new WeakMap,Ut=new Set(["confirm-modal","fault-delete-modal","delete-race-confirm-modal","mark-deletion-modal","race-deleted-modal","onboarding-modal"]);function vt(t){return Array.from(t.querySelectorAll(Pt)).filter(e=>!e.hasAttribute("disabled")&&e.tabIndex!==-1)}function Wt(t){const e=vt(t);if(e.length>0){e[0].focus();return}t.hasAttribute("tabindex")||t.setAttribute("tabindex","-1"),t.focus()}function zt(t){const e=s=>{if(s.key==="Escape"){R(t);return}if(s.key!=="Tab")return;const o=vt(t);if(o.length===0){s.preventDefault();return}const i=o[0],n=o[o.length-1],c=document.activeElement;if(s.shiftKey){(!c||c===i||c===t)&&(s.preventDefault(),n.focus());return}c===n&&(s.preventDefault(),i.focus())};t.addEventListener("keydown",e);let a;Ut.has(t.id)||(a=s=>{s.target===t&&R(t)},t.addEventListener("click",a)),X.set(t,{previousFocus:document.activeElement,keydownHandler:e,clickOutsideHandler:a})}function Kt(t){const e=X.get(t);if(!e)return;t.removeEventListener("keydown",e.keydownHandler),e.clickOutsideHandler&&t.removeEventListener("click",e.clickOutsideHandler),X.delete(t);const a=e.previousFocus;a&&typeof a.focus=="function"&&a.focus()}const Q=new WeakMap;function R(t){if(!t||!t.classList.contains("show"))return;Kt(t),t.classList.add("closing");const e=setTimeout(()=>{Q.delete(t),t.classList.remove("show","closing")},150);Q.set(t,e)}function O(t){if(!t)return;const e=Q.get(t);e&&(clearTimeout(e),Q.delete(t),t.classList.remove("closing")),t.hasAttribute("role")||t.setAttribute("role","dialog"),t.setAttribute("aria-modal","true");const a=t.classList.contains("show");t.classList.add("show"),X.has(t)||zt(t),a||setTimeout(()=>Wt(t),0)}function Le(){document.querySelectorAll(".modal-overlay.show").forEach(t=>{R(t)})}function Xt(){return document.querySelectorAll(".modal-overlay.show").length>0}const rt=new WeakMap;function St(t,e){rt.set(t,e)}function Qt(t){return rt.get(t)??null}function ke(t){rt.delete(t)}const x=new G;let E=null;function lt(t,e,a){const s=l.getState(),o={id:`fault-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,bib:t,run:s.selectedRun,gateNumber:e,faultType:a,timestamp:new Date().toISOString(),deviceId:s.deviceId,deviceName:s.deviceName,gateRange:s.gateAssignment||[1,1]};l.addFaultEntry(o),Nt();const i=l.getState().faultEntries.find(n=>n.id===o.id);i&&(H(i).catch(()=>{}),Yt(i)),p(f("faultRecorded",s.currentLang),"success")}function Yt(t){const e=document.getElementById("fault-confirmation-overlay");if(!e)return;St(e,{faultId:t.id});const a=e.querySelector(".fault-confirmation-bib"),s=e.querySelector(".fault-confirmation-gate"),o=e.querySelector(".fault-confirmation-type"),i=l.getState();a&&(a.textContent=t.bib),s&&(s.textContent=`${f("gate",i.currentLang)} ${t.gateNumber}`),o&&(o.textContent=et(t.faultType,i.currentLang)),e.classList.add("show"),e.setAttribute("aria-hidden","false");const n=e.querySelector("#fault-confirmation-done-btn");n&&n.focus()}function $e(){const t=document.getElementById("save-fault-edit-btn");t&&x.add(t,"click",Zt);const e=document.getElementById("restore-version-btn");e&&x.add(e,"click",te);const a=document.getElementById("fault-edit-bib-input");a&&yt(a,3);const s=document.getElementById("fault-edit-run-selector");s&&x.add(s,"click",r=>{const u=r.target.closest(".edit-run-btn");u&&s.querySelectorAll(".edit-run-btn").forEach(g=>{g.classList.toggle("active",g===u),g.setAttribute("aria-checked",g===u?"true":"false")})});const o=document.getElementById("fault-edit-notes"),i=document.getElementById("fault-edit-notes-char-count");o&&i&&x.add(o,"input",()=>{const r=o.value.length;i.textContent=`${r}/500`,i.classList.toggle("near-limit",r>450)});const n=document.getElementById("fault-edit-mic-btn");n&&x.add(n,"click",()=>{window.dispatchEvent(new CustomEvent("fault-edit-mic-click",{detail:{faultId:E}}))});const c=document.getElementById("confirm-mark-deletion-btn");c&&x.add(c,"click",ee)}function we(t){if(t.markedForDeletion){const m=l.getState().currentLang;p(f("cannotEditPendingDeletion",m),"warning");return}const e=document.getElementById("fault-edit-modal");if(!e)return;E=t.id;const s=l.getState().currentLang,o=document.getElementById("fault-edit-bib-input"),i=document.getElementById("fault-edit-gate-input"),n=document.getElementById("fault-edit-type-select"),c=document.getElementById("fault-edit-gate-range"),r=document.getElementById("fault-version-select"),d=document.getElementById("fault-edit-notes"),u=document.getElementById("fault-edit-notes-char-count");if(o&&(o.value=t.bib||""),i&&(i.value=String(t.gateNumber)),n&&(n.value=t.faultType),d&&(d.value=t.notes||""),u){const m=(t.notes||"").length;u.textContent=`${m}/500`}c&&t.gateRange&&(c.textContent=`(${f("gates",s)} ${t.gateRange[0]}-${t.gateRange[1]})`);const g=document.getElementById("fault-edit-run-selector");if(g&&g.querySelectorAll(".edit-run-btn").forEach(m=>{const A=m.getAttribute("data-run");m.classList.toggle("active",A===String(t.run))}),r){r.innerHTML="";const m=document.createElement("option");m.value=String(t.currentVersion||1),m.textContent=`v${t.currentVersion||1} - ${f("currentVersion",s)}`,r.appendChild(m);const L=[...t.versionHistory||[]].sort((y,M)=>M.version-y.version).filter(y=>y.version!==t.currentVersion);for(const y of L){const M=document.createElement("option");M.value=String(y.version);const ft=new Date(y.timestamp).toLocaleTimeString(xt(s),{hour:"2-digit",minute:"2-digit"}),C=y.changeType==="create"?f("originalVersion",s):y.changeType==="restore"?f("restored",s):y.editedBy;M.textContent=`v${y.version} - ${C} (${ft})`,r.appendChild(M)}}O(e)}function Zt(){if(!E)return;const t=l.getState(),e=t.faultEntries.find(C=>C.id===E);if(!e)return;const a=document.getElementById("fault-edit-bib-input"),s=document.getElementById("fault-edit-gate-input"),o=document.getElementById("fault-edit-type-select"),i=document.getElementById("fault-edit-run-selector"),n=document.getElementById("fault-edit-notes"),c=(a==null?void 0:a.value)||"",r=c?c.padStart(3,"0"):e.bib,d=parseInt((s==null?void 0:s.value)||String(e.gateNumber),10),u=(o==null?void 0:o.value)||e.faultType,g=(n==null?void 0:n.value.trim().slice(0,500))||"",m=t.currentLang;e.gateRange&&(d<e.gateRange[0]||d>e.gateRange[1])&&p(f("gateOutOfRange",m),"warning");const A=i==null?void 0:i.querySelector(".edit-run-btn.active"),L=A?parseInt(A.getAttribute("data-run")||"1",10):e.run,y=[];if(r!==e.bib&&y.push(`bib: ${e.bib} → ${r}`),d!==e.gateNumber&&y.push(`gate: ${e.gateNumber} → ${d}`),u!==e.faultType&&y.push(`type: ${e.faultType} → ${u}`),L!==e.run&&y.push(`run: ${e.run} → ${L}`),g!==(e.notes||"")){const C=g?`notes: ${g.slice(0,30)}${g.length>30?"...":""}`:"notes removed";y.push(C)}const M=y.length>0?y.join(", "):void 0,J={bib:r,gateNumber:d,faultType:u,run:L};if(g!==(e.notes||"")&&(J.notes=g||void 0,J.notesSource=g?"manual":void 0,J.notesTimestamp=g?new Date().toISOString():void 0),l.updateFaultEntryWithHistory(E,J,M)){const C=l.getState().faultEntries.find(Dt=>Dt.id===E);C&&H(C).catch(()=>{}),p(f("saved",m),"success"),j()}R(document.getElementById("fault-edit-modal")),E=null}function te(){if(!E)return;const t=document.getElementById("fault-version-select"),e=parseInt((t==null?void 0:t.value)||"0",10);if(!e)return;const a=l.getState(),s=a.faultEntries.find(i=>i.id===E);if(s&&e===s.currentVersion)return;if(l.restoreFaultVersion(E,e)){const i=l.getState().faultEntries.find(c=>c.id===E);i&&H(i).catch(()=>{});const n=a.currentLang;p(f("versionRestored",n),"success"),j(),R(document.getElementById("fault-edit-modal")),E=null}}function Te(t){const e=document.getElementById("mark-deletion-modal");if(!e)return;E=t.id;const s=l.getState().currentLang,o=document.getElementById("mark-deletion-details");o&&(o.innerHTML=`
      <div>#${v(t.bib.padStart(3,"0"))} T${v(String(t.gateNumber))} (${v(et(t.faultType,s))}) - ${v(f(t.run===1?"run1":"run2",s))}</div>
    `),O(e)}function ee(){if(!E)return;if(l.markFaultForDeletion(E)){const e=l.getState().faultEntries.find(s=>s.id===E);e&&H(e).catch(()=>{});const a=l.getState().currentLang;p(f("markedForDeletion",a),"info"),S()}R(document.getElementById("mark-deletion-modal")),E=null}const k=new G;let w="",T=0,q=null,st=!1,ot=!1,it=!1;function Et(){const t=document.getElementById("inline-bib-input");t&&(t.classList.remove("bib-auto-filled"),t.offsetWidth,t.classList.add("bib-auto-filled"))}function nt(){const t=document.getElementById("active-bibs-list"),e=document.getElementById("no-active-bibs");if(!t)return;const a=l.getState(),s=l.getActiveBibs(a.selectedRun);if(t.querySelectorAll(".active-bib-card").forEach(n=>n.remove()),s.length===0){e&&(e.style.display="");return}e&&(e.style.display="none");const o=new Map;a.entries.forEach(n=>{n.point==="S"&&n.run===a.selectedRun&&o.set(n.bib,new Date(n.timestamp))}),[...s].sort((n,c)=>{var u,g;const r=((u=o.get(n))==null?void 0:u.getTime())||0;return(((g=o.get(c))==null?void 0:g.getTime())||0)-r}).forEach(n=>{const c=o.get(n),r=l.getFaultsForBib(n,a.selectedRun),d=r.length>0,u=document.createElement("div");u.className=`active-bib-card${d?" has-fault":""}`,u.setAttribute("data-bib",I(n)),u.setAttribute("role","listitem");const g=c?jt(c):"--:--:--";u.innerHTML=`
      <div class="bib-card-info">
        <span class="bib-card-number">${v(n)}</span>
        <span class="bib-card-time">${v(g)}</span>
        ${d?`<span class="bib-fault-indicator">${r.length} ${f("faultCount",a.currentLang)}</span>`:""}
      </div>
      <div class="bib-card-actions">
        <button class="bib-action-btn fault" data-action="fault" aria-label="${I(f("recordFault",a.currentLang))}">${f("faultMGShort",a.currentLang)}</button>
        <button class="bib-action-btn ok" data-action="ok" aria-label="${I(f("markOk",a.currentLang))}">${f("ok",a.currentLang)}</button>
      </div>
    `,t.appendChild(u)}),!ot&&(ot=!0,k.add(t,"click",n=>{const c=n.target,r=c.closest(".bib-action-btn"),d=c.closest(".active-bib-card");if(!d)return;const u=d.getAttribute("data-bib");if(u&&r){const g=r.getAttribute("data-action");g==="fault"?(S(),Ht(async()=>{const{openFaultRecordingModal:m}=await Promise.resolve().then(()=>de);return{openFaultRecordingModal:m}},void 0).then(({openFaultRecordingModal:m})=>{m(u)})):g==="ok"&&(S(),p(f("ok",l.getState().currentLang),"success",1e3))}}))}function ht(){const t=document.getElementById("gate-judge-faults-list"),e=document.getElementById("inline-fault-count"),a=document.getElementById("no-faults-recorded-inline");if(!t)return;const s=l.getState(),o=s.currentLang,i=s.faultEntries.filter(c=>c.run===s.selectedRun&&!c.markedForDeletion);if(e&&(e.textContent=String(i.length),e.setAttribute("data-count",String(i.length))),t.querySelectorAll(".gate-judge-fault-item").forEach(c=>c.remove()),i.length===0){a&&(a.style.display="");return}a&&(a.style.display="none"),[...i].sort((c,r)=>new Date(r.timestamp).getTime()-new Date(c.timestamp).getTime()).forEach(c=>{const r=l.getGateColor(c.gateNumber),d=c.notes&&c.notes.length>0,u=document.createElement("div");u.className="gate-judge-fault-item",u.setAttribute("data-fault-id",c.id),u.innerHTML=`
      <div class="gate-judge-fault-info">
        <span class="gate-judge-fault-bib">${v(c.bib)}</span>
        <div class="gate-judge-fault-details">
          <span class="gate-judge-fault-gate ${v(r)}">T${v(String(c.gateNumber))}</span>
          <span class="gate-judge-fault-type">${v(et(c.faultType,o))}</span>
          ${d?`<span class="gate-judge-fault-note-icon" title="${I(f("hasNote",o))}" aria-label="${I(f("hasNote",o))}">${qt(14)}</span>`:""}
        </div>
      </div>
      <button class="gate-judge-fault-delete" aria-label="${I(f("deleteLabel",o))}">
        ${Gt(18)}
      </button>
    `,t.appendChild(u)}),!it&&(it=!0,k.add(t,"click",c=>{const d=c.target.closest(".gate-judge-fault-delete");if(!d)return;c.stopPropagation(),S();const u=d.closest(".gate-judge-fault-item"),g=u==null?void 0:u.getAttribute("data-fault-id");if(!g)return;const m=l.getState().faultEntries.find(A=>A.id===g);m&&le(m)}))}function ne(){const t=l.getState(),e=l.getActiveBibs(t.selectedRun);!w&&e.length>0&&(w=e[0],Et());const a=document.getElementById("inline-bib-input");a&&w&&(a.value=w),F()}function ae(t){w=t;const e=document.getElementById("inline-bib-input");e&&(e.value=t),F()}function se(){const t=document.getElementById("inline-gate-selector");if(!t)return;const e=l.getState(),a=e.currentLang,[s,o]=e.gateAssignment||[1,10];t.innerHTML="";const i=new Map;e.faultEntries.forEach(n=>{n.run===e.selectedRun&&!n.markedForDeletion&&i.set(n.gateNumber,(i.get(n.gateNumber)||0)+1)});for(let n=s;n<=o;n++){const c=l.getGateColor(n),r=i.get(n)||0,d=document.createElement("button");if(d.className=`gate-grid-btn ${c}`,d.setAttribute("data-gate",String(n)),d.setAttribute("role","radio"),d.setAttribute("aria-checked",String(n===T)),d.setAttribute("aria-label",`${f("gateNumberLabel",a)} ${n}${r?` (${r})`:""}`),d.textContent=String(n),r>0){const u=document.createElement("span");u.className="gate-fault-count",u.textContent=String(r),u.setAttribute("aria-hidden","true"),d.appendChild(u)}n===T&&d.classList.add("selected"),t.appendChild(d)}st||(st=!0,k.add(t,"click",n=>{const c=n.target.closest(".gate-grid-btn");if(!c)return;const r=Number(c.getAttribute("data-gate"));r&&(S(),at(r))}),k.add(t,"keydown",(n=>{const c=n.target.closest(".gate-grid-btn");if(!c)return;const r=Number(c.getAttribute("data-gate"));if(!r)return;const d=Array.from(t.querySelectorAll(".gate-grid-btn")),u=d.indexOf(c);switch(n.key){case" ":case"Enter":n.preventDefault(),S(),at(r);break;case"ArrowLeft":n.preventDefault(),u>0&&d[u-1].focus();break;case"ArrowRight":n.preventDefault(),u<d.length-1&&d[u+1].focus();break;case"ArrowUp":n.preventDefault(),u>=5&&d[u-5].focus();break;case"ArrowDown":n.preventDefault(),u+5<d.length&&d[u+5].focus();break;default:if(/^[0-9]$/.test(n.key)){n.preventDefault();const g=n.key==="0"?10:parseInt(n.key,10);if(g>=s&&g<=o){const m=t.querySelector(`[data-gate="${g}"]`);m&&(S(),at(g),m.focus())}}}})))}function at(t){if(T===t){T=0,At(),F(),document.querySelectorAll("#inline-gate-selector .gate-grid-btn").forEach(a=>{a.classList.remove("selected"),a.setAttribute("aria-checked","false")});return}T=t,document.querySelectorAll("#inline-gate-selector .gate-grid-btn").forEach(a=>{const s=a.getAttribute("data-gate")===String(t);a.classList.toggle("selected",s),a.setAttribute("aria-checked",String(s))}),oe(t),w||ie(),F()}function oe(t){const e=document.getElementById("fault-detail-panel"),a=document.getElementById("fault-detail-gate-label");if(!e)return;const o=l.getState().currentLang,i=l.getGateColor(t);a&&(a.textContent=`${f("gate",o)} ${t}`,a.style.color=i==="red"?"var(--error)":"var(--primary)"),e.style.display=""}function At(){const t=document.getElementById("fault-detail-panel");t&&(t.style.display="none")}function ie(){const t=l.getState(),e=l.getActiveBibs(t.selectedRun);if(e.length===0)return;const a=new Map;t.entries.forEach(o=>{o.point==="S"&&o.run===t.selectedRun&&a.set(o.bib,new Date(o.timestamp).getTime())});const s=[...e].sort((o,i)=>(a.get(i)||0)-(a.get(o)||0));ae(s[0]),Et()}function ce(){k.removeAll(),st=!1,ot=!1,it=!1;const t=document.getElementById("inline-bib-input");t&&(yt(t,3),k.add(t,"input",()=>{t.value&&(w=t.value.padStart(3,"0"),F())}));const e=document.getElementById("fault-detail-close");e&&k.add(e,"click",()=>{T=0,q=null,At(),document.querySelectorAll("#inline-gate-selector .gate-grid-btn").forEach(o=>{o.classList.remove("selected"),o.setAttribute("aria-checked","false")}),document.querySelectorAll("#inline-fault-types .inline-fault-type-btn").forEach(o=>{o.classList.remove("selected"),o.setAttribute("aria-pressed","false")}),F()});const a=document.getElementById("inline-fault-types");if(a){const o=i=>{S(),q=i.getAttribute("data-fault"),a.querySelectorAll(".inline-fault-type-btn").forEach(c=>{c.classList.toggle("selected",c===i),c.setAttribute("aria-pressed",String(c===i))}),F()};k.add(a,"click",i=>{const c=i.target.closest(".inline-fault-type-btn");c&&o(c)}),k.add(a,"keydown",i=>{const n=i,r=n.target.closest(".inline-fault-type-btn");if(r&&(n.key===" "||n.key==="Enter")){n.preventDefault(),o(r);return}const d=n.key.toUpperCase();let u=null;switch(d){case"M":case"G":u="MG";break;case"T":u="STR";break;case"B":case"R":u="BR";break}if(u){n.preventDefault();const g=a.querySelector(`[data-fault="${u}"]`);g&&(o(g),g.focus())}})}const s=document.getElementById("inline-save-fault-btn");s&&k.add(s,"click",re)}function F(){const t=document.getElementById("inline-save-fault-btn");if(t){const e=w&&T>0&&q;t.disabled=!e}}function re(){const t=l.getState().currentLang;if(!w){p(f("selectBib",t),"warning");return}if(!T){p(f("selectGate",t),"warning");return}if(!q){p(f("selectFaultType",t),"warning");return}lt(w,T,q),q=null,document.querySelectorAll("#inline-fault-types .inline-fault-type-btn").forEach(e=>{e.classList.remove("selected"),e.setAttribute("aria-pressed","false")}),Y()}function le(t){const e=document.getElementById("fault-delete-modal");if(!e){l.markFaultForDeletion(t.id);const i=l.getState().faultEntries.find(n=>n.id===t.id);i&&Ot(i).catch(()=>{}),ht(),p(f("faultDeleted",l.getState().currentLang),"success");return}St(e,{faultId:t.id});const a=l.getState(),s=l.getGateColor(t.gateNumber),o=e.querySelector(".delete-fault-info");o&&(o.innerHTML=`
      <strong>#${v(t.bib)}</strong> -
      <span class="fault-gate ${I(s)}">T${v(String(t.gateNumber))}</span>
      (${v(et(t.faultType,a.currentLang))}) -
      ${v(f(t.run===1?"run1":"run2",a.currentLang))}
    `),O(e)}function Y(){ht(),ne(),se(),F()}const P=new G;function ue(t){const e=l.getState(),a=e.currentLang,s=l.getActiveBibs(e.selectedRun);P.removeAll();const o=document.getElementById("fault-bib-selector");o&&(o.innerHTML=s.map(r=>`
      <button class="fault-bib-btn ${r===t?"selected":""}" data-bib="${I(r)}" aria-label="${I(f("selectBib",a))} ${I(r)}">${v(r)}</button>
    `).join(""),o.querySelectorAll(".fault-bib-btn").forEach(r=>{P.add(r,"click",()=>{o.querySelectorAll(".fault-bib-btn").forEach(u=>u.classList.remove("selected")),r.classList.add("selected");const d=document.getElementById("fault-bib-input");d&&(d.value=""),l.setSelectedFaultBib(r.getAttribute("data-bib")||"")})}));const i=document.getElementById("fault-bib-input");i&&(i.value=t||"",P.add(i,"input",()=>{o==null||o.querySelectorAll(".fault-bib-btn").forEach(r=>r.classList.remove("selected")),l.setSelectedFaultBib(i.value?i.value.padStart(3,"0"):"")})),l.setSelectedFaultBib(t||"");const n=document.getElementById("fault-gate-selector");if(n&&e.gateAssignment){const[r,d]=e.gateAssignment;let u="";for(let g=r;g<=d;g++){const A=l.getGateColor(g)==="red"?"gate-red":"gate-blue";u+=`<button class="fault-gate-btn ${A}" data-gate="${g}" aria-label="${I(f("gateNumberLabel",a))} ${g}">${g}</button>`}n.innerHTML=u,n.querySelectorAll(".fault-gate-btn").forEach(g=>{P.add(g,"click",()=>{n.querySelectorAll(".fault-gate-btn").forEach(m=>m.classList.remove("selected")),g.classList.add("selected")})})}const c=document.getElementById("fault-type-buttons");c&&c.querySelectorAll(".fault-type-btn").forEach(r=>{r.classList.remove("selected")}),O(document.getElementById("fault-modal"))}const U=new G;function Bt(){U.removeAll();const t=document.getElementById("fault-type-buttons");if(t){const a=s=>{const o=t.querySelector(`[data-fault="${s}"]`);o&&(t.querySelectorAll(".fault-type-btn").forEach(i=>{i.classList.remove("selected"),i.setAttribute("aria-pressed","false")}),o.classList.add("selected"),o.setAttribute("aria-pressed","true"),S())};U.add(t,"click",s=>{const i=s.target.closest(".fault-type-btn");if(!i)return;const n=i.getAttribute("data-fault");n&&a(n)}),U.add(t,"keydown",(s=>{const i=s.target.closest(".fault-type-btn");if(i&&(s.key===" "||s.key==="Enter")){s.preventDefault();const c=i.getAttribute("data-fault");c&&a(c);return}const n=s.key.toUpperCase();n==="M"||n==="G"?(s.preventDefault(),a("MG")):n==="T"?(s.preventDefault(),a("STR")):(n==="B"||n==="R")&&(s.preventDefault(),a("BR"))}))}const e=document.getElementById("save-fault-btn");e&&U.add(e,"click",()=>{const a=document.querySelector("#fault-type-buttons .fault-type-btn.selected");if(!a){const o=l.getState().currentLang;p(f("selectFaultType",o),"warning");return}const s=a.getAttribute("data-fault");s&&It(s)})}function It(t){const e=l.getState();let a=e.selectedFaultBib;if(!a){const i=document.getElementById("fault-bib-input"),n=(i==null?void 0:i.value)||"";a=n?n.padStart(3,"0"):""}if(!a){p(f("selectBib",e.currentLang),"warning");return}const s=document.querySelector("#fault-gate-selector .fault-gate-btn.selected"),o=s?parseInt(s.getAttribute("data-gate")||"0",10):0;if(!o){p(f("selectGate",e.currentLang),"warning");return}lt(a,o,t),R(document.getElementById("fault-modal")),nt()}function Lt(t,e,a){const s=l.getState();if(s.gateAssignment){const[o,i]=s.gateAssignment;if(e<o||e>i){p(f("gateOutOfRange",s.currentLang),"warning");return}}lt(t.padStart(3,"0"),e,a),nt()}const de=Object.freeze(Object.defineProperty({__proto__:null,initFaultRecordingModal:Bt,openFaultRecordingModal:ue,recordFault:It,recordFaultFromVoice:Lt},Symbol.toStringTag,{value:"Module"})),B=new G;let N=null,_="",z=null,K=null,pt=null;const Z=500;function ge(t){const e=document.getElementById("voice-note-modal");if(!e)return;N=t,_="";const s=l.getState().faultEntries.find(n=>n.id===t),o=document.getElementById("voice-note-textarea");o&&(o.value=(s==null?void 0:s.notes)||"",dt());const i=document.getElementById("voice-note-mic-btn");i&&(i.classList.toggle("unsupported",!h.isSupported()),i.classList.remove("loading")),ut(!1),h.isSupported()&&h.initialize(),O(e),requestAnimationFrame(()=>o==null?void 0:o.focus())}function V(){h.stop(),kt(),N=null,_="",R(document.getElementById("voice-note-modal")),$.resume()}function fe(){if(!N)return;const t=document.getElementById("voice-note-textarea"),e=(t==null?void 0:t.value.trim().slice(0,Z))||"",a=l.getState();if(!a.faultEntries.find(c=>c.id===N))return;const o=_?"voice":"manual",i=e?`notes: ${e.slice(0,30)}${e.length>30?"...":""}`:"notes removed";if(l.updateFaultEntryWithHistory(N,{notes:e||void 0,notesSource:e?o:void 0,notesTimestamp:e?new Date().toISOString():void 0},i)){const c=l.getState().faultEntries.find(d=>d.id===N);c&&H(c).catch(()=>{});const r=a.currentLang;p(f("noteSaved",r),"success"),j()}V()}function me(){const t=l.getState().currentLang;if(!h.isSupported()){p(f("voiceNoteUnsupported",t),"warning");return}const e=document.getElementById("voice-note-mic-btn");e==null||e.classList.add("loading"),$.pause(),z=h.onStatusChange(s=>{e==null||e.classList.remove("loading"),ut(s==="listening"),s==="error"&&(p(f("voiceNoteError",t),"warning"),$.resume())}),K=h.onTranscript((s,o)=>{const i=document.getElementById("voice-note-textarea");if(i&&o){_+=(_?" ":"")+s;const n=i.value,c=n?`${n} ${s}`:s;i.value=c.slice(0,Z),dt()}}),h.start()?S():(e==null||e.classList.remove("loading"),$.resume())}function be(){h.stop(),kt(),ut(!1),$.resume()}function pe(){h.isRecording()?be():me()}function ut(t){const e=document.getElementById("voice-note-listening-indicator"),a=document.getElementById("voice-note-mic-btn");e&&e.classList.toggle("active",t),a&&(a.classList.toggle("recording",t),a.setAttribute("aria-pressed",String(t)))}function dt(){const t=document.getElementById("voice-note-textarea"),e=document.getElementById("voice-note-char-count");if(t&&e){const a=t.value.length;e.textContent=`${a}/${Z}`,e.classList.toggle("near-limit",a>Z*.9)}}function kt(){z&&(z(),z=null),K&&(K(),K=null)}function ye(){const t=document.getElementById("voice-note-modal"),e=document.getElementById("voice-note-mic-btn");e&&B.add(e,"click",pe);const a=document.getElementById("voice-note-save-btn");a&&B.add(a,"click",fe);const s=document.getElementById("voice-note-cancel-btn");s&&B.add(s,"click",V);const o=document.getElementById("voice-note-close-btn");o&&B.add(o,"click",V);const i=document.getElementById("voice-note-textarea");i&&B.add(i,"input",dt),t&&(B.add(t,"keydown",(n=>{n.key==="Escape"&&(n.preventDefault(),V())})),B.add(t,"click",n=>{n.target===t&&V()}))}function W(){const t=document.getElementById("fault-confirmation-overlay");t!=null&&t.classList.contains("show")&&(t.classList.remove("show"),t.setAttribute("aria-hidden","true"))}function ve(){const t=document.getElementById("fault-confirmation-overlay"),e=t==null?void 0:t.querySelector(".fault-confirmation-content"),a=document.getElementById("fault-confirmation-add-note-btn");a&&B.add(a,"click",()=>{var i;S();const o=t?((i=Qt(t))==null?void 0:i.faultId)||t.getAttribute("data-fault-id"):void 0;W(),o&&ge(o)});const s=document.getElementById("fault-confirmation-done-btn");s&&B.add(s,"click",()=>{S(),W()}),t&&e&&B.add(t,"click",o=>{o.target===t&&(S(),W())}),t&&B.add(document,"keydown",(o=>{o.key==="Escape"&&t.classList.contains("show")&&!Xt()&&(o.preventDefault(),W())}))}function Se(){let t=!1,e=null,a=null;const s=()=>{e&&(e(),e=null),a&&(a(),a=null)};B.add(window,"fault-edit-mic-click",()=>{const i=l.getState().currentLang,n=document.getElementById("fault-edit-mic-btn"),c=document.getElementById("fault-edit-notes"),r=document.getElementById("fault-edit-notes-char-count");if(!h.isSupported()){p(f("voiceNoteUnsupported",i),"warning");return}if(t){h.stop(),s(),t=!1,n==null||n.classList.remove("recording"),n==null||n.setAttribute("aria-pressed","false"),$.resume();return}$.pause(),e=h.onStatusChange(u=>{u==="error"&&(p(f("voiceNoteError",i),"warning"),s(),t=!1,n==null||n.classList.remove("recording"),n==null||n.setAttribute("aria-pressed","false"),$.resume())}),a=h.onTranscript((u,g)=>{if(g&&c){const m=c.value,A=m?`${m} ${u}`:u;if(c.value=A.slice(0,500),r){const L=c.value.length;r.textContent=`${L}/500`,r.classList.toggle("near-limit",L>450)}}}),h.start()?(t=!0,n==null||n.classList.add("recording"),n==null||n.setAttribute("aria-pressed","true"),S()):$.resume()});const o=document.getElementById("fault-edit-modal");o&&(pt=new MutationObserver(i=>{for(const n of i)if(n.type==="attributes"&&n.attributeName==="class"&&!(o.classList.contains("show")||o.style.display!=="none")&&t){h.stop(),s(),t=!1;const r=document.getElementById("fault-edit-mic-btn");r==null||r.classList.remove("recording"),r==null||r.setAttribute("aria-pressed","false"),$.resume()}}),pt.observe(o,{attributes:!0}))}function Ee(){ye(),ve(),Se()}const D=new G;function $t(){const t=b("timer-tab"),e=b("gate-judge-tab"),a=document.querySelector(".tab-bar"),o=l.getState().deviceRole==="gateJudge";t&&(t.style.display=o?"none":""),e&&(e.style.display=o?"":"none"),a&&a.classList.toggle("gate-judge-mode",o)}function he(){D.removeAll(),window.dispatchEvent(new CustomEvent("update-role-toggle")),$t();const t=b("gate-change-btn");t&&D.add(t,"click",()=>{S(),wt()});const e=b("gate-judge-run-selector");e&&D.add(e,"click",(s=>{const i=s.target.closest(".run-btn");if(!i)return;const n=i.getAttribute("data-run"),c=n?parseInt(n,10):1;l.setSelectedRun(c),S(),e.querySelectorAll(".run-btn").forEach(r=>{r.classList.toggle("active",r===i),r.setAttribute("aria-checked",r===i?"true":"false")}),nt(),Y()}));const a=b("ready-toggle-btn");a&&(D.add(a,"click",()=>{const s=l.getState(),o=!s.isJudgeReady;l.setJudgeReady(o),j(),tt();const i=s.currentLang;p(o?f("judgeReady",i):f("judgeNotReady",i),"success")}),tt()),Tt(),Bt(),ce(),Y(),Ee(),gt()}function wt(){const t=l.getState(),e=b("gate-start-input"),a=b("gate-end-input");e&&a&&(t.gateAssignment?(e.value=String(t.gateAssignment[0]),a.value=String(t.gateAssignment[1])):(e.value="1",a.value="10"));const s=b("gate-color-selector");s&&s.querySelectorAll(".gate-color-btn").forEach(o=>{const n=o.getAttribute("data-color")===t.firstGateColor;o.classList.toggle("active",n),o.setAttribute("aria-checked",String(n))}),O(b("gate-assignment-modal"))}function Tt(){const t=b("gate-color-selector");t&&D.add(t,"click",(a=>{const s=a.target.closest(".gate-color-btn");s&&(t.querySelectorAll(".gate-color-btn").forEach(o=>{o.classList.remove("active"),o.setAttribute("aria-checked","false")}),s.classList.add("active"),s.setAttribute("aria-checked","true"),S())}));const e=b("save-gate-assignment-btn");e&&D.add(e,"click",()=>{const a=b("gate-start-input"),s=b("gate-end-input");if(!a||!s)return;const o=parseInt(a.value,10)||1,i=parseInt(s.value,10)||10,n=Math.min(o,i),c=Math.max(o,i),r=document.querySelector("#gate-color-selector .gate-color-btn.active"),d=(r==null?void 0:r.getAttribute("data-color"))||"red";l.setGateAssignment([n,c]),l.setFirstGateColor(d),gt(),R(b("gate-assignment-modal")),j();const u=l.getState().currentLang;p(f("saved",u),"success")})}function gt(){const t=b("gate-range-display"),e=b("gate-color-indicator"),a=b("gate-color-text");if(!t)return;const s=l.getState();if(s.gateAssignment?t.textContent=`${s.gateAssignment[0]}–${s.gateAssignment[1]}`:t.textContent="--",e&&a){const o=s.currentLang,i=s.firstGateColor==="red"?"colorRed":"colorBlue";a.textContent=`${f("firstGateLabel",o)}: ${f(i,o)}`,e.classList.toggle("red",s.firstGateColor==="red"),e.classList.toggle("blue",s.firstGateColor==="blue")}Rt()}function Rt(){const t=b("other-judges-coverage"),e=b("other-judges-list");if(!t||!e)return;if(!l.getState().settings.sync){t.style.display="none";return}const s=ct.getOtherGateAssignments();if(s.length===0){t.style.display="none";return}t.style.display="flex";const o=l.getState().currentLang;e.innerHTML=s.map(i=>`
    <div class="coverage-badge ${i.isReady?"ready":""}" title="${I(`${i.deviceName}${i.isReady?f("readySuffix",o):""}`)}">
      ${i.isReady?`<span class="ready-check" aria-hidden="true">${Jt(14)}</span>`:""}
      <span class="device-name">${v(i.deviceName.slice(0,15))}</span>
      <span class="gate-range">${v(String(i.gateStart))}–${v(String(i.gateEnd))}</span>
    </div>
  `).join(""),Ct(s),Ft()}function tt(){const t=b("ready-toggle-btn");if(!t)return;const e=l.getState();t.classList.toggle("ready",e.isJudgeReady),t.setAttribute("aria-pressed",String(e.isJudgeReady))}function Ct(t){const e=b("judges-ready-indicator"),a=b("judges-ready-count");if(!e||!a)return;const s=l.getState();if(!s.settings.sync){e.style.display="none";return}const o=t||ct.getOtherGateAssignments();let i=o.length,n=o.filter(r=>r.isReady).length;if(s.deviceRole==="gateJudge"&&s.gateAssignment&&(i++,s.isJudgeReady&&n++),i===0){e.style.display="none";return}e.style.display="flex",a.textContent=`${n}/${i}`;const c=l.getState().currentLang;e.setAttribute("aria-label",`${f("judgesReadyCount",c)}: ${n}/${i}`),e.classList.toggle("all-ready",n===i&&i>0)}function Ft(){const t=b("gps-indicator"),e=b("judge-ready-indicator");if(!e)return;const a=l.getState(),s=a.deviceRole==="gateJudge";if(t&&(t.style.display=!s&&a.settings.gps?"flex":"none"),!s){e.style.display="none";return}e.style.display="flex";const o=ct.getOtherGateAssignments();let i=o.length,n=o.filter(c=>c.isReady).length;a.gateAssignment&&(i++,a.isJudgeReady&&n++),e.classList.remove("none-ready","some-ready","all-ready"),n===0||i===0?e.classList.add("none-ready"):n===i?e.classList.add("all-ready"):e.classList.add("some-ready")}function Mt(){const t=l.getState(),e=b("gate-judge-run-selector");e&&e.querySelectorAll(".run-btn").forEach(a=>{const s=a.getAttribute("data-run")===String(t.selectedRun);a.classList.toggle("active",s),a.setAttribute("aria-checked",String(s))})}function Ae(t){var e,a,s,o;switch(mt.debug("[GateJudgeView] Voice intent:",t.action,t.params),t.action){case"record_fault":(e=t.params)!=null&&e.bib&&((a=t.params)==null?void 0:a.gate)!==void 0&&((s=t.params)!=null&&s.faultType)&&Lt(t.params.bib,t.params.gate,t.params.faultType);break;case"toggle_ready":{const i=l.getState(),n=!i.isJudgeReady;l.setJudgeReady(n),j(),tt();const c=i.currentLang;p(n?f("judgeReady",c):f("judgeNotReady",c),"success");break}case"set_run":(o=t.params)!=null&&o.run&&(l.setSelectedRun(t.params.run),Mt(),nt(),Y(),S());break;default:mt.debug("[GateJudgeView] Unhandled voice intent:",t.action)}}function Be(){D.removeAll()}const Re=Object.freeze(Object.defineProperty({__proto__:null,cleanupGateJudgeView:Be,handleGateJudgeVoiceIntent:Ae,initGateAssignmentModal:Tt,initGateJudgeView:he,openGateAssignmentModal:wt,updateGateJudgeRunSelection:Mt,updateGateJudgeTabVisibility:$t,updateGateRangeDisplay:gt,updateJudgeReadyStatus:Ft,updateJudgesReadyIndicator:Ct,updateOtherJudgesCoverage:Rt,updateReadyButtonState:tt},Symbol.toStringTag,{value:"Module"}));export{Ht as _,we as a,Te as b,R as c,ht as d,ke as e,Le as f,Qt as g,Ft as h,$e as i,nt as j,gt as k,Mt as l,Ae as m,ne as n,O as o,se as p,Xt as q,Y as r,St as s,Re as t,$t as u};
