{"version":3,"file":"main-Blbf_JA9.js","sources":["../../src/utils/id.ts","../../src/types/index.ts","../../src/utils/validation.ts","../../src/store/index.ts","../../src/utils/format.ts","../../src/services/camera.ts","../../src/services/sync.ts","../../src/services/gps.ts","../../src/services/feedback.ts","../../src/components/Clock.ts","../../src/components/VirtualList.ts","../../src/components/Toast.ts","../../src/components/PullToRefresh.ts","../../src/i18n/translations.ts","../../src/app.ts","../../src/main.ts"],"sourcesContent":["/**\n * Generate a unique entry ID using UUID v4 + timestamp\n * Format: {deviceId}-{timestamp}-{random}\n * This prevents collisions across devices even with simultaneous entries\n */\nexport function generateEntryId(deviceId: string): string {\n  const timestamp = Date.now();\n  const random = crypto.randomUUID().slice(0, 8);\n  return `${deviceId}-${timestamp}-${random}`;\n}\n\n/**\n * Generate a unique device ID\n * Persisted to localStorage for device identification\n */\nexport function generateDeviceId(): string {\n  return `dev_${crypto.randomUUID().slice(0, 12)}`;\n}\n\n/**\n * Parse entry ID to extract components\n */\nexport function parseEntryId(id: string): { deviceId: string; timestamp: number; random: string } | null {\n  const parts = id.split('-');\n  if (parts.length < 3) return null;\n\n  // Device ID is everything up to the second-to-last part\n  const random = parts.pop()!;\n  const timestampStr = parts.pop()!;\n  const deviceId = parts.join('-');\n  const timestamp = parseInt(timestampStr, 10);\n\n  if (isNaN(timestamp)) return null;\n\n  return { deviceId, timestamp, random };\n}\n\n/**\n * Check if an ID is in the new UUID format\n */\nexport function isNewIdFormat(id: string): boolean {\n  return typeof id === 'string' && id.includes('-') && id.startsWith('dev_');\n}\n\n/**\n * Migrate old numeric ID to new format\n */\nexport function migrateId(oldId: number | string, deviceId: string): string {\n  if (typeof oldId === 'string' && isNewIdFormat(oldId)) {\n    return oldId;\n  }\n\n  const timestamp = typeof oldId === 'number' ? oldId : parseInt(String(oldId), 10);\n  const random = crypto.randomUUID().slice(0, 8);\n  return `${deviceId}-${timestamp}-${random}`;\n}\n\n/**\n * Generate a secure race ID\n */\nexport function generateRaceId(): string {\n  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // Excluded similar chars: I, O, 0, 1\n  let result = '';\n  for (let i = 0; i < 8; i++) {\n    result += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n  return result;\n}\n","// Timing point types\nexport type TimingPoint = 'S' | 'I1' | 'I2' | 'I3' | 'F';\n\n// Entry status types\nexport type EntryStatus = 'ok' | 'dns' | 'dnf' | 'dsq';\n\n// Sync status types\nexport type SyncStatus = 'disconnected' | 'connecting' | 'connected' | 'error' | 'offline';\n\n// Language types\nexport type Language = 'en' | 'de';\n\n// Entry interface - core timing data\nexport interface Entry {\n  id: string;\n  bib: string;\n  point: TimingPoint;\n  timestamp: string;\n  status: EntryStatus;\n  deviceId: string;\n  deviceName: string;\n  syncedAt?: number;\n  photo?: string; // Base64 encoded photo\n  gpsCoords?: {\n    latitude: number;\n    longitude: number;\n    accuracy: number;\n  };\n}\n\n// Settings interface\nexport interface Settings {\n  auto: boolean;        // Auto-increment bib\n  haptic: boolean;      // Haptic feedback\n  sound: boolean;       // Sound feedback\n  sync: boolean;        // Cloud sync enabled\n  gps: boolean;         // GPS enabled\n  simple: boolean;      // Simple mode\n  photoCapture: boolean; // Photo capture on timestamp\n}\n\n// Device info for multi-device sync\nexport interface DeviceInfo {\n  id: string;\n  name: string;\n  lastSeen: number;\n}\n\n// Sync queue item for offline support\nexport interface SyncQueueItem {\n  entry: Entry;\n  retryCount: number;\n  lastAttempt: number;\n  error?: string;\n}\n\n// Action types for undo/redo\nexport type ActionType =\n  | 'ADD_ENTRY'\n  | 'DELETE_ENTRY'\n  | 'DELETE_MULTIPLE'\n  | 'CLEAR_ALL'\n  | 'UPDATE_ENTRY';\n\n// Action interface for undo/redo stack\nexport interface Action {\n  type: ActionType;\n  data: Entry | Entry[];\n  timestamp: number;\n}\n\n// Application state interface\nexport interface AppState {\n  // UI State\n  currentView: 'timer' | 'results' | 'settings';\n  currentLang: Language;\n  bibInput: string;\n  selectedPoint: TimingPoint;\n  selectMode: boolean;\n  selectedEntries: Set<string>;\n  isRecording: boolean;\n  lastRecordedEntry: Entry | null;\n\n  // Data\n  entries: Entry[];\n\n  // Undo/Redo\n  undoStack: Action[];\n  redoStack: Action[];\n\n  // Settings\n  settings: Settings;\n\n  // Device/Sync State\n  deviceId: string;\n  deviceName: string;\n  raceId: string;\n  syncStatus: SyncStatus;\n  syncQueue: SyncQueueItem[];\n  connectedDevices: Map<string, DeviceInfo>;\n\n  // GPS State\n  gpsEnabled: boolean;\n  gpsAccuracy: number | null;\n  gpsStatus: 'inactive' | 'searching' | 'active';\n\n  // Camera State\n  cameraReady: boolean;\n  cameraError: string | null;\n}\n\n// Event types for state changes\nexport interface StateChangeEvent {\n  type: string;\n  payload?: unknown;\n  previousState?: Partial<AppState>;\n}\n\n// API response types\nexport interface SyncResponse {\n  entries: Entry[];\n  lastUpdated: number | null;\n  success?: boolean;\n  error?: string;\n}\n\n// Export format types\nexport type ExportFormat = 'csv' | 'json' | 'race-horology';\n\n// Statistics interface\nexport interface RaceStatistics {\n  totalEntries: number;\n  uniqueRacers: number;\n  finishedCount: number;\n  dnsCount: number;\n  dnfCount: number;\n  dsqCount: number;\n  fastestTime: number | null;\n  averageTime: number | null;\n  byPoint: Record<TimingPoint, number>;\n}\n\n// Virtual scroll item\nexport interface VirtualScrollItem {\n  index: number;\n  entry: Entry;\n  top: number;\n  height: number;\n}\n\n// Translation keys\nexport interface Translations {\n  timer: string;\n  results: string;\n  settings: string;\n  start: string;\n  finish: string;\n  bib: string;\n  point: string;\n  time: string;\n  status: string;\n  noEntries: string;\n  confirmDelete: string;\n  confirmClearAll: string;\n  clearAllText: string;\n  undo: string;\n  export: string;\n  search: string;\n  filter: string;\n  all: string;\n  connected: string;\n  offline: string;\n  syncError: string;\n  syncReceived: string;\n  saved: string;\n  deleted: string;\n  cleared: string;\n  duplicateWarning: string;\n  gpsActive: string;\n  gpsSearching: string;\n  gpsInactive: string;\n  simpleMode: string;\n  fullMode: string;\n  photoCapture: string;\n  photoCaptured: string;\n  photoError: string;\n  [key: string]: string;\n}\n\n// Schema version for data migration\nexport const SCHEMA_VERSION = 2;\n\n// Data schema for validation\nexport interface DataSchema {\n  version: number;\n  entries: Entry[];\n  settings: Settings;\n  deviceId: string;\n  deviceName: string;\n  raceId: string;\n  syncQueue: SyncQueueItem[];\n  lastExport?: number;\n}\n","import type { Entry, Settings, TimingPoint, EntryStatus, DataSchema, SyncQueueItem } from '../types';\nimport { SCHEMA_VERSION } from '../types';\n\nconst VALID_POINTS: TimingPoint[] = ['S', 'I1', 'I2', 'I3', 'F'];\nconst VALID_STATUSES: EntryStatus[] = ['ok', 'dns', 'dnf', 'dsq'];\n\n/**\n * Validate a single entry\n */\nexport function isValidEntry(entry: unknown): entry is Entry {\n  if (!entry || typeof entry !== 'object') return false;\n\n  const e = entry as Record<string, unknown>;\n\n  // ID can be string (new format) or number (legacy)\n  if (typeof e.id !== 'string' && typeof e.id !== 'number') return false;\n  if (typeof e.id === 'string' && e.id.length === 0) return false;\n  if (typeof e.id === 'number' && e.id <= 0) return false;\n\n  // Bib is optional but must be string if present\n  if (e.bib !== undefined && typeof e.bib !== 'string') return false;\n  if (typeof e.bib === 'string' && e.bib.length > 10) return false;\n\n  // Point is required and must be valid\n  if (!VALID_POINTS.includes(e.point as TimingPoint)) return false;\n\n  // Timestamp is required\n  if (!e.timestamp || typeof e.timestamp !== 'string') return false;\n  if (isNaN(Date.parse(e.timestamp))) return false;\n\n  // Status is optional but must be valid if present\n  if (e.status && !VALID_STATUSES.includes(e.status as EntryStatus)) return false;\n\n  return true;\n}\n\n/**\n * Validate settings object\n */\nexport function isValidSettings(settings: unknown): settings is Settings {\n  if (!settings || typeof settings !== 'object') return false;\n\n  const s = settings as Record<string, unknown>;\n\n  // All settings should be booleans\n  const booleanKeys = ['auto', 'haptic', 'sound', 'sync', 'gps', 'simple', 'photoCapture'];\n  for (const key of booleanKeys) {\n    if (key in s && typeof s[key] !== 'boolean') return false;\n  }\n\n  return true;\n}\n\n/**\n * Validate sync queue item\n */\nexport function isValidSyncQueueItem(item: unknown): item is SyncQueueItem {\n  if (!item || typeof item !== 'object') return false;\n\n  const i = item as Record<string, unknown>;\n\n  if (!isValidEntry(i.entry)) return false;\n  if (typeof i.retryCount !== 'number' || i.retryCount < 0) return false;\n  if (typeof i.lastAttempt !== 'number' || i.lastAttempt < 0) return false;\n\n  return true;\n}\n\n/**\n * Validate race ID format\n */\nexport function isValidRaceId(raceId: unknown): raceId is string {\n  if (!raceId || typeof raceId !== 'string') return false;\n  if (raceId.length > 50) return false;\n  return /^[a-zA-Z0-9_-]+$/.test(raceId);\n}\n\n/**\n * Validate device ID format\n */\nexport function isValidDeviceId(deviceId: unknown): deviceId is string {\n  if (!deviceId || typeof deviceId !== 'string') return false;\n  return deviceId.startsWith('dev_') && deviceId.length > 4;\n}\n\n/**\n * Validate full data schema\n */\nexport function isValidDataSchema(data: unknown): data is DataSchema {\n  if (!data || typeof data !== 'object') return false;\n\n  const d = data as Record<string, unknown>;\n\n  // Version check\n  if (typeof d.version !== 'number' || d.version > SCHEMA_VERSION) return false;\n\n  // Entries validation\n  if (!Array.isArray(d.entries)) return false;\n\n  // Settings validation\n  if (d.settings && !isValidSettings(d.settings)) return false;\n\n  return true;\n}\n\n/**\n * Sanitize a string to prevent XSS\n */\nexport function sanitizeString(str: unknown, maxLength: number = 100): string {\n  if (!str || typeof str !== 'string') return '';\n  return str.slice(0, maxLength).replace(/[<>]/g, '');\n}\n\n/**\n * Sanitize an entry by ensuring all fields are valid\n */\nexport function sanitizeEntry(entry: unknown, deviceId: string): Entry | null {\n  if (!isValidEntry(entry)) return null;\n\n  const e = entry as Entry;\n\n  return {\n    id: typeof e.id === 'number' ? String(e.id) : String(e.id),\n    bib: sanitizeString(e.bib, 10),\n    point: e.point,\n    timestamp: e.timestamp,\n    status: e.status || 'ok',\n    deviceId: sanitizeString(e.deviceId || deviceId, 50),\n    deviceName: sanitizeString(e.deviceName || 'Unknown Device', 100),\n    syncedAt: e.syncedAt,\n    photo: e.photo, // Base64 doesn't need sanitization\n    gpsCoords: e.gpsCoords\n  };\n}\n\n/**\n * Migrate data from old schema to new\n */\nexport function migrateSchema(data: unknown, deviceId: string): DataSchema {\n  const defaultSettings: Settings = {\n    auto: true,\n    haptic: true,\n    sound: false,\n    sync: false,\n    gps: false,\n    simple: true,\n    photoCapture: false\n  };\n\n  // Handle completely invalid data\n  if (!data || typeof data !== 'object') {\n    return {\n      version: SCHEMA_VERSION,\n      entries: [],\n      settings: defaultSettings,\n      deviceId,\n      deviceName: 'Timer 1',\n      raceId: '',\n      syncQueue: []\n    };\n  }\n\n  const d = data as Record<string, unknown>;\n\n  // Migrate entries\n  let entries: Entry[] = [];\n  if (Array.isArray(d.entries)) {\n    entries = d.entries\n      .map(e => sanitizeEntry(e, deviceId))\n      .filter((e): e is Entry => e !== null);\n  }\n\n  // Migrate settings\n  let settings = defaultSettings;\n  if (d.settings && typeof d.settings === 'object') {\n    const s = d.settings as Record<string, unknown>;\n    settings = {\n      auto: typeof s.auto === 'boolean' ? s.auto : defaultSettings.auto,\n      haptic: typeof s.haptic === 'boolean' ? s.haptic : defaultSettings.haptic,\n      sound: typeof s.sound === 'boolean' ? s.sound : defaultSettings.sound,\n      sync: typeof s.sync === 'boolean' ? s.sync : defaultSettings.sync,\n      gps: typeof s.gps === 'boolean' ? s.gps : defaultSettings.gps,\n      simple: typeof s.simple === 'boolean' ? s.simple : defaultSettings.simple,\n      photoCapture: typeof s.photoCapture === 'boolean' ? s.photoCapture : defaultSettings.photoCapture\n    };\n  }\n\n  // Migrate sync queue\n  let syncQueue: SyncQueueItem[] = [];\n  if (Array.isArray(d.syncQueue)) {\n    syncQueue = d.syncQueue.filter(isValidSyncQueueItem);\n  }\n\n  return {\n    version: SCHEMA_VERSION,\n    entries,\n    settings,\n    deviceId: isValidDeviceId(d.deviceId) ? d.deviceId : deviceId,\n    deviceName: sanitizeString(d.deviceName, 100) || 'Timer 1',\n    raceId: isValidRaceId(d.raceId) ? d.raceId : '',\n    syncQueue,\n    lastExport: typeof d.lastExport === 'number' ? d.lastExport : undefined\n  };\n}\n\n/**\n * Calculate checksum for data integrity verification\n */\nexport function calculateChecksum(data: string): string {\n  let hash = 0;\n  for (let i = 0; i < data.length; i++) {\n    const char = data.charCodeAt(i);\n    hash = ((hash << 5) - hash) + char;\n    hash = hash & hash; // Convert to 32-bit integer\n  }\n  return hash.toString(16);\n}\n\n/**\n * Verify data integrity\n */\nexport function verifyChecksum(data: string, expectedChecksum: string): boolean {\n  return calculateChecksum(data) === expectedChecksum;\n}\n","import type {\n  AppState,\n  Entry,\n  Settings,\n  Action,\n  SyncStatus,\n  TimingPoint,\n  Language,\n  SyncQueueItem,\n  DeviceInfo\n} from '../types';\nimport { generateDeviceId } from '../utils/id';\nimport { isValidEntry, migrateSchema } from '../utils/validation';\nimport { SCHEMA_VERSION } from '../types';\n\n// Storage keys\nconst STORAGE_KEYS = {\n  ENTRIES: 'skiTimerEntries',\n  SETTINGS: 'skiTimerSettings',\n  LANG: 'skiTimerLang',\n  DEVICE_ID: 'skiTimerDeviceId',\n  DEVICE_NAME: 'skiTimerDeviceName',\n  RACE_ID: 'skiTimerRaceId',\n  SYNC_QUEUE: 'skiTimerSyncQueue',\n  SCHEMA_VERSION: 'skiTimerSchemaVersion'\n} as const;\n\n// Default settings\nconst DEFAULT_SETTINGS: Settings = {\n  auto: true,\n  haptic: true,\n  sound: false,\n  sync: false,\n  gps: false,\n  simple: true,\n  photoCapture: false\n};\n\n// Maximum undo stack size\nconst MAX_UNDO_STACK = 50;\n\n// State change listener type\ntype StateListener = (state: AppState, changedKeys: (keyof AppState)[]) => void;\n\nclass Store {\n  private state: AppState;\n  private listeners: Set<StateListener> = new Set();\n  private saveTimeout: ReturnType<typeof setTimeout> | null = null;\n\n  constructor() {\n    this.state = this.loadInitialState();\n  }\n\n  private loadInitialState(): AppState {\n    // Load device ID first (or generate new one)\n    let deviceId = localStorage.getItem(STORAGE_KEYS.DEVICE_ID);\n    if (!deviceId) {\n      deviceId = generateDeviceId();\n      localStorage.setItem(STORAGE_KEYS.DEVICE_ID, deviceId);\n    }\n\n    // Load and migrate data\n    const entriesJson = localStorage.getItem(STORAGE_KEYS.ENTRIES);\n    const settingsJson = localStorage.getItem(STORAGE_KEYS.SETTINGS);\n    const syncQueueJson = localStorage.getItem(STORAGE_KEYS.SYNC_QUEUE);\n\n    let entries: Entry[] = [];\n    let settings = DEFAULT_SETTINGS;\n    let syncQueue: SyncQueueItem[] = [];\n\n    try {\n      if (entriesJson) {\n        const parsed = JSON.parse(entriesJson);\n        if (Array.isArray(parsed)) {\n          entries = parsed.filter(e => isValidEntry(e));\n        }\n      }\n    } catch (e) {\n      console.error('Failed to parse entries:', e);\n    }\n\n    try {\n      if (settingsJson) {\n        const parsed = JSON.parse(settingsJson);\n        settings = { ...DEFAULT_SETTINGS, ...parsed };\n      }\n    } catch (e) {\n      console.error('Failed to parse settings:', e);\n    }\n\n    try {\n      if (syncQueueJson) {\n        const parsed = JSON.parse(syncQueueJson);\n        if (Array.isArray(parsed)) {\n          syncQueue = parsed;\n        }\n      }\n    } catch (e) {\n      console.error('Failed to parse sync queue:', e);\n    }\n\n    // Load other values\n    const lang = (localStorage.getItem(STORAGE_KEYS.LANG) || 'de') as Language;\n    const deviceName = localStorage.getItem(STORAGE_KEYS.DEVICE_NAME) || 'Timer 1';\n    const raceId = localStorage.getItem(STORAGE_KEYS.RACE_ID) || '';\n\n    return {\n      // UI State\n      currentView: 'timer',\n      currentLang: lang,\n      bibInput: '',\n      selectedPoint: 'F',\n      selectMode: false,\n      selectedEntries: new Set(),\n      isRecording: false,\n      lastRecordedEntry: null,\n\n      // Data\n      entries,\n\n      // Undo/Redo\n      undoStack: [],\n      redoStack: [],\n\n      // Settings\n      settings,\n\n      // Device/Sync State\n      deviceId,\n      deviceName,\n      raceId,\n      syncStatus: 'disconnected',\n      syncQueue,\n      connectedDevices: new Map(),\n\n      // GPS State\n      gpsEnabled: settings.gps,\n      gpsAccuracy: null,\n      gpsStatus: 'inactive',\n\n      // Camera State\n      cameraReady: false,\n      cameraError: null\n    };\n  }\n\n  // Get current state (readonly)\n  getState(): Readonly<AppState> {\n    return this.state;\n  }\n\n  // Subscribe to state changes\n  subscribe(listener: StateListener): () => void {\n    this.listeners.add(listener);\n    return () => this.listeners.delete(listener);\n  }\n\n  // Notify all listeners of state changes\n  private notify(changedKeys: (keyof AppState)[]) {\n    this.listeners.forEach(listener => {\n      try {\n        listener(this.state, changedKeys);\n      } catch (e) {\n        console.error('State listener error:', e);\n      }\n    });\n  }\n\n  // Update state\n  private setState(updates: Partial<AppState>, persist: boolean = true) {\n    const changedKeys = Object.keys(updates) as (keyof AppState)[];\n    this.state = { ...this.state, ...updates };\n    this.notify(changedKeys);\n\n    if (persist) {\n      this.scheduleSave();\n    }\n  }\n\n  // Debounced save to localStorage\n  private scheduleSave() {\n    if (this.saveTimeout) {\n      clearTimeout(this.saveTimeout);\n    }\n    this.saveTimeout = setTimeout(() => this.saveToStorage(), 100);\n  }\n\n  // Save state to localStorage\n  private saveToStorage() {\n    try {\n      localStorage.setItem(STORAGE_KEYS.ENTRIES, JSON.stringify(this.state.entries));\n      localStorage.setItem(STORAGE_KEYS.SETTINGS, JSON.stringify(this.state.settings));\n      localStorage.setItem(STORAGE_KEYS.LANG, this.state.currentLang);\n      localStorage.setItem(STORAGE_KEYS.DEVICE_NAME, this.state.deviceName);\n      localStorage.setItem(STORAGE_KEYS.RACE_ID, this.state.raceId);\n      localStorage.setItem(STORAGE_KEYS.SYNC_QUEUE, JSON.stringify(this.state.syncQueue));\n      localStorage.setItem(STORAGE_KEYS.SCHEMA_VERSION, String(SCHEMA_VERSION));\n    } catch (e) {\n      console.error('Failed to save to storage:', e);\n    }\n  }\n\n  // Push action to undo stack\n  private pushUndo(action: Action) {\n    const undoStack = [...this.state.undoStack, action];\n    if (undoStack.length > MAX_UNDO_STACK) {\n      undoStack.shift();\n    }\n    this.setState({ undoStack, redoStack: [] }, false);\n  }\n\n  // ===== Entry Actions =====\n\n  addEntry(entry: Entry) {\n    const entries = [...this.state.entries, entry];\n    this.pushUndo({\n      type: 'ADD_ENTRY',\n      data: entry,\n      timestamp: Date.now()\n    });\n    this.setState({\n      entries,\n      lastRecordedEntry: entry,\n      isRecording: false\n    });\n\n    // Add to sync queue if sync is enabled\n    if (this.state.settings.sync && this.state.raceId) {\n      this.addToSyncQueue(entry);\n    }\n  }\n\n  deleteEntry(id: string) {\n    const entry = this.state.entries.find(e => e.id === id);\n    if (!entry) return;\n\n    this.pushUndo({\n      type: 'DELETE_ENTRY',\n      data: entry,\n      timestamp: Date.now()\n    });\n\n    const entries = this.state.entries.filter(e => e.id !== id);\n    this.setState({ entries });\n  }\n\n  deleteMultiple(ids: string[]) {\n    const deletedEntries = this.state.entries.filter(e => ids.includes(e.id));\n    if (deletedEntries.length === 0) return;\n\n    this.pushUndo({\n      type: 'DELETE_MULTIPLE',\n      data: deletedEntries,\n      timestamp: Date.now()\n    });\n\n    const entries = this.state.entries.filter(e => !ids.includes(e.id));\n    this.setState({\n      entries,\n      selectMode: false,\n      selectedEntries: new Set()\n    });\n  }\n\n  clearAll() {\n    if (this.state.entries.length === 0) return;\n\n    this.pushUndo({\n      type: 'CLEAR_ALL',\n      data: [...this.state.entries],\n      timestamp: Date.now()\n    });\n\n    this.setState({\n      entries: [],\n      selectMode: false,\n      selectedEntries: new Set()\n    });\n  }\n\n  updateEntry(id: string, updates: Partial<Entry>) {\n    const index = this.state.entries.findIndex(e => e.id === id);\n    if (index === -1) return;\n\n    const oldEntry = this.state.entries[index];\n    const newEntry = { ...oldEntry, ...updates };\n\n    this.pushUndo({\n      type: 'UPDATE_ENTRY',\n      data: oldEntry,\n      timestamp: Date.now()\n    });\n\n    const entries = [...this.state.entries];\n    entries[index] = newEntry;\n    this.setState({ entries });\n  }\n\n  // ===== Undo/Redo =====\n\n  canUndo(): boolean {\n    return this.state.undoStack.length > 0;\n  }\n\n  canRedo(): boolean {\n    return this.state.redoStack.length > 0;\n  }\n\n  undo(): Entry | Entry[] | null {\n    if (!this.canUndo()) return null;\n\n    const undoStack = [...this.state.undoStack];\n    const action = undoStack.pop()!;\n    const redoStack = [...this.state.redoStack, action];\n\n    let entries = [...this.state.entries];\n    let result: Entry | Entry[] | null = null;\n\n    switch (action.type) {\n      case 'ADD_ENTRY': {\n        const entry = action.data as Entry;\n        entries = entries.filter(e => e.id !== entry.id);\n        result = entry;\n        break;\n      }\n      case 'DELETE_ENTRY': {\n        const entry = action.data as Entry;\n        entries.push(entry);\n        entries.sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime());\n        result = entry;\n        break;\n      }\n      case 'DELETE_MULTIPLE':\n      case 'CLEAR_ALL': {\n        const deletedEntries = action.data as Entry[];\n        entries = [...entries, ...deletedEntries];\n        entries.sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime());\n        result = deletedEntries;\n        break;\n      }\n      case 'UPDATE_ENTRY': {\n        const oldEntry = action.data as Entry;\n        const index = entries.findIndex(e => e.id === oldEntry.id);\n        if (index !== -1) {\n          entries[index] = oldEntry;\n        }\n        result = oldEntry;\n        break;\n      }\n    }\n\n    this.setState({ entries, undoStack, redoStack });\n    return result;\n  }\n\n  redo(): Entry | Entry[] | null {\n    if (!this.canRedo()) return null;\n\n    const redoStack = [...this.state.redoStack];\n    const action = redoStack.pop()!;\n    const undoStack = [...this.state.undoStack, action];\n\n    let entries = [...this.state.entries];\n    let result: Entry | Entry[] | null = null;\n\n    switch (action.type) {\n      case 'ADD_ENTRY': {\n        const entry = action.data as Entry;\n        entries.push(entry);\n        entries.sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime());\n        result = entry;\n        break;\n      }\n      case 'DELETE_ENTRY': {\n        const entry = action.data as Entry;\n        entries = entries.filter(e => e.id !== entry.id);\n        result = entry;\n        break;\n      }\n      case 'DELETE_MULTIPLE':\n      case 'CLEAR_ALL': {\n        const deletedEntries = action.data as Entry[];\n        const idsToDelete = new Set(deletedEntries.map(e => e.id));\n        entries = entries.filter(e => !idsToDelete.has(e.id));\n        result = deletedEntries;\n        break;\n      }\n      case 'UPDATE_ENTRY': {\n        // For redo, we need to re-apply the update\n        // This is tricky because we only stored the old entry\n        // For now, we just restore the old entry (same as undo)\n        const oldEntry = action.data as Entry;\n        const index = entries.findIndex(e => e.id === oldEntry.id);\n        if (index !== -1) {\n          entries[index] = oldEntry;\n        }\n        result = oldEntry;\n        break;\n      }\n    }\n\n    this.setState({ entries, undoStack, redoStack });\n    return result;\n  }\n\n  // ===== Sync Queue =====\n\n  addToSyncQueue(entry: Entry) {\n    const item: SyncQueueItem = {\n      entry,\n      retryCount: 0,\n      lastAttempt: 0\n    };\n    const syncQueue = [...this.state.syncQueue, item];\n    this.setState({ syncQueue });\n  }\n\n  removeFromSyncQueue(entryId: string) {\n    const syncQueue = this.state.syncQueue.filter(item => item.entry.id !== entryId);\n    this.setState({ syncQueue });\n  }\n\n  updateSyncQueueItem(entryId: string, updates: Partial<SyncQueueItem>) {\n    const syncQueue = this.state.syncQueue.map(item =>\n      item.entry.id === entryId ? { ...item, ...updates } : item\n    );\n    this.setState({ syncQueue });\n  }\n\n  clearSyncQueue() {\n    this.setState({ syncQueue: [] });\n  }\n\n  // ===== UI State =====\n\n  setView(view: 'timer' | 'results' | 'settings') {\n    this.setState({ currentView: view }, false);\n  }\n\n  setLanguage(lang: Language) {\n    this.setState({ currentLang: lang });\n  }\n\n  setBibInput(bib: string) {\n    // Limit to 3 digits\n    const sanitized = bib.replace(/\\D/g, '').slice(0, 3);\n    this.setState({ bibInput: sanitized }, false);\n  }\n\n  setSelectedPoint(point: TimingPoint) {\n    this.setState({ selectedPoint: point }, false);\n  }\n\n  setSelectMode(enabled: boolean) {\n    this.setState({\n      selectMode: enabled,\n      selectedEntries: enabled ? this.state.selectedEntries : new Set()\n    }, false);\n  }\n\n  toggleEntrySelection(id: string) {\n    const selectedEntries = new Set(this.state.selectedEntries);\n    if (selectedEntries.has(id)) {\n      selectedEntries.delete(id);\n    } else {\n      selectedEntries.add(id);\n    }\n    this.setState({\n      selectedEntries,\n      selectMode: selectedEntries.size > 0\n    }, false);\n  }\n\n  selectAllEntries() {\n    const selectedEntries = new Set(this.state.entries.map(e => e.id));\n    this.setState({ selectedEntries, selectMode: true }, false);\n  }\n\n  clearSelection() {\n    this.setState({\n      selectedEntries: new Set(),\n      selectMode: false\n    }, false);\n  }\n\n  setRecording(isRecording: boolean) {\n    this.setState({ isRecording }, false);\n  }\n\n  // ===== Settings =====\n\n  updateSettings(updates: Partial<Settings>) {\n    const settings = { ...this.state.settings, ...updates };\n    this.setState({ settings });\n  }\n\n  toggleSetting(key: keyof Settings) {\n    const settings = { ...this.state.settings };\n    settings[key] = !settings[key];\n    this.setState({ settings });\n  }\n\n  // ===== Sync State =====\n\n  setSyncStatus(status: SyncStatus) {\n    this.setState({ syncStatus: status }, false);\n  }\n\n  setRaceId(raceId: string) {\n    this.setState({ raceId });\n  }\n\n  setDeviceName(name: string) {\n    this.setState({ deviceName: name });\n  }\n\n  addConnectedDevice(device: DeviceInfo) {\n    const connectedDevices = new Map(this.state.connectedDevices);\n    connectedDevices.set(device.id, device);\n    this.setState({ connectedDevices }, false);\n  }\n\n  removeConnectedDevice(deviceId: string) {\n    const connectedDevices = new Map(this.state.connectedDevices);\n    connectedDevices.delete(deviceId);\n    this.setState({ connectedDevices }, false);\n  }\n\n  // ===== GPS State =====\n\n  setGpsStatus(status: 'inactive' | 'searching' | 'active', accuracy?: number) {\n    this.setState({\n      gpsStatus: status,\n      gpsAccuracy: accuracy ?? null\n    }, false);\n  }\n\n  // ===== Camera State =====\n\n  setCameraReady(ready: boolean, error?: string) {\n    this.setState({\n      cameraReady: ready,\n      cameraError: error ?? null\n    }, false);\n  }\n\n  // ===== Merge Cloud Entries =====\n\n  mergeCloudEntries(cloudEntries: Entry[]): number {\n    let addedCount = 0;\n    const existingIds = new Set(this.state.entries.map(e => `${e.id}-${e.deviceId}`));\n    const newEntries: Entry[] = [];\n\n    for (const entry of cloudEntries) {\n      // Skip invalid entries\n      if (!isValidEntry(entry)) continue;\n\n      // Skip entries from this device\n      if (entry.deviceId === this.state.deviceId) continue;\n\n      // Skip duplicates\n      const key = `${entry.id}-${entry.deviceId}`;\n      if (existingIds.has(key)) continue;\n\n      newEntries.push(entry);\n      existingIds.add(key);\n      addedCount++;\n    }\n\n    if (newEntries.length > 0) {\n      const entries = [...this.state.entries, ...newEntries];\n      entries.sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime());\n      this.setState({ entries });\n    }\n\n    return addedCount;\n  }\n\n  // ===== Export/Import =====\n\n  exportData(): string {\n    return JSON.stringify({\n      version: SCHEMA_VERSION,\n      entries: this.state.entries,\n      settings: this.state.settings,\n      deviceId: this.state.deviceId,\n      deviceName: this.state.deviceName,\n      raceId: this.state.raceId,\n      exportedAt: new Date().toISOString()\n    }, null, 2);\n  }\n\n  importData(jsonData: string): { success: boolean; entriesImported: number; error?: string } {\n    try {\n      const parsed = JSON.parse(jsonData);\n      const migrated = migrateSchema(parsed, this.state.deviceId);\n\n      // Merge entries (don't overwrite existing)\n      const existingIds = new Set(this.state.entries.map(e => e.id));\n      const newEntries = migrated.entries.filter(e => !existingIds.has(e.id));\n\n      if (newEntries.length > 0) {\n        const entries = [...this.state.entries, ...newEntries];\n        entries.sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime());\n        this.setState({ entries });\n      }\n\n      return { success: true, entriesImported: newEntries.length };\n    } catch (e) {\n      return { success: false, entriesImported: 0, error: String(e) };\n    }\n  }\n}\n\n// Singleton store instance\nexport const store = new Store();\n\n// Helper hooks for common state access\nexport function getEntries(): Entry[] {\n  return store.getState().entries;\n}\n\nexport function getSettings(): Settings {\n  return store.getState().settings;\n}\n\nexport function getSyncStatus(): SyncStatus {\n  return store.getState().syncStatus;\n}\n","import type { Language, TimingPoint } from '../types';\n\n/**\n * Format time as HH:MM:SS.mmm\n */\nexport function formatTime(date: Date): string {\n  const hours = String(date.getHours()).padStart(2, '0');\n  const minutes = String(date.getMinutes()).padStart(2, '0');\n  const seconds = String(date.getSeconds()).padStart(2, '0');\n  const milliseconds = String(date.getMilliseconds()).padStart(3, '0');\n  return `${hours}:${minutes}:${seconds}.${milliseconds}`;\n}\n\n/**\n * Format date in locale-aware format\n */\nexport function formatDate(date: Date, lang: Language = 'de'): string {\n  const options: Intl.DateTimeFormatOptions = {\n    weekday: 'short',\n    day: '2-digit',\n    month: '2-digit',\n    year: 'numeric'\n  };\n  return date.toLocaleDateString(lang === 'de' ? 'de-DE' : 'en-US', options);\n}\n\n/**\n * Format duration in MM:SS.cc (centiseconds)\n */\nexport function formatDuration(ms: number): string {\n  if (ms < 0) return '--:--.--';\n\n  const totalSeconds = Math.floor(ms / 1000);\n  const minutes = Math.floor(totalSeconds / 60);\n  const seconds = totalSeconds % 60;\n  const centiseconds = Math.floor((ms % 1000) / 10);\n\n  return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}.${String(centiseconds).padStart(2, '0')}`;\n}\n\n/**\n * Format bib number with leading zeros\n */\nexport function formatBib(bib: string | number, digits: number = 3): string {\n  return String(bib).padStart(digits, '0');\n}\n\n/**\n * Escape HTML to prevent XSS\n */\nexport function escapeHtml(str: string): string {\n  const div = document.createElement('div');\n  div.textContent = String(str);\n  return div.innerHTML;\n}\n\n/**\n * Get color for timing point\n */\nexport function getPointColor(point: TimingPoint): string {\n  const colors: Record<TimingPoint, string> = {\n    'S': 'var(--success)',\n    'I1': 'var(--primary)',\n    'I2': 'var(--primary)',\n    'I3': 'var(--primary)',\n    'F': 'var(--secondary)'\n  };\n  return colors[point] || 'var(--text-secondary)';\n}\n\n/**\n * Get display label for timing point\n */\nexport function getPointLabel(point: TimingPoint, lang: Language = 'de'): string {\n  const labels: Record<Language, Record<TimingPoint, string>> = {\n    en: { S: 'Start', I1: 'Int 1', I2: 'Int 2', I3: 'Int 3', F: 'Finish' },\n    de: { S: 'Start', I1: 'Int 1', I2: 'Int 2', I3: 'Int 3', F: 'Ziel' }\n  };\n  return labels[lang][point];\n}\n\n/**\n * Format file size for display\n */\nexport function formatFileSize(bytes: number): string {\n  if (bytes < 1024) return `${bytes} B`;\n  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n  return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n}\n\n/**\n * Truncate string with ellipsis\n */\nexport function truncate(str: string, maxLength: number): string {\n  if (str.length <= maxLength) return str;\n  return str.slice(0, maxLength - 3) + '...';\n}\n\n/**\n * Debounce function\n */\nexport function debounce<T extends (...args: unknown[]) => void>(\n  fn: T,\n  delay: number\n): (...args: Parameters<T>) => void {\n  let timeoutId: ReturnType<typeof setTimeout>;\n  return (...args: Parameters<T>) => {\n    clearTimeout(timeoutId);\n    timeoutId = setTimeout(() => fn(...args), delay);\n  };\n}\n\n/**\n * Throttle function\n */\nexport function throttle<T extends (...args: unknown[]) => void>(\n  fn: T,\n  limit: number\n): (...args: Parameters<T>) => void {\n  let inThrottle = false;\n  return (...args: Parameters<T>) => {\n    if (!inThrottle) {\n      fn(...args);\n      inThrottle = true;\n      setTimeout(() => (inThrottle = false), limit);\n    }\n  };\n}\n","import { store } from '../store';\n\n// Camera configuration\nconst CAMERA_CONFIG: MediaStreamConstraints = {\n  video: {\n    facingMode: 'environment', // Rear camera\n    width: { ideal: 1280 },\n    height: { ideal: 720 }\n  },\n  audio: false\n};\n\n// Photo quality settings\nconst PHOTO_QUALITY = 0.8;\nconst PHOTO_MAX_WIDTH = 1280;\nconst PHOTO_MAX_HEIGHT = 720;\n\nclass CameraService {\n  private stream: MediaStream | null = null;\n  private videoElement: HTMLVideoElement | null = null;\n  private canvasElement: HTMLCanvasElement | null = null;\n  private isInitialized = false;\n\n  /**\n   * Initialize the camera service\n   * Creates hidden video and canvas elements for photo capture\n   */\n  async initialize(): Promise<boolean> {\n    if (this.isInitialized) return true;\n\n    try {\n      // Check if camera API is available\n      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\n        throw new Error('Camera API not available');\n      }\n\n      // Create hidden video element\n      this.videoElement = document.createElement('video');\n      this.videoElement.setAttribute('autoplay', '');\n      this.videoElement.setAttribute('playsinline', '');\n      this.videoElement.style.position = 'absolute';\n      this.videoElement.style.left = '-9999px';\n      this.videoElement.style.top = '-9999px';\n      document.body.appendChild(this.videoElement);\n\n      // Create hidden canvas for photo capture\n      this.canvasElement = document.createElement('canvas');\n      this.canvasElement.width = PHOTO_MAX_WIDTH;\n      this.canvasElement.height = PHOTO_MAX_HEIGHT;\n\n      // Request camera access\n      this.stream = await navigator.mediaDevices.getUserMedia(CAMERA_CONFIG);\n      this.videoElement.srcObject = this.stream;\n\n      // Wait for video to be ready\n      await new Promise<void>((resolve, reject) => {\n        if (!this.videoElement) {\n          reject(new Error('Video element not available'));\n          return;\n        }\n        this.videoElement.onloadedmetadata = () => {\n          this.videoElement!.play()\n            .then(() => resolve())\n            .catch(reject);\n        };\n        this.videoElement.onerror = () => reject(new Error('Video load error'));\n      });\n\n      this.isInitialized = true;\n      store.setCameraReady(true);\n      console.log('Camera initialized successfully');\n      return true;\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Camera initialization failed';\n      console.error('Camera initialization error:', errorMessage);\n      store.setCameraReady(false, errorMessage);\n      return false;\n    }\n  }\n\n  /**\n   * Capture a photo from the camera\n   * Returns base64 encoded JPEG image\n   */\n  async capturePhoto(): Promise<string | null> {\n    if (!this.isInitialized || !this.videoElement || !this.canvasElement) {\n      console.warn('Camera not initialized');\n      return null;\n    }\n\n    try {\n      const ctx = this.canvasElement.getContext('2d');\n      if (!ctx) {\n        throw new Error('Could not get canvas context');\n      }\n\n      // Get video dimensions\n      const videoWidth = this.videoElement.videoWidth;\n      const videoHeight = this.videoElement.videoHeight;\n\n      // Calculate dimensions to maintain aspect ratio\n      let width = videoWidth;\n      let height = videoHeight;\n\n      if (width > PHOTO_MAX_WIDTH) {\n        const ratio = PHOTO_MAX_WIDTH / width;\n        width = PHOTO_MAX_WIDTH;\n        height = Math.round(height * ratio);\n      }\n\n      if (height > PHOTO_MAX_HEIGHT) {\n        const ratio = PHOTO_MAX_HEIGHT / height;\n        height = PHOTO_MAX_HEIGHT;\n        width = Math.round(width * ratio);\n      }\n\n      // Update canvas size\n      this.canvasElement.width = width;\n      this.canvasElement.height = height;\n\n      // Draw video frame to canvas\n      ctx.drawImage(this.videoElement, 0, 0, width, height);\n\n      // Add timestamp overlay\n      const timestamp = new Date().toISOString();\n      ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';\n      ctx.fillRect(0, height - 30, width, 30);\n      ctx.fillStyle = '#ffffff';\n      ctx.font = '14px monospace';\n      ctx.fillText(timestamp, 10, height - 10);\n\n      // Convert to base64\n      const dataUrl = this.canvasElement.toDataURL('image/jpeg', PHOTO_QUALITY);\n      const base64 = dataUrl.split(',')[1];\n\n      console.log(`Photo captured: ${Math.round(base64.length / 1024)}KB`);\n      return base64;\n    } catch (error) {\n      console.error('Photo capture error:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Stop the camera stream\n   */\n  stop(): void {\n    if (this.stream) {\n      this.stream.getTracks().forEach(track => track.stop());\n      this.stream = null;\n    }\n\n    if (this.videoElement) {\n      this.videoElement.srcObject = null;\n      this.videoElement.remove();\n      this.videoElement = null;\n    }\n\n    this.isInitialized = false;\n    store.setCameraReady(false);\n    console.log('Camera stopped');\n  }\n\n  /**\n   * Check if camera is ready\n   */\n  isReady(): boolean {\n    return this.isInitialized;\n  }\n\n  /**\n   * Get camera error message\n   */\n  getError(): string | null {\n    return store.getState().cameraError;\n  }\n\n  /**\n   * Toggle camera based on settings\n   */\n  async toggle(enabled: boolean): Promise<boolean> {\n    if (enabled) {\n      return this.initialize();\n    } else {\n      this.stop();\n      return true;\n    }\n  }\n}\n\n// Singleton instance\nexport const cameraService = new CameraService();\n\n// Helper function to capture photo with timestamp entry\nexport async function captureTimingPhoto(): Promise<string | null> {\n  const settings = store.getState().settings;\n  if (!settings.photoCapture) return null;\n\n  if (!cameraService.isReady()) {\n    const initialized = await cameraService.initialize();\n    if (!initialized) return null;\n  }\n\n  return cameraService.capturePhoto();\n}\n","import { store } from '../store';\nimport type { Entry, SyncResponse, DeviceInfo } from '../types';\nimport { isValidEntry } from '../utils/validation';\n\n// API configuration\nconst API_BASE = '/api/sync';\n\n// Sync configuration\nconst POLL_INTERVAL_NORMAL = 5000; // 5 seconds\nconst POLL_INTERVAL_ERROR = 30000; // 30 seconds on error\nconst MAX_RETRIES = 5;\nconst RETRY_BACKOFF_BASE = 2000; // 2 seconds\nconst QUEUE_PROCESS_INTERVAL = 10000; // 10 seconds\n\nclass SyncService {\n  private pollInterval: ReturnType<typeof setInterval> | null = null;\n  private queueInterval: ReturnType<typeof setInterval> | null = null;\n  private broadcastChannel: BroadcastChannel | null = null;\n  private consecutiveErrors = 0;\n  private lastSyncTimestamp = 0;\n  private isProcessingQueue = false;\n\n  /**\n   * Initialize sync service\n   */\n  initialize(): void {\n    const state = store.getState();\n\n    if (!state.settings.sync || !state.raceId) {\n      this.cleanup();\n      return;\n    }\n\n    // Initialize BroadcastChannel for same-browser tab sync\n    this.initBroadcastChannel(state.raceId);\n\n    // Start cloud sync polling\n    this.startPolling();\n\n    // Start queue processing\n    this.startQueueProcessor();\n\n    // Push existing local entries to cloud\n    this.pushLocalEntries();\n\n    store.setSyncStatus('connecting');\n    console.log('Sync service initialized for race:', state.raceId);\n  }\n\n  /**\n   * Initialize BroadcastChannel for cross-tab communication\n   */\n  private initBroadcastChannel(raceId: string): void {\n    try {\n      if (this.broadcastChannel) {\n        this.broadcastChannel.close();\n      }\n\n      this.broadcastChannel = new BroadcastChannel(`ski-timer-${raceId}`);\n\n      this.broadcastChannel.onmessage = (event) => {\n        const { type, data } = event.data;\n\n        if (type === 'entry' && isValidEntry(data)) {\n          store.mergeCloudEntries([data]);\n        } else if (type === 'presence') {\n          const deviceInfo = data as DeviceInfo;\n          store.addConnectedDevice(deviceInfo);\n        }\n      };\n    } catch (error) {\n      console.warn('BroadcastChannel not supported:', error);\n    }\n  }\n\n  /**\n   * Broadcast entry to other tabs\n   */\n  broadcastEntry(entry: Entry): void {\n    if (this.broadcastChannel) {\n      try {\n        this.broadcastChannel.postMessage({ type: 'entry', data: entry });\n      } catch (error) {\n        console.error('Broadcast error:', error);\n      }\n    }\n  }\n\n  /**\n   * Broadcast presence to other tabs\n   */\n  broadcastPresence(): void {\n    const state = store.getState();\n    if (this.broadcastChannel) {\n      try {\n        this.broadcastChannel.postMessage({\n          type: 'presence',\n          data: {\n            id: state.deviceId,\n            name: state.deviceName,\n            lastSeen: Date.now()\n          }\n        });\n      } catch (error) {\n        console.error('Presence broadcast error:', error);\n      }\n    }\n  }\n\n  /**\n   * Start polling for cloud updates\n   */\n  private startPolling(): void {\n    if (this.pollInterval) {\n      clearInterval(this.pollInterval);\n    }\n\n    // Initial fetch\n    this.fetchCloudEntries();\n\n    // Set up polling\n    const interval = this.consecutiveErrors > 2 ? POLL_INTERVAL_ERROR : POLL_INTERVAL_NORMAL;\n    this.pollInterval = setInterval(() => this.fetchCloudEntries(), interval);\n  }\n\n  /**\n   * Adjust polling interval based on success/failure\n   */\n  private adjustPollingInterval(success: boolean): void {\n    if (success) {\n      this.consecutiveErrors = 0;\n      if (this.pollInterval) {\n        clearInterval(this.pollInterval);\n        this.pollInterval = setInterval(() => this.fetchCloudEntries(), POLL_INTERVAL_NORMAL);\n      }\n    } else {\n      this.consecutiveErrors++;\n      if (this.consecutiveErrors > 2 && this.pollInterval) {\n        clearInterval(this.pollInterval);\n        this.pollInterval = setInterval(() => this.fetchCloudEntries(), POLL_INTERVAL_ERROR);\n      }\n    }\n  }\n\n  /**\n   * Fetch entries from cloud\n   */\n  async fetchCloudEntries(): Promise<void> {\n    const state = store.getState();\n    if (!state.settings.sync || !state.raceId) return;\n\n    try {\n      const response = await fetch(\n        `${API_BASE}?raceId=${encodeURIComponent(state.raceId)}`\n      );\n\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}`);\n      }\n\n      let data: SyncResponse;\n      try {\n        data = await response.json();\n      } catch {\n        throw new Error('Invalid response format');\n      }\n\n      // Validate response structure\n      if (!data || typeof data !== 'object') {\n        throw new Error('Invalid data structure');\n      }\n\n      const cloudEntries = Array.isArray(data.entries) ? data.entries : [];\n\n      // Update sync status\n      store.setSyncStatus('connected');\n\n      // Merge remote entries\n      if (cloudEntries.length > 0) {\n        const added = store.mergeCloudEntries(cloudEntries);\n        if (added > 0) {\n          this.showSyncToast(`Synced ${added} entries from cloud`);\n        }\n      }\n\n      this.lastSyncTimestamp = data.lastUpdated || Date.now();\n      this.adjustPollingInterval(true);\n    } catch (error) {\n      console.error('Cloud sync fetch error:', error);\n\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n\n      if (errorMessage.includes('500') || errorMessage.includes('503')) {\n        store.setSyncStatus('error');\n      } else if (errorMessage.includes('Failed to fetch')) {\n        store.setSyncStatus('offline');\n      } else {\n        store.setSyncStatus('error');\n      }\n\n      this.adjustPollingInterval(false);\n    }\n  }\n\n  /**\n   * Send entry to cloud\n   */\n  async sendEntryToCloud(entry: Entry): Promise<boolean> {\n    const state = store.getState();\n    if (!state.settings.sync || !state.raceId) return false;\n\n    try {\n      const response = await fetch(\n        `${API_BASE}?raceId=${encodeURIComponent(state.raceId)}`,\n        {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            entry,\n            deviceId: state.deviceId,\n            deviceName: state.deviceName\n          })\n        }\n      );\n\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}`);\n      }\n\n      // Remove from sync queue on success\n      store.removeFromSyncQueue(entry.id);\n\n      return true;\n    } catch (error) {\n      console.error('Cloud sync send error:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Push all local entries to cloud\n   */\n  private async pushLocalEntries(): Promise<void> {\n    const state = store.getState();\n    if (!state.settings.sync || !state.raceId) return;\n\n    console.log('Pushing', state.entries.length, 'local entries to cloud');\n\n    for (const entry of state.entries) {\n      // Only push entries from this device\n      if (entry.deviceId === state.deviceId && !entry.syncedAt) {\n        await this.sendEntryToCloud(entry);\n      }\n    }\n  }\n\n  /**\n   * Start processing sync queue\n   */\n  private startQueueProcessor(): void {\n    if (this.queueInterval) {\n      clearInterval(this.queueInterval);\n    }\n\n    this.queueInterval = setInterval(() => this.processQueue(), QUEUE_PROCESS_INTERVAL);\n  }\n\n  /**\n   * Process sync queue with retry logic\n   */\n  private async processQueue(): Promise<void> {\n    if (this.isProcessingQueue) return;\n\n    const state = store.getState();\n    if (!state.settings.sync || !state.raceId || state.syncQueue.length === 0) return;\n\n    this.isProcessingQueue = true;\n\n    try {\n      const now = Date.now();\n\n      for (const item of state.syncQueue) {\n        // Skip if max retries exceeded\n        if (item.retryCount >= MAX_RETRIES) {\n          console.warn('Max retries exceeded for entry:', item.entry.id);\n          store.removeFromSyncQueue(item.entry.id);\n          continue;\n        }\n\n        // Calculate backoff delay\n        const backoffDelay = RETRY_BACKOFF_BASE * Math.pow(2, item.retryCount);\n        if (now - item.lastAttempt < backoffDelay) {\n          continue; // Not ready to retry yet\n        }\n\n        // Attempt to send\n        const success = await this.sendEntryToCloud(item.entry);\n\n        if (!success) {\n          store.updateSyncQueueItem(item.entry.id, {\n            retryCount: item.retryCount + 1,\n            lastAttempt: now,\n            error: 'Failed to sync'\n          });\n        }\n      }\n    } finally {\n      this.isProcessingQueue = false;\n    }\n  }\n\n  /**\n   * Show sync toast notification\n   */\n  private showSyncToast(message: string): void {\n    // Dispatch custom event for toast\n    window.dispatchEvent(new CustomEvent('show-toast', {\n      detail: { message, type: 'success' }\n    }));\n  }\n\n  /**\n   * Cleanup sync service\n   */\n  cleanup(): void {\n    if (this.pollInterval) {\n      clearInterval(this.pollInterval);\n      this.pollInterval = null;\n    }\n\n    if (this.queueInterval) {\n      clearInterval(this.queueInterval);\n      this.queueInterval = null;\n    }\n\n    if (this.broadcastChannel) {\n      this.broadcastChannel.close();\n      this.broadcastChannel = null;\n    }\n\n    this.consecutiveErrors = 0;\n    store.setSyncStatus('disconnected');\n    console.log('Sync service cleaned up');\n  }\n\n  /**\n   * Force refresh from cloud\n   */\n  async forceRefresh(): Promise<void> {\n    await this.fetchCloudEntries();\n  }\n\n  /**\n   * Get sync queue length\n   */\n  getQueueLength(): number {\n    return store.getState().syncQueue.length;\n  }\n\n  /**\n   * Get last sync timestamp\n   */\n  getLastSyncTime(): number {\n    return this.lastSyncTimestamp;\n  }\n}\n\n// Singleton instance\nexport const syncService = new SyncService();\n\n// Helper function to send entry and broadcast\nexport async function syncEntry(entry: Entry): Promise<void> {\n  const state = store.getState();\n\n  // Broadcast to other tabs\n  syncService.broadcastEntry(entry);\n\n  // Send to cloud if enabled\n  if (state.settings.sync && state.raceId) {\n    const success = await syncService.sendEntryToCloud(entry);\n    if (!success) {\n      // Entry will be added to queue by store\n      console.log('Entry queued for retry:', entry.id);\n    }\n  }\n}\n","import { store } from '../store';\n\n// GPS configuration\nconst GPS_OPTIONS: PositionOptions = {\n  enableHighAccuracy: true,\n  timeout: 10000,\n  maximumAge: 1000\n};\n\n// Accuracy thresholds (in meters)\nconst ACCURACY_GOOD = 10;\nconst ACCURACY_FAIR = 30;\n\nclass GpsService {\n  private watchId: number | null = null;\n  private lastPosition: GeolocationPosition | null = null;\n\n  /**\n   * Start watching GPS position\n   */\n  start(): boolean {\n    if (this.watchId !== null) {\n      return true; // Already watching\n    }\n\n    if (!navigator.geolocation) {\n      console.error('Geolocation not supported');\n      store.setGpsStatus('inactive');\n      return false;\n    }\n\n    store.setGpsStatus('searching');\n\n    try {\n      this.watchId = navigator.geolocation.watchPosition(\n        (position) => this.handlePosition(position),\n        (error) => this.handleError(error),\n        GPS_OPTIONS\n      );\n\n      console.log('GPS watching started');\n      return true;\n    } catch (error) {\n      console.error('Failed to start GPS:', error);\n      store.setGpsStatus('inactive');\n      return false;\n    }\n  }\n\n  /**\n   * Stop watching GPS position\n   */\n  stop(): void {\n    if (this.watchId !== null) {\n      navigator.geolocation.clearWatch(this.watchId);\n      this.watchId = null;\n    }\n\n    this.lastPosition = null;\n    store.setGpsStatus('inactive');\n    console.log('GPS watching stopped');\n  }\n\n  /**\n   * Handle GPS position update\n   */\n  private handlePosition(position: GeolocationPosition): void {\n    this.lastPosition = position;\n\n    const accuracy = position.coords.accuracy;\n    store.setGpsStatus('active', accuracy);\n\n    console.log(`GPS position: ${accuracy.toFixed(1)}m accuracy`);\n  }\n\n  /**\n   * Handle GPS error\n   */\n  private handleError(error: GeolocationPositionError): void {\n    console.error('GPS error:', error.message);\n\n    switch (error.code) {\n      case error.PERMISSION_DENIED:\n        store.setGpsStatus('inactive');\n        this.stop();\n        break;\n      case error.POSITION_UNAVAILABLE:\n        store.setGpsStatus('searching');\n        break;\n      case error.TIMEOUT:\n        store.setGpsStatus('searching');\n        break;\n    }\n  }\n\n  /**\n   * Get current position\n   */\n  getPosition(): GeolocationPosition | null {\n    return this.lastPosition;\n  }\n\n  /**\n   * Get current coordinates for entry\n   */\n  getCoordinates(): { latitude: number; longitude: number; accuracy: number } | undefined {\n    if (!this.lastPosition) return undefined;\n\n    return {\n      latitude: this.lastPosition.coords.latitude,\n      longitude: this.lastPosition.coords.longitude,\n      accuracy: this.lastPosition.coords.accuracy\n    };\n  }\n\n  /**\n   * Get GPS timestamp (more accurate than Date.now())\n   */\n  getTimestamp(): number | null {\n    return this.lastPosition?.timestamp ?? null;\n  }\n\n  /**\n   * Get accuracy status\n   */\n  getAccuracyStatus(): 'good' | 'fair' | 'poor' | 'unknown' {\n    if (!this.lastPosition) return 'unknown';\n\n    const accuracy = this.lastPosition.coords.accuracy;\n    if (accuracy <= ACCURACY_GOOD) return 'good';\n    if (accuracy <= ACCURACY_FAIR) return 'fair';\n    return 'poor';\n  }\n\n  /**\n   * Check if GPS is active\n   */\n  isActive(): boolean {\n    return this.watchId !== null && this.lastPosition !== null;\n  }\n\n  /**\n   * Toggle GPS based on settings\n   */\n  toggle(enabled: boolean): boolean {\n    if (enabled) {\n      return this.start();\n    } else {\n      this.stop();\n      return true;\n    }\n  }\n\n  /**\n   * Request one-time position\n   */\n  async requestPosition(): Promise<GeolocationPosition | null> {\n    if (!navigator.geolocation) return null;\n\n    return new Promise((resolve) => {\n      navigator.geolocation.getCurrentPosition(\n        (position) => {\n          this.lastPosition = position;\n          resolve(position);\n        },\n        () => resolve(null),\n        GPS_OPTIONS\n      );\n    });\n  }\n}\n\n// Singleton instance\nexport const gpsService = new GpsService();\n","import { store } from '../store';\n\n// Audio context for sound feedback\nlet audioContext: AudioContext | null = null;\n\n/**\n * Get or create AudioContext (lazy initialization)\n */\nfunction getAudioContext(): AudioContext | null {\n  if (!audioContext) {\n    try {\n      audioContext = new (window.AudioContext || (window as unknown as { webkitAudioContext: typeof AudioContext }).webkitAudioContext)();\n    } catch (error) {\n      console.warn('AudioContext not available:', error);\n      return null;\n    }\n  }\n  return audioContext;\n}\n\n/**\n * Vibrate device with pattern\n */\nexport function vibrate(pattern: number | number[]): void {\n  const settings = store.getState().settings;\n  if (!settings.haptic) return;\n\n  if (navigator.vibrate) {\n    try {\n      navigator.vibrate(pattern);\n    } catch (error) {\n      console.warn('Vibration failed:', error);\n    }\n  }\n}\n\n/**\n * Play a beep sound\n */\nexport function playBeep(frequency: number = 880, duration: number = 100): void {\n  const settings = store.getState().settings;\n  if (!settings.sound) return;\n\n  const ctx = getAudioContext();\n  if (!ctx) return;\n\n  try {\n    const oscillator = ctx.createOscillator();\n    const gainNode = ctx.createGain();\n\n    oscillator.connect(gainNode);\n    gainNode.connect(ctx.destination);\n\n    oscillator.frequency.value = frequency;\n    oscillator.type = 'sine';\n\n    // Fade out to avoid clicks\n    gainNode.gain.setValueAtTime(0.3, ctx.currentTime);\n    gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + duration / 1000);\n\n    oscillator.start(ctx.currentTime);\n    oscillator.stop(ctx.currentTime + duration / 1000);\n  } catch (error) {\n    console.warn('Sound playback failed:', error);\n  }\n}\n\n// Predefined feedback patterns\n\n/**\n * Success feedback (timestamp recorded)\n */\nexport function feedbackSuccess(): void {\n  vibrate(20);\n  playBeep(880, 100);\n}\n\n/**\n * Warning feedback (duplicate entry)\n */\nexport function feedbackWarning(): void {\n  vibrate([50, 50, 50]);\n  playBeep(440, 200);\n}\n\n/**\n * Error feedback\n */\nexport function feedbackError(): void {\n  vibrate([100, 50, 100]);\n  playBeep(220, 300);\n}\n\n/**\n * Light tap feedback (button press)\n */\nexport function feedbackTap(): void {\n  vibrate(10);\n}\n\n/**\n * Medium tap feedback (selection)\n */\nexport function feedbackSelect(): void {\n  vibrate(15);\n}\n\n/**\n * Delete feedback\n */\nexport function feedbackDelete(): void {\n  vibrate([30, 30, 30]);\n  playBeep(330, 150);\n}\n\n/**\n * Undo feedback\n */\nexport function feedbackUndo(): void {\n  vibrate([20, 20]);\n  playBeep(660, 100);\n}\n\n/**\n * Export feedback\n */\nexport function feedbackExport(): void {\n  vibrate(30);\n  playBeep(660, 150);\n}\n\n/**\n * Sync feedback\n */\nexport function feedbackSync(): void {\n  vibrate(15);\n  playBeep(550, 80);\n}\n\n/**\n * Resume AudioContext (needed after user interaction on mobile)\n */\nexport async function resumeAudio(): Promise<void> {\n  const ctx = getAudioContext();\n  if (ctx && ctx.state === 'suspended') {\n    try {\n      await ctx.resume();\n    } catch (error) {\n      console.warn('Failed to resume audio:', error);\n    }\n  }\n}\n","import { formatTime, formatDate } from '../utils';\nimport { store } from '../store';\nimport { gpsService } from '../services';\n\n/**\n * High-performance clock component using requestAnimationFrame\n * Only updates changed digits to minimize DOM manipulation\n */\nexport class Clock {\n  private container: HTMLElement;\n  private timeElement: HTMLElement;\n  private dateElement: HTMLElement;\n  private lastTimeStr = '';\n  private animationId: number | null = null;\n  private isRunning = false;\n\n  constructor(container: HTMLElement) {\n    this.container = container;\n    this.timeElement = this.createTimeElement();\n    this.dateElement = this.createDateElement();\n\n    this.container.appendChild(this.timeElement);\n    this.container.appendChild(this.dateElement);\n  }\n\n  /**\n   * Create time display element with individual digit spans\n   */\n  private createTimeElement(): HTMLElement {\n    const el = document.createElement('div');\n    el.className = 'clock-time';\n    el.setAttribute('role', 'timer');\n    el.setAttribute('aria-live', 'polite');\n    el.setAttribute('aria-label', 'Current time');\n    el.style.cssText = `\n      font-family: 'JetBrains Mono', monospace;\n      font-size: clamp(32px, 10vw, 48px);\n      font-weight: 700;\n      letter-spacing: -0.02em;\n      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);\n      -webkit-background-clip: text;\n      -webkit-text-fill-color: transparent;\n      background-clip: text;\n      text-align: center;\n    `;\n\n    // Create individual spans for each character position\n    // Format: HH:MM:SS.mmm (12 characters)\n    for (let i = 0; i < 12; i++) {\n      const span = document.createElement('span');\n      span.className = 'clock-digit';\n      span.dataset.index = String(i);\n      el.appendChild(span);\n    }\n\n    return el;\n  }\n\n  /**\n   * Create date display element\n   */\n  private createDateElement(): HTMLElement {\n    const el = document.createElement('div');\n    el.className = 'clock-date';\n    el.style.cssText = `\n      font-size: 0.875rem;\n      color: var(--text-secondary);\n      margin-top: 4px;\n      text-align: center;\n    `;\n    return el;\n  }\n\n  /**\n   * Start the clock\n   */\n  start(): void {\n    if (this.isRunning) return;\n    this.isRunning = true;\n    this.tick();\n  }\n\n  /**\n   * Stop the clock\n   */\n  stop(): void {\n    this.isRunning = false;\n    if (this.animationId !== null) {\n      cancelAnimationFrame(this.animationId);\n      this.animationId = null;\n    }\n  }\n\n  /**\n   * Clock tick using requestAnimationFrame\n   */\n  private tick = (): void => {\n    if (!this.isRunning) return;\n\n    // Use GPS timestamp if available, otherwise use Date.now()\n    const gpsTimestamp = gpsService.getTimestamp();\n    const now = gpsTimestamp ? new Date(gpsTimestamp) : new Date();\n\n    const timeStr = formatTime(now);\n\n    // Only update changed digits\n    if (timeStr !== this.lastTimeStr) {\n      this.updateDigits(timeStr);\n      this.lastTimeStr = timeStr;\n    }\n\n    // Update date once per second (when seconds change)\n    const seconds = now.getSeconds();\n    if (seconds === 0 || !this.dateElement.textContent) {\n      const state = store.getState();\n      this.dateElement.textContent = formatDate(now, state.currentLang);\n    }\n\n    this.animationId = requestAnimationFrame(this.tick);\n  };\n\n  /**\n   * Update only changed digits\n   */\n  private updateDigits(timeStr: string): void {\n    const digits = this.timeElement.querySelectorAll('.clock-digit');\n\n    for (let i = 0; i < timeStr.length && i < digits.length; i++) {\n      const digit = digits[i] as HTMLSpanElement;\n      const newChar = timeStr[i];\n\n      if (digit.textContent !== newChar) {\n        digit.textContent = newChar;\n\n        // Optional: Add subtle animation on change\n        digit.style.transform = 'scale(1.02)';\n        requestAnimationFrame(() => {\n          digit.style.transform = 'scale(1)';\n        });\n      }\n    }\n  }\n\n  /**\n   * Get current time string\n   */\n  getCurrentTime(): string {\n    return this.lastTimeStr;\n  }\n\n  /**\n   * Get current timestamp\n   */\n  getTimestamp(): Date {\n    const gpsTimestamp = gpsService.getTimestamp();\n    return gpsTimestamp ? new Date(gpsTimestamp) : new Date();\n  }\n\n  /**\n   * Cleanup\n   */\n  destroy(): void {\n    this.stop();\n    this.container.innerHTML = '';\n  }\n}\n","import type { Entry } from '../types';\nimport { formatTime, formatBib, getPointColor, escapeHtml, debounce } from '../utils';\nimport { store } from '../store';\n\n// Virtual list configuration\nconst ITEM_HEIGHT = 72; // Height of each result item in pixels\nconst BUFFER_SIZE = 5; // Number of items to render above/below viewport\nconst SCROLL_DEBOUNCE = 16; // ~60fps\n\ninterface VirtualListOptions {\n  container: HTMLElement;\n  onItemClick?: (entry: Entry, event: MouseEvent) => void;\n  onItemDelete?: (entry: Entry) => void;\n  onItemSelect?: (entry: Entry, selected: boolean) => void;\n}\n\nexport class VirtualList {\n  private container: HTMLElement;\n  private scrollContainer: HTMLElement;\n  private contentContainer: HTMLElement;\n  private entries: Entry[] = [];\n  private filteredEntries: Entry[] = [];\n  private visibleItems: Map<string, HTMLElement> = new Map();\n  private scrollTop = 0;\n  private containerHeight = 0;\n  private options: VirtualListOptions;\n  private unsubscribe: (() => void) | null = null;\n\n  constructor(options: VirtualListOptions) {\n    this.options = options;\n    this.container = options.container;\n\n    // Create scroll container\n    this.scrollContainer = document.createElement('div');\n    this.scrollContainer.className = 'virtual-scroll-container';\n    this.scrollContainer.style.cssText = `\n      height: 100%;\n      overflow-y: auto;\n      overflow-x: hidden;\n      -webkit-overflow-scrolling: touch;\n    `;\n\n    // Create content container for height\n    this.contentContainer = document.createElement('div');\n    this.contentContainer.className = 'virtual-scroll-content';\n    this.contentContainer.style.position = 'relative';\n\n    this.scrollContainer.appendChild(this.contentContainer);\n    this.container.appendChild(this.scrollContainer);\n\n    // Set up scroll listener with debounce\n    const handleScroll = debounce(() => this.onScroll(), SCROLL_DEBOUNCE);\n    this.scrollContainer.addEventListener('scroll', handleScroll, { passive: true });\n\n    // Set up resize observer\n    const resizeObserver = new ResizeObserver(() => {\n      this.containerHeight = this.scrollContainer.clientHeight;\n      this.render();\n    });\n    resizeObserver.observe(this.scrollContainer);\n\n    // Subscribe to store updates\n    this.unsubscribe = store.subscribe((state, changedKeys) => {\n      if (changedKeys.includes('entries') || changedKeys.includes('selectedEntries')) {\n        this.setEntries(state.entries);\n      }\n    });\n\n    // Initial setup\n    this.containerHeight = this.scrollContainer.clientHeight;\n  }\n\n  /**\n   * Set entries to display\n   */\n  setEntries(entries: Entry[]): void {\n    this.entries = entries;\n    this.applyFilters();\n  }\n\n  /**\n   * Apply current filters\n   */\n  applyFilters(searchTerm?: string, pointFilter?: string, statusFilter?: string): void {\n    let filtered = [...this.entries];\n\n    if (searchTerm) {\n      const term = searchTerm.toLowerCase();\n      filtered = filtered.filter(e =>\n        e.bib.toLowerCase().includes(term) ||\n        e.deviceName?.toLowerCase().includes(term)\n      );\n    }\n\n    if (pointFilter && pointFilter !== 'all') {\n      filtered = filtered.filter(e => e.point === pointFilter);\n    }\n\n    if (statusFilter && statusFilter !== 'all') {\n      filtered = filtered.filter(e => e.status === statusFilter);\n    }\n\n    // Sort by timestamp descending (newest first)\n    filtered.sort((a, b) => new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime());\n\n    this.filteredEntries = filtered;\n    this.updateContentHeight();\n    this.render();\n  }\n\n  /**\n   * Update content container height\n   */\n  private updateContentHeight(): void {\n    const totalHeight = this.filteredEntries.length * ITEM_HEIGHT;\n    this.contentContainer.style.height = `${totalHeight}px`;\n  }\n\n  /**\n   * Handle scroll event\n   */\n  private onScroll(): void {\n    this.scrollTop = this.scrollContainer.scrollTop;\n    this.render();\n  }\n\n  /**\n   * Render visible items\n   */\n  render(): void {\n    if (this.filteredEntries.length === 0) {\n      this.renderEmpty();\n      return;\n    }\n\n    // Calculate visible range\n    const startIndex = Math.max(0, Math.floor(this.scrollTop / ITEM_HEIGHT) - BUFFER_SIZE);\n    const endIndex = Math.min(\n      this.filteredEntries.length,\n      Math.ceil((this.scrollTop + this.containerHeight) / ITEM_HEIGHT) + BUFFER_SIZE\n    );\n\n    const state = store.getState();\n    const visibleIds = new Set<string>();\n\n    // Render visible items\n    for (let i = startIndex; i < endIndex; i++) {\n      const entry = this.filteredEntries[i];\n      visibleIds.add(entry.id);\n\n      let item = this.visibleItems.get(entry.id);\n      const isSelected = state.selectedEntries.has(entry.id);\n\n      if (!item) {\n        item = this.createItem(entry);\n        this.visibleItems.set(entry.id, item);\n        this.contentContainer.appendChild(item);\n      }\n\n      // Update position\n      item.style.transform = `translateY(${i * ITEM_HEIGHT}px)`;\n\n      // Update selection state\n      item.classList.toggle('selected', isSelected);\n      const checkbox = item.querySelector('.result-checkbox') as HTMLInputElement;\n      if (checkbox) {\n        checkbox.checked = isSelected;\n      }\n    }\n\n    // Remove items no longer visible\n    for (const [id, item] of this.visibleItems) {\n      if (!visibleIds.has(id)) {\n        item.remove();\n        this.visibleItems.delete(id);\n      }\n    }\n  }\n\n  /**\n   * Create a list item element\n   */\n  private createItem(entry: Entry): HTMLElement {\n    const item = document.createElement('div');\n    item.className = 'result-item';\n    item.setAttribute('role', 'listitem');\n    item.setAttribute('data-entry-id', entry.id);\n    item.style.cssText = `\n      position: absolute;\n      left: 0;\n      right: 0;\n      height: ${ITEM_HEIGHT}px;\n      display: flex;\n      align-items: center;\n      padding: 0 16px;\n      gap: 12px;\n      background: var(--surface);\n      border-bottom: 1px solid var(--surface-elevated);\n      cursor: pointer;\n      transition: background 0.2s;\n    `;\n\n    const date = new Date(entry.timestamp);\n    const timeStr = formatTime(date);\n    const bibStr = formatBib(entry.bib || '---');\n    const pointColor = getPointColor(entry.point);\n\n    item.innerHTML = `\n      <input type=\"checkbox\" class=\"result-checkbox\" aria-label=\"Select entry\"\n        style=\"width: 20px; height: 20px; accent-color: var(--primary);\">\n      <div class=\"result-bib\" style=\"font-family: 'JetBrains Mono', monospace; font-size: 1.25rem; font-weight: 600; min-width: 50px;\">\n        ${escapeHtml(bibStr)}\n      </div>\n      <div class=\"result-point\" style=\"padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 600; background: ${pointColor}20; color: ${pointColor};\">\n        ${escapeHtml(entry.point)}\n      </div>\n      <div class=\"result-time\" style=\"flex: 1; font-family: 'JetBrains Mono', monospace; color: var(--text-secondary);\">\n        ${escapeHtml(timeStr)}\n      </div>\n      ${entry.status !== 'ok' ? `\n        <span class=\"result-status\" style=\"padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; font-weight: 600; background: var(--error); color: white;\">\n          ${escapeHtml(entry.status.toUpperCase())}\n        </span>\n      ` : ''}\n      ${entry.photo ? `\n        <span class=\"result-photo-indicator\" style=\"color: var(--primary);\">\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n            <path d=\"M12 15.2a3.2 3.2 0 100-6.4 3.2 3.2 0 000 6.4z\"/>\n            <path d=\"M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z\"/>\n          </svg>\n        </span>\n      ` : ''}\n      <button class=\"result-delete\" aria-label=\"Delete entry\" style=\"background: none; border: none; color: var(--error); padding: 8px; cursor: pointer; opacity: 0.7;\">\n        <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <path d=\"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2\"/>\n        </svg>\n      </button>\n    `;\n\n    // Event listeners\n    const checkbox = item.querySelector('.result-checkbox') as HTMLInputElement;\n    checkbox.addEventListener('click', (e) => {\n      e.stopPropagation();\n      this.options.onItemSelect?.(entry, checkbox.checked);\n    });\n\n    const deleteBtn = item.querySelector('.result-delete') as HTMLButtonElement;\n    deleteBtn.addEventListener('click', (e) => {\n      e.stopPropagation();\n      this.options.onItemDelete?.(entry);\n    });\n\n    item.addEventListener('click', (e) => {\n      this.options.onItemClick?.(entry, e);\n    });\n\n    // Touch feedback\n    item.addEventListener('touchstart', () => {\n      item.style.background = 'var(--surface-elevated)';\n    }, { passive: true });\n\n    item.addEventListener('touchend', () => {\n      item.style.background = 'var(--surface)';\n    }, { passive: true });\n\n    return item;\n  }\n\n  /**\n   * Render empty state\n   */\n  private renderEmpty(): void {\n    // Clear existing items\n    for (const item of this.visibleItems.values()) {\n      item.remove();\n    }\n    this.visibleItems.clear();\n\n    this.contentContainer.innerHTML = `\n      <div class=\"empty-state\" style=\"display: flex; flex-direction: column; align-items: center; justify-content: center; height: 200px; color: var(--text-secondary);\">\n        <svg width=\"48\" height=\"48\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" style=\"margin-bottom: 16px; opacity: 0.5;\">\n          <path d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2\"/>\n        </svg>\n        <span id=\"empty-state-text\">No entries recorded</span>\n      </div>\n    `;\n  }\n\n  /**\n   * Scroll to top\n   */\n  scrollToTop(): void {\n    this.scrollContainer.scrollTo({ top: 0, behavior: 'smooth' });\n  }\n\n  /**\n   * Scroll to entry\n   */\n  scrollToEntry(entryId: string): void {\n    const index = this.filteredEntries.findIndex(e => e.id === entryId);\n    if (index !== -1) {\n      const top = index * ITEM_HEIGHT;\n      this.scrollContainer.scrollTo({ top, behavior: 'smooth' });\n    }\n  }\n\n  /**\n   * Get visible count\n   */\n  getVisibleCount(): number {\n    return this.filteredEntries.length;\n  }\n\n  /**\n   * Cleanup\n   */\n  destroy(): void {\n    if (this.unsubscribe) {\n      this.unsubscribe();\n    }\n    this.visibleItems.clear();\n    this.container.innerHTML = '';\n  }\n}\n","export type ToastType = 'success' | 'error' | 'warning' | 'info';\n\ninterface ToastOptions {\n  duration?: number;\n  type?: ToastType;\n}\n\nconst DEFAULT_DURATION = 3000;\n\n/**\n * Toast notification component\n */\nexport class Toast {\n  private container: HTMLElement;\n  private queue: Array<{ message: string; options: ToastOptions }> = [];\n  private isShowing = false;\n\n  constructor() {\n    this.container = this.createContainer();\n    document.body.appendChild(this.container);\n\n    // Listen for custom toast events\n    window.addEventListener('show-toast', ((e: CustomEvent) => {\n      this.show(e.detail.message, { type: e.detail.type });\n    }) as EventListener);\n  }\n\n  /**\n   * Create toast container\n   */\n  private createContainer(): HTMLElement {\n    const container = document.createElement('div');\n    container.id = 'toast-container';\n    container.setAttribute('role', 'status');\n    container.setAttribute('aria-live', 'polite');\n    container.style.cssText = `\n      position: fixed;\n      bottom: 80px;\n      left: 50%;\n      transform: translateX(-50%);\n      z-index: 10000;\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      gap: 8px;\n      pointer-events: none;\n    `;\n    return container;\n  }\n\n  /**\n   * Show a toast notification\n   */\n  show(message: string, options: ToastOptions = {}): void {\n    this.queue.push({ message, options });\n\n    if (!this.isShowing) {\n      this.processQueue();\n    }\n  }\n\n  /**\n   * Process toast queue\n   */\n  private processQueue(): void {\n    if (this.queue.length === 0) {\n      this.isShowing = false;\n      return;\n    }\n\n    this.isShowing = true;\n    const { message, options } = this.queue.shift()!;\n    const duration = options.duration || DEFAULT_DURATION;\n    const type = options.type || 'info';\n\n    const toast = this.createToast(message, type);\n    this.container.appendChild(toast);\n\n    // Animate in\n    requestAnimationFrame(() => {\n      toast.style.opacity = '1';\n      toast.style.transform = 'translateY(0)';\n    });\n\n    // Auto dismiss\n    setTimeout(() => {\n      toast.style.opacity = '0';\n      toast.style.transform = 'translateY(10px)';\n\n      setTimeout(() => {\n        toast.remove();\n        this.processQueue();\n      }, 200);\n    }, duration);\n  }\n\n  /**\n   * Create toast element\n   */\n  private createToast(message: string, type: ToastType): HTMLElement {\n    const toast = document.createElement('div');\n    toast.className = `toast toast-${type}`;\n\n    const colors = {\n      success: 'var(--success)',\n      error: 'var(--error)',\n      warning: 'var(--warning)',\n      info: 'var(--primary)'\n    };\n\n    const icons = {\n      success: '<path d=\"M20 6L9 17l-5-5\"/>',\n      error: '<path d=\"M18 6L6 18M6 6l12 12\"/>',\n      warning: '<path d=\"M12 9v4M12 17h.01\"/>',\n      info: '<path d=\"M12 16v-4M12 8h.01\"/>'\n    };\n\n    toast.style.cssText = `\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      padding: 12px 16px;\n      background: var(--surface-elevated);\n      border-left: 3px solid ${colors[type]};\n      border-radius: 8px;\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n      font-size: 0.875rem;\n      color: var(--text-primary);\n      opacity: 0;\n      transform: translateY(10px);\n      transition: opacity 0.2s, transform 0.2s;\n      pointer-events: auto;\n      max-width: 90vw;\n    `;\n\n    toast.innerHTML = `\n      <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"${colors[type]}\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n        <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n        ${icons[type]}\n      </svg>\n      <span>${this.escapeHtml(message)}</span>\n    `;\n\n    return toast;\n  }\n\n  /**\n   * Escape HTML to prevent XSS\n   */\n  private escapeHtml(str: string): string {\n    const div = document.createElement('div');\n    div.textContent = str;\n    return div.innerHTML;\n  }\n\n  /**\n   * Clear all toasts\n   */\n  clear(): void {\n    this.queue = [];\n    this.container.innerHTML = '';\n    this.isShowing = false;\n  }\n}\n\n// Singleton instance\nlet toastInstance: Toast | null = null;\n\n/**\n * Get toast instance\n */\nexport function getToast(): Toast {\n  if (!toastInstance) {\n    toastInstance = new Toast();\n  }\n  return toastInstance;\n}\n\n/**\n * Show toast helper\n */\nexport function showToast(message: string, type: ToastType = 'info', duration?: number): void {\n  getToast().show(message, { type, duration });\n}\n","/**\n * Pull-to-refresh component for mobile\n */\n\nconst PULL_THRESHOLD = 80; // Pixels to pull before triggering refresh\nconst RESISTANCE = 2.5; // Pull resistance factor\n\ninterface PullToRefreshOptions {\n  container: HTMLElement;\n  onRefresh: () => Promise<void>;\n}\n\nexport class PullToRefresh {\n  private container: HTMLElement;\n  private indicator: HTMLElement;\n  private onRefresh: () => Promise<void>;\n  private startY = 0;\n  private currentY = 0;\n  private isPulling = false;\n  private isRefreshing = false;\n  private scrollableParent: HTMLElement | null = null;\n\n  constructor(options: PullToRefreshOptions) {\n    this.container = options.container;\n    this.onRefresh = options.onRefresh;\n    this.indicator = this.createIndicator();\n    this.container.insertBefore(this.indicator, this.container.firstChild);\n\n    // Find scrollable parent\n    this.scrollableParent = this.findScrollableParent(this.container);\n\n    this.bindEvents();\n  }\n\n  /**\n   * Create pull indicator element\n   */\n  private createIndicator(): HTMLElement {\n    const indicator = document.createElement('div');\n    indicator.className = 'pull-indicator';\n    indicator.style.cssText = `\n      position: absolute;\n      top: -60px;\n      left: 0;\n      right: 0;\n      height: 60px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      color: var(--text-secondary);\n      font-size: 0.875rem;\n      transition: transform 0.2s;\n      pointer-events: none;\n      z-index: 100;\n    `;\n\n    indicator.innerHTML = `\n      <div class=\"pull-indicator-content\" style=\"display: flex; align-items: center; gap: 8px;\">\n        <svg class=\"pull-icon\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" style=\"transition: transform 0.2s;\">\n          <path d=\"M12 19V5M5 12l7-7 7 7\"/>\n        </svg>\n        <span class=\"pull-text\">Pull to refresh</span>\n      </div>\n      <div class=\"pull-spinner\" style=\"display: none;\">\n        <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" style=\"animation: spin 1s linear infinite;\">\n          <path d=\"M21 12a9 9 0 11-6.219-8.56\"/>\n        </svg>\n      </div>\n    `;\n\n    // Add spinner animation\n    const style = document.createElement('style');\n    style.textContent = `\n      @keyframes spin {\n        from { transform: rotate(0deg); }\n        to { transform: rotate(360deg); }\n      }\n    `;\n    document.head.appendChild(style);\n\n    return indicator;\n  }\n\n  /**\n   * Find scrollable parent element\n   */\n  private findScrollableParent(element: HTMLElement): HTMLElement | null {\n    let parent = element.parentElement;\n    while (parent) {\n      const style = getComputedStyle(parent);\n      if (style.overflowY === 'auto' || style.overflowY === 'scroll') {\n        return parent;\n      }\n      parent = parent.parentElement;\n    }\n    return null;\n  }\n\n  /**\n   * Bind touch events\n   */\n  private bindEvents(): void {\n    this.container.addEventListener('touchstart', this.onTouchStart, { passive: true });\n    this.container.addEventListener('touchmove', this.onTouchMove, { passive: false });\n    this.container.addEventListener('touchend', this.onTouchEnd, { passive: true });\n  }\n\n  /**\n   * Handle touch start\n   */\n  private onTouchStart = (e: TouchEvent): void => {\n    if (this.isRefreshing) return;\n\n    // Only enable pull-to-refresh when scrolled to top\n    const scrollTop = this.scrollableParent?.scrollTop ?? 0;\n    if (scrollTop > 0) return;\n\n    this.startY = e.touches[0].clientY;\n    this.isPulling = true;\n  };\n\n  /**\n   * Handle touch move\n   */\n  private onTouchMove = (e: TouchEvent): void => {\n    if (!this.isPulling || this.isRefreshing) return;\n\n    const scrollTop = this.scrollableParent?.scrollTop ?? 0;\n    if (scrollTop > 0) {\n      this.isPulling = false;\n      return;\n    }\n\n    this.currentY = e.touches[0].clientY;\n    const pullDistance = (this.currentY - this.startY) / RESISTANCE;\n\n    if (pullDistance > 0) {\n      e.preventDefault();\n      this.updateIndicator(pullDistance);\n    }\n  };\n\n  /**\n   * Handle touch end\n   */\n  private onTouchEnd = async (): Promise<void> => {\n    if (!this.isPulling) return;\n\n    const pullDistance = (this.currentY - this.startY) / RESISTANCE;\n    this.isPulling = false;\n\n    if (pullDistance >= PULL_THRESHOLD && !this.isRefreshing) {\n      await this.triggerRefresh();\n    } else {\n      this.resetIndicator();\n    }\n  };\n\n  /**\n   * Update indicator based on pull distance\n   */\n  private updateIndicator(distance: number): void {\n    const clampedDistance = Math.min(distance, PULL_THRESHOLD * 1.5);\n    this.indicator.style.transform = `translateY(${clampedDistance}px)`;\n\n    const progress = Math.min(distance / PULL_THRESHOLD, 1);\n    const icon = this.indicator.querySelector('.pull-icon') as HTMLElement;\n    const text = this.indicator.querySelector('.pull-text') as HTMLElement;\n\n    if (icon) {\n      icon.style.transform = `rotate(${progress * 180}deg)`;\n    }\n\n    if (text) {\n      text.textContent = progress >= 1 ? 'Release to refresh' : 'Pull to refresh';\n    }\n  }\n\n  /**\n   * Trigger refresh\n   */\n  private async triggerRefresh(): Promise<void> {\n    this.isRefreshing = true;\n\n    const content = this.indicator.querySelector('.pull-indicator-content') as HTMLElement;\n    const spinner = this.indicator.querySelector('.pull-spinner') as HTMLElement;\n\n    if (content) content.style.display = 'none';\n    if (spinner) spinner.style.display = 'flex';\n\n    this.indicator.style.transform = `translateY(${PULL_THRESHOLD}px)`;\n\n    try {\n      await this.onRefresh();\n    } finally {\n      this.isRefreshing = false;\n      if (content) content.style.display = 'flex';\n      if (spinner) spinner.style.display = 'none';\n      this.resetIndicator();\n    }\n  }\n\n  /**\n   * Reset indicator position\n   */\n  private resetIndicator(): void {\n    this.indicator.style.transform = 'translateY(0)';\n    const icon = this.indicator.querySelector('.pull-icon') as HTMLElement;\n    if (icon) {\n      icon.style.transform = 'rotate(0deg)';\n    }\n  }\n\n  /**\n   * Cleanup\n   */\n  destroy(): void {\n    this.container.removeEventListener('touchstart', this.onTouchStart);\n    this.container.removeEventListener('touchmove', this.onTouchMove);\n    this.container.removeEventListener('touchend', this.onTouchEnd);\n    this.indicator.remove();\n  }\n}\n","import type { Language, Translations } from '../types';\n\nexport const translations: Record<Language, Translations> = {\n  en: {\n    // Navigation\n    timer: 'Timer',\n    results: 'Results',\n    settings: 'Settings',\n\n    // Timer View\n    start: 'Start',\n    finish: 'Finish',\n    bib: 'Bib',\n    point: 'Point',\n    time: 'Time',\n    lastRecorded: 'Last recorded',\n\n    // Results View\n    status: 'Status',\n    noEntries: 'No entries recorded',\n    search: 'Search by bib...',\n    filter: 'Filter',\n    all: 'All',\n    total: 'Total',\n    racers: 'Racers',\n    finished: 'Finished',\n    fastest: 'Fastest',\n    average: 'Average',\n\n    // Status\n    ok: 'OK',\n    dns: 'DNS',\n    dnf: 'DNF',\n    dsq: 'DSQ',\n\n    // Actions\n    confirmDelete: 'Delete Entry',\n    confirmDeleteText: 'Are you sure you want to delete this entry?',\n    confirmClearAll: 'Clear All Results',\n    clearAllText: 'This will delete all recorded entries. This action cannot be undone.',\n    delete: 'Delete',\n    cancel: 'Cancel',\n    save: 'Save',\n    edit: 'Edit',\n    undo: 'Undo',\n    export: 'Export',\n    clearAll: 'Clear All',\n    selectAll: 'Select All',\n    deleteSelected: 'Delete Selected',\n\n    // Sync\n    connected: 'Connected',\n    connecting: 'Connecting...',\n    offline: 'Offline',\n    syncError: 'Sync error',\n    syncReceived: 'Synced from cloud',\n    raceId: 'Race ID',\n    deviceName: 'Device Name',\n    cloudSync: 'Cloud Sync',\n    syncStatus: 'Sync Status',\n    pendingSync: 'pending sync',\n\n    // Feedback\n    saved: 'Saved',\n    deleted: 'Deleted',\n    cleared: 'All entries cleared',\n    undone: 'Undone',\n    copied: 'Copied to clipboard',\n    duplicateWarning: 'Duplicate entry detected',\n    exported: 'Exported successfully',\n\n    // GPS\n    gps: 'GPS',\n    gpsActive: 'GPS Active',\n    gpsSearching: 'Searching for GPS...',\n    gpsInactive: 'GPS Inactive',\n    gpsAccuracy: 'Accuracy',\n\n    // Settings\n    simpleMode: 'Simple Mode',\n    fullMode: 'Full Mode',\n    autoIncrement: 'Auto-increment Bib',\n    hapticFeedback: 'Haptic Feedback',\n    soundFeedback: 'Sound Feedback',\n    language: 'Language',\n    backup: 'Backup',\n    restore: 'Restore',\n    importData: 'Import Data',\n    exportData: 'Export Data',\n\n    // Photo\n    photoCapture: 'Photo Capture',\n    photoCaptured: 'Photo captured',\n    photoError: 'Photo capture failed',\n    viewPhoto: 'View Photo',\n\n    // Misc\n    version: 'Version',\n    devices: 'Devices',\n    entries: 'entries',\n    selected: 'selected'\n  },\n\n  de: {\n    // Navigation\n    timer: 'Timer',\n    results: 'Ergebnisse',\n    settings: 'Einstellungen',\n\n    // Timer View\n    start: 'Start',\n    finish: 'Ziel',\n    bib: 'Startnr.',\n    point: 'Punkt',\n    time: 'Zeit',\n    lastRecorded: 'Zuletzt erfasst',\n\n    // Results View\n    status: 'Status',\n    noEntries: 'Keine Eintrge vorhanden',\n    search: 'Startnr. suchen...',\n    filter: 'Filter',\n    all: 'Alle',\n    total: 'Gesamt',\n    racers: 'Fahrer',\n    finished: 'Im Ziel',\n    fastest: 'Schnellste',\n    average: 'Durchschnitt',\n\n    // Status\n    ok: 'OK',\n    dns: 'DNS',\n    dnf: 'DNF',\n    dsq: 'DSQ',\n\n    // Actions\n    confirmDelete: 'Eintrag lschen',\n    confirmDeleteText: 'Mchten Sie diesen Eintrag wirklich lschen?',\n    confirmClearAll: 'Alle lschen',\n    clearAllText: 'Alle Eintrge werden gelscht. Diese Aktion kann nicht rckgngig gemacht werden.',\n    delete: 'Lschen',\n    cancel: 'Abbrechen',\n    save: 'Speichern',\n    edit: 'Bearbeiten',\n    undo: 'Rckgngig',\n    export: 'Exportieren',\n    clearAll: 'Alle lschen',\n    selectAll: 'Alle auswhlen',\n    deleteSelected: 'Ausgewhlte lschen',\n\n    // Sync\n    connected: 'Verbunden',\n    connecting: 'Verbinde...',\n    offline: 'Offline',\n    syncError: 'Sync-Fehler',\n    syncReceived: 'Von Cloud synchronisiert',\n    raceId: 'Rennen-ID',\n    deviceName: 'Gertename',\n    cloudSync: 'Cloud-Sync',\n    syncStatus: 'Sync-Status',\n    pendingSync: 'ausstehend',\n\n    // Feedback\n    saved: 'Gespeichert',\n    deleted: 'Gelscht',\n    cleared: 'Alle Eintrge gelscht',\n    undone: 'Rckgngig gemacht',\n    copied: 'In Zwischenablage kopiert',\n    duplicateWarning: 'Doppelter Eintrag erkannt',\n    exported: 'Erfolgreich exportiert',\n\n    // GPS\n    gps: 'GPS',\n    gpsActive: 'GPS Aktiv',\n    gpsSearching: 'GPS wird gesucht...',\n    gpsInactive: 'GPS Inaktiv',\n    gpsAccuracy: 'Genauigkeit',\n\n    // Settings\n    simpleMode: 'Einfacher Modus',\n    fullMode: 'Erweiterter Modus',\n    autoIncrement: 'Auto-Inkrement',\n    hapticFeedback: 'Haptisches Feedback',\n    soundFeedback: 'Ton-Feedback',\n    language: 'Sprache',\n    backup: 'Sichern',\n    restore: 'Wiederherstellen',\n    importData: 'Daten importieren',\n    exportData: 'Daten exportieren',\n\n    // Photo\n    photoCapture: 'Foto aufnehmen',\n    photoCaptured: 'Foto aufgenommen',\n    photoError: 'Foto-Aufnahme fehlgeschlagen',\n    viewPhoto: 'Foto anzeigen',\n\n    // Misc\n    version: 'Version',\n    devices: 'Gerte',\n    entries: 'Eintrge',\n    selected: 'ausgewhlt'\n  }\n};\n\n/**\n * Get translation for a key\n */\nexport function t(key: string, lang: Language = 'de'): string {\n  return translations[lang][key] || translations['en'][key] || key;\n}\n","import { store } from './store';\nimport { Clock, VirtualList, showToast, PullToRefresh } from './components';\nimport { syncService, gpsService, cameraService, captureTimingPhoto } from './services';\nimport { feedbackSuccess, feedbackWarning, feedbackTap, feedbackDelete, feedbackUndo, resumeAudio } from './services';\nimport { generateEntryId } from './utils';\nimport { t } from './i18n/translations';\nimport type { Entry, TimingPoint, Language } from './types';\n\n// DOM Elements cache\nlet clock: Clock | null = null;\nlet virtualList: VirtualList | null = null;\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nlet pullToRefreshInstance: PullToRefresh | null = null;\n\n/**\n * Initialize the application\n */\nexport function initApp(): void {\n  // Initialize components\n  initClock();\n  initTabs();\n  initNumberPad();\n  initTimingPoints();\n  initTimestampButton();\n  initResultsView();\n  initSettingsView();\n  initModals();\n\n  // Subscribe to state changes\n  store.subscribe(handleStateChange);\n\n  // Initialize services based on settings\n  const settings = store.getState().settings;\n  if (settings.gps) {\n    gpsService.start();\n  }\n  if (settings.sync && store.getState().raceId) {\n    syncService.initialize();\n  }\n  if (settings.photoCapture) {\n    cameraService.initialize();\n  }\n\n  // Resume audio context on first interaction\n  document.addEventListener('click', resumeAudio, { once: true });\n  document.addEventListener('touchstart', resumeAudio, { once: true });\n\n  // Apply initial state\n  applySettings();\n  updateUI();\n\n  console.log('Ski Race Timer initialized');\n}\n\n/**\n * Initialize clock component\n */\nfunction initClock(): void {\n  const container = document.getElementById('clock-container');\n  if (container) {\n    clock = new Clock(container);\n    clock.start();\n  }\n}\n\n/**\n * Initialize tab navigation\n */\nfunction initTabs(): void {\n  const tabBtns = document.querySelectorAll('.tab-btn');\n  tabBtns.forEach(btn => {\n    btn.addEventListener('click', () => {\n      const view = btn.getAttribute('data-view') as 'timer' | 'results' | 'settings';\n      if (view) {\n        store.setView(view);\n        feedbackTap();\n      }\n    });\n  });\n}\n\n/**\n * Initialize number pad\n */\nfunction initNumberPad(): void {\n  const numPad = document.getElementById('number-pad');\n  if (!numPad) return;\n\n  numPad.addEventListener('click', (e) => {\n    const target = e.target as HTMLElement;\n    const btn = target.closest('.num-btn');\n    if (!btn) return;\n\n    const num = btn.getAttribute('data-num');\n    const action = btn.getAttribute('data-action');\n\n    if (num) {\n      const state = store.getState();\n      if (state.bibInput.length < 3) {\n        store.setBibInput(state.bibInput + num);\n        feedbackTap();\n      }\n    } else if (action === 'clear') {\n      store.setBibInput('');\n      feedbackTap();\n    } else if (action === 'delete') {\n      const state = store.getState();\n      store.setBibInput(state.bibInput.slice(0, -1));\n      feedbackTap();\n    }\n  });\n}\n\n/**\n * Initialize timing point selection\n */\nfunction initTimingPoints(): void {\n  const container = document.getElementById('timing-points');\n  if (!container) return;\n\n  container.addEventListener('click', (e) => {\n    const target = e.target as HTMLElement;\n    const btn = target.closest('.timing-point-btn');\n    if (!btn) return;\n\n    const point = btn.getAttribute('data-point') as TimingPoint;\n    if (point) {\n      store.setSelectedPoint(point);\n      feedbackTap();\n    }\n  });\n}\n\n/**\n * Initialize timestamp button\n */\nfunction initTimestampButton(): void {\n  const btn = document.getElementById('timestamp-btn');\n  if (!btn) return;\n\n  btn.addEventListener('click', async () => {\n    await recordTimestamp();\n  });\n\n  // Keyboard shortcut\n  document.addEventListener('keydown', (e) => {\n    if (e.key === 'Enter' && store.getState().currentView === 'timer') {\n      e.preventDefault();\n      recordTimestamp();\n    }\n  });\n}\n\n/**\n * Record a timestamp entry\n */\nasync function recordTimestamp(): Promise<void> {\n  const state = store.getState();\n\n  if (state.isRecording) return;\n  store.setRecording(true);\n\n  try {\n    // Capture photo if enabled\n    let photo: string | null = null;\n    if (state.settings.photoCapture) {\n      photo = await captureTimingPhoto();\n    }\n\n    // Get GPS coordinates if available\n    const gpsCoords = gpsService.getCoordinates();\n\n    // Create entry\n    const entry: Entry = {\n      id: generateEntryId(state.deviceId),\n      bib: state.bibInput.padStart(3, '0'),\n      point: state.selectedPoint,\n      timestamp: new Date().toISOString(),\n      status: 'ok',\n      deviceId: state.deviceId,\n      deviceName: state.deviceName,\n      photo: photo || undefined,\n      gpsCoords\n    };\n\n    // Check for duplicate\n    const isDuplicate = state.entries.some(\n      e => e.bib === entry.bib && e.point === entry.point\n    );\n\n    // Add entry\n    store.addEntry(entry);\n\n    // Show feedback\n    if (isDuplicate) {\n      feedbackWarning();\n      showDuplicateWarning(entry);\n    } else {\n      feedbackSuccess();\n      showConfirmation(entry);\n    }\n\n    // Sync to cloud\n    syncService.broadcastEntry(entry);\n\n    // Auto-increment bib if enabled\n    if (state.settings.auto) {\n      const nextBib = String(parseInt(state.bibInput || '0', 10) + 1);\n      store.setBibInput(nextBib);\n    } else {\n      store.setBibInput('');\n    }\n\n    // Update last recorded display\n    updateLastRecorded(entry);\n\n  } finally {\n    store.setRecording(false);\n  }\n}\n\n/**\n * Show confirmation overlay\n */\nfunction showConfirmation(entry: Entry): void {\n  const overlay = document.getElementById('confirmation-overlay');\n  if (!overlay) return;\n\n  const bibEl = overlay.querySelector('.confirmation-bib') as HTMLElement | null;\n  const pointEl = overlay.querySelector('.confirmation-point') as HTMLElement | null;\n  const timeEl = overlay.querySelector('.confirmation-time') as HTMLElement | null;\n\n  if (bibEl) bibEl.textContent = entry.bib || '---';\n  if (pointEl) {\n    pointEl.textContent = entry.point;\n    pointEl.style.color = getPointColor(entry.point);\n  }\n  if (timeEl) {\n    const date = new Date(entry.timestamp);\n    timeEl.textContent = formatTimeDisplay(date);\n  }\n\n  overlay.classList.add('show');\n\n  setTimeout(() => {\n    overlay.classList.remove('show');\n  }, 1500);\n}\n\n/**\n * Show duplicate warning\n */\nfunction showDuplicateWarning(entry: Entry): void {\n  const overlay = document.getElementById('confirmation-overlay');\n  if (!overlay) return;\n\n  const warningEl = overlay.querySelector('.confirmation-duplicate') as HTMLElement | null;\n  if (warningEl) {\n    warningEl.style.display = 'flex';\n  }\n\n  showConfirmation(entry);\n\n  setTimeout(() => {\n    if (warningEl) warningEl.style.display = 'none';\n  }, 2500);\n}\n\n/**\n * Update last recorded entry display\n */\nfunction updateLastRecorded(entry: Entry): void {\n  const el = document.getElementById('last-recorded');\n  if (!el) return;\n\n  const bibEl = el.querySelector('.bib') as HTMLElement | null;\n  const pointEl = el.querySelector('.point') as HTMLElement | null;\n  const timeEl = el.querySelector('.time') as HTMLElement | null;\n\n  if (bibEl) bibEl.textContent = entry.bib || '---';\n  if (pointEl) {\n    pointEl.textContent = entry.point;\n    pointEl.style.background = `${getPointColor(entry.point)}20`;\n    pointEl.style.color = getPointColor(entry.point);\n  }\n  if (timeEl) {\n    const date = new Date(entry.timestamp);\n    timeEl.textContent = formatTimeDisplay(date);\n  }\n\n  el.classList.add('visible');\n}\n\n/**\n * Initialize results view\n */\nfunction initResultsView(): void {\n  const container = document.getElementById('results-list');\n  if (!container) return;\n\n  virtualList = new VirtualList({\n    container,\n    onItemClick: (entry) => openEditModal(entry),\n    onItemDelete: (entry) => promptDelete(entry),\n    onItemSelect: (entry, selected) => {\n      if (selected) {\n        store.toggleEntrySelection(entry.id);\n      } else {\n        store.toggleEntrySelection(entry.id);\n      }\n    }\n  });\n\n  // Initialize pull-to-refresh\n  const resultsContainer = document.querySelector('.results-view');\n  if (resultsContainer) {\n    pullToRefreshInstance = new PullToRefresh({\n      container: resultsContainer as HTMLElement,\n      onRefresh: async () => {\n        await syncService.forceRefresh();\n        showToast(t('syncReceived', store.getState().currentLang), 'success');\n      }\n    });\n  }\n\n  // Search input with debounce\n  const searchInput = document.getElementById('search-input') as HTMLInputElement;\n  if (searchInput) {\n    let searchTimeout: ReturnType<typeof setTimeout>;\n    searchInput.addEventListener('input', () => {\n      clearTimeout(searchTimeout);\n      searchTimeout = setTimeout(() => {\n        applyFilters();\n      }, 300);\n    });\n  }\n\n  // Filter selects\n  const pointFilter = document.getElementById('filter-point') as HTMLSelectElement;\n  const statusFilter = document.getElementById('filter-status') as HTMLSelectElement;\n\n  if (pointFilter) {\n    pointFilter.addEventListener('change', applyFilters);\n  }\n  if (statusFilter) {\n    statusFilter.addEventListener('change', applyFilters);\n  }\n\n  // Action buttons\n  initResultsActions();\n}\n\n/**\n * Initialize results action buttons\n */\nfunction initResultsActions(): void {\n  // Clear All button\n  const clearAllBtn = document.getElementById('clear-all-btn');\n  if (clearAllBtn) {\n    clearAllBtn.addEventListener('click', () => {\n      const state = store.getState();\n      if (state.entries.length === 0) {\n        showToast(t('noEntries', state.currentLang), 'info');\n        return;\n      }\n      openConfirmModal('clearAll');\n    });\n  }\n\n  // Undo button\n  const undoBtn = document.getElementById('undo-btn');\n  if (undoBtn) {\n    undoBtn.addEventListener('click', () => {\n      if (store.canUndo()) {\n        store.undo();\n        feedbackUndo();\n        showToast(t('undone', store.getState().currentLang), 'success');\n      }\n    });\n  }\n\n  // Export button\n  const exportBtn = document.getElementById('export-btn');\n  if (exportBtn) {\n    exportBtn.addEventListener('click', exportResults);\n  }\n\n  // Delete selected button\n  const deleteSelectedBtn = document.getElementById('delete-selected-btn');\n  if (deleteSelectedBtn) {\n    deleteSelectedBtn.addEventListener('click', () => {\n      const state = store.getState();\n      if (state.selectedEntries.size > 0) {\n        openConfirmModal('deleteSelected');\n      }\n    });\n  }\n}\n\n/**\n * Apply current filters to results\n */\nfunction applyFilters(): void {\n  if (!virtualList) return;\n\n  const searchInput = document.getElementById('search-input') as HTMLInputElement;\n  const pointFilter = document.getElementById('filter-point') as HTMLSelectElement;\n  const statusFilter = document.getElementById('filter-status') as HTMLSelectElement;\n\n  virtualList.applyFilters(\n    searchInput?.value || '',\n    pointFilter?.value || 'all',\n    statusFilter?.value || 'all'\n  );\n\n  updateStats();\n}\n\n/**\n * Initialize settings view\n */\nfunction initSettingsView(): void {\n  // Simple mode toggle\n  const simpleModeToggle = document.getElementById('simple-mode-toggle') as HTMLInputElement;\n  if (simpleModeToggle) {\n    simpleModeToggle.addEventListener('change', () => {\n      store.updateSettings({ simple: simpleModeToggle.checked });\n      applySettings();\n    });\n  }\n\n  // GPS toggle\n  const gpsToggle = document.getElementById('gps-toggle') as HTMLInputElement;\n  if (gpsToggle) {\n    gpsToggle.addEventListener('change', () => {\n      store.updateSettings({ gps: gpsToggle.checked });\n      gpsService.toggle(gpsToggle.checked);\n    });\n  }\n\n  // Sync toggle\n  const syncToggle = document.getElementById('sync-toggle') as HTMLInputElement;\n  if (syncToggle) {\n    syncToggle.addEventListener('change', () => {\n      store.updateSettings({ sync: syncToggle.checked });\n      if (syncToggle.checked && store.getState().raceId) {\n        syncService.initialize();\n      } else {\n        syncService.cleanup();\n      }\n    });\n  }\n\n  // Auto-increment toggle\n  const autoToggle = document.getElementById('auto-toggle') as HTMLInputElement;\n  if (autoToggle) {\n    autoToggle.addEventListener('change', () => {\n      store.updateSettings({ auto: autoToggle.checked });\n    });\n  }\n\n  // Haptic toggle\n  const hapticToggle = document.getElementById('haptic-toggle') as HTMLInputElement;\n  if (hapticToggle) {\n    hapticToggle.addEventListener('change', () => {\n      store.updateSettings({ haptic: hapticToggle.checked });\n    });\n  }\n\n  // Sound toggle\n  const soundToggle = document.getElementById('sound-toggle') as HTMLInputElement;\n  if (soundToggle) {\n    soundToggle.addEventListener('change', () => {\n      store.updateSettings({ sound: soundToggle.checked });\n    });\n  }\n\n  // Photo capture toggle\n  const photoToggle = document.getElementById('photo-toggle') as HTMLInputElement;\n  if (photoToggle) {\n    photoToggle.addEventListener('change', () => {\n      store.updateSettings({ photoCapture: photoToggle.checked });\n      cameraService.toggle(photoToggle.checked);\n    });\n  }\n\n  // Language toggle\n  const langToggle = document.getElementById('lang-toggle');\n  if (langToggle) {\n    langToggle.addEventListener('click', () => {\n      const newLang = store.getState().currentLang === 'de' ? 'en' : 'de';\n      store.setLanguage(newLang);\n      updateTranslations();\n    });\n  }\n\n  // Race ID input\n  const raceIdInput = document.getElementById('race-id-input') as HTMLInputElement;\n  if (raceIdInput) {\n    raceIdInput.addEventListener('change', () => {\n      store.setRaceId(raceIdInput.value.trim());\n      if (store.getState().settings.sync) {\n        syncService.initialize();\n      }\n    });\n  }\n\n  // Device name input\n  const deviceNameInput = document.getElementById('device-name-input') as HTMLInputElement;\n  if (deviceNameInput) {\n    deviceNameInput.addEventListener('change', () => {\n      store.setDeviceName(deviceNameInput.value.trim());\n    });\n  }\n}\n\n/**\n * Initialize modals\n */\nfunction initModals(): void {\n  // Close modals on overlay click\n  document.querySelectorAll('.modal-overlay').forEach(overlay => {\n    overlay.addEventListener('click', (e) => {\n      if (e.target === overlay) {\n        closeAllModals();\n      }\n    });\n  });\n\n  // Cancel buttons\n  document.querySelectorAll('[data-action=\"cancel\"]').forEach(btn => {\n    btn.addEventListener('click', closeAllModals);\n  });\n\n  // Confirm delete button\n  const confirmDeleteBtn = document.getElementById('confirm-delete-btn');\n  if (confirmDeleteBtn) {\n    confirmDeleteBtn.addEventListener('click', handleConfirmDelete);\n  }\n\n  // Save edit button\n  const saveEditBtn = document.getElementById('save-edit-btn');\n  if (saveEditBtn) {\n    saveEditBtn.addEventListener('click', handleSaveEdit);\n  }\n}\n\n/**\n * Open edit modal\n */\nfunction openEditModal(entry: Entry): void {\n  const modal = document.getElementById('edit-modal');\n  if (!modal) return;\n\n  // Store entry ID for saving\n  modal.setAttribute('data-entry-id', entry.id);\n\n  // Populate fields\n  const bibInput = document.getElementById('edit-bib-input') as HTMLInputElement;\n  const statusSelect = document.getElementById('edit-status-select') as HTMLSelectElement;\n\n  if (bibInput) bibInput.value = entry.bib || '';\n  if (statusSelect) statusSelect.value = entry.status;\n\n  modal.classList.add('show');\n}\n\n/**\n * Open confirm modal\n */\nfunction openConfirmModal(action: 'delete' | 'deleteSelected' | 'clearAll'): void {\n  const modal = document.getElementById('confirm-modal');\n  if (!modal) return;\n\n  const lang = store.getState().currentLang;\n  const titleEl = modal.querySelector('.modal-title');\n  const textEl = modal.querySelector('.modal-text');\n\n  modal.setAttribute('data-action', action);\n\n  if (action === 'clearAll') {\n    if (titleEl) titleEl.textContent = t('confirmClearAll', lang);\n    if (textEl) textEl.textContent = t('clearAllText', lang);\n  } else if (action === 'deleteSelected') {\n    const count = store.getState().selectedEntries.size;\n    if (titleEl) titleEl.textContent = t('confirmDelete', lang);\n    if (textEl) textEl.textContent = `${count} ${t('entries', lang)} ${t('selected', lang)}`;\n  } else {\n    if (titleEl) titleEl.textContent = t('confirmDelete', lang);\n    if (textEl) textEl.textContent = t('confirmDeleteText', lang);\n  }\n\n  modal.classList.add('show');\n}\n\n/**\n * Prompt delete for single entry\n */\nfunction promptDelete(entry: Entry): void {\n  const modal = document.getElementById('confirm-modal');\n  if (modal) {\n    modal.setAttribute('data-entry-id', entry.id);\n  }\n  openConfirmModal('delete');\n}\n\n/**\n * Handle confirm delete\n */\nfunction handleConfirmDelete(): void {\n  const modal = document.getElementById('confirm-modal');\n  if (!modal) return;\n\n  const action = modal.getAttribute('data-action');\n  const entryId = modal.getAttribute('data-entry-id');\n\n  if (action === 'clearAll') {\n    store.clearAll();\n    showToast(t('cleared', store.getState().currentLang), 'success');\n  } else if (action === 'deleteSelected') {\n    const ids = Array.from(store.getState().selectedEntries);\n    store.deleteMultiple(ids);\n    showToast(t('deleted', store.getState().currentLang), 'success');\n  } else if (entryId) {\n    store.deleteEntry(entryId);\n    showToast(t('deleted', store.getState().currentLang), 'success');\n  }\n\n  feedbackDelete();\n  closeAllModals();\n}\n\n/**\n * Handle save edit\n */\nfunction handleSaveEdit(): void {\n  const modal = document.getElementById('edit-modal');\n  if (!modal) return;\n\n  const entryId = modal.getAttribute('data-entry-id');\n  if (!entryId) return;\n\n  const bibInput = document.getElementById('edit-bib-input') as HTMLInputElement;\n  const statusSelect = document.getElementById('edit-status-select') as HTMLSelectElement;\n\n  store.updateEntry(entryId, {\n    bib: bibInput?.value.padStart(3, '0') || '',\n    status: statusSelect?.value as Entry['status']\n  });\n\n  showToast(t('saved', store.getState().currentLang), 'success');\n  closeAllModals();\n}\n\n/**\n * Close all modals\n */\nfunction closeAllModals(): void {\n  document.querySelectorAll('.modal-overlay.show').forEach(modal => {\n    modal.classList.remove('show');\n  });\n}\n\n/**\n * Export results\n */\nfunction exportResults(): void {\n  const state = store.getState();\n  if (state.entries.length === 0) {\n    showToast(t('noEntries', state.currentLang), 'info');\n    return;\n  }\n\n  // Create CSV content (Race Horology format)\n  const headers = ['Startnummer', 'Messpunkt', 'Zeit', 'Status', 'Gert'];\n  const rows = state.entries.map(entry => [\n    entry.bib,\n    entry.point,\n    entry.timestamp,\n    entry.status.toUpperCase(),\n    entry.deviceName || ''\n  ]);\n\n  const csvContent = [\n    headers.join(';'),\n    ...rows.map(row => row.join(';'))\n  ].join('\\n');\n\n  // Download file\n  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\n  const url = URL.createObjectURL(blob);\n  const link = document.createElement('a');\n  link.href = url;\n  link.download = `race-horology-${new Date().toISOString().slice(0, 10)}.csv`;\n  link.click();\n  URL.revokeObjectURL(url);\n\n  showToast(t('exported', state.currentLang), 'success');\n}\n\n/**\n * Handle state changes\n */\nfunction handleStateChange(state: ReturnType<typeof store.getState>, changedKeys: (keyof typeof state)[]): void {\n  // Update view visibility\n  if (changedKeys.includes('currentView')) {\n    updateViewVisibility();\n  }\n\n  // Update bib display\n  if (changedKeys.includes('bibInput')) {\n    updateBibDisplay();\n  }\n\n  // Update timing points\n  if (changedKeys.includes('selectedPoint')) {\n    updateTimingPointSelection();\n  }\n\n  // Update results list\n  if (changedKeys.includes('entries')) {\n    if (virtualList) {\n      virtualList.setEntries(state.entries);\n    }\n    updateStats();\n    updateEntryCountBadge();\n  }\n\n  // Update sync status\n  if (changedKeys.includes('syncStatus')) {\n    updateSyncStatusIndicator();\n  }\n\n  // Update GPS status\n  if (changedKeys.includes('gpsStatus')) {\n    updateGpsIndicator();\n  }\n\n  // Update undo button\n  if (changedKeys.includes('undoStack')) {\n    updateUndoButton();\n  }\n}\n\n/**\n * Update UI elements\n */\nfunction updateUI(): void {\n  updateViewVisibility();\n  updateBibDisplay();\n  updateTimingPointSelection();\n  updateStats();\n  updateEntryCountBadge();\n  updateSyncStatusIndicator();\n  updateGpsIndicator();\n  updateUndoButton();\n  updateSettingsInputs();\n  updateTranslations();\n}\n\n/**\n * Update view visibility\n */\nfunction updateViewVisibility(): void {\n  const state = store.getState();\n  document.querySelectorAll('.view').forEach(view => {\n    view.classList.remove('active');\n  });\n\n  const activeView = document.querySelector(`.${state.currentView}-view`);\n  if (activeView) {\n    activeView.classList.add('active');\n  }\n\n  // Update tab buttons\n  document.querySelectorAll('.tab-btn').forEach(btn => {\n    btn.classList.toggle('active', btn.getAttribute('data-view') === state.currentView);\n  });\n}\n\n/**\n * Update bib display\n */\nfunction updateBibDisplay(): void {\n  const state = store.getState();\n  const bibValue = document.querySelector('.bib-value');\n  if (bibValue) {\n    bibValue.textContent = state.bibInput ? state.bibInput.padStart(3, '0') : '---';\n  }\n\n  // Update timestamp button pulse\n  const timestampBtn = document.getElementById('timestamp-btn');\n  if (timestampBtn) {\n    timestampBtn.classList.toggle('ready', state.bibInput.length > 0);\n  }\n}\n\n/**\n * Update timing point selection\n */\nfunction updateTimingPointSelection(): void {\n  const state = store.getState();\n  document.querySelectorAll('.timing-point-btn').forEach(btn => {\n    btn.classList.toggle('active', btn.getAttribute('data-point') === state.selectedPoint);\n  });\n}\n\n/**\n * Update statistics\n */\nfunction updateStats(): void {\n  const state = store.getState();\n  const entries = state.entries;\n\n  const total = entries.length;\n  const racers = new Set(entries.map(e => e.bib)).size;\n  const finished = entries.filter(e => e.point === 'F' && e.status === 'ok').length;\n\n  const totalEl = document.getElementById('stat-total');\n  const racersEl = document.getElementById('stat-racers');\n  const finishedEl = document.getElementById('stat-finished');\n\n  if (totalEl) totalEl.textContent = String(total);\n  if (racersEl) racersEl.textContent = String(racers);\n  if (finishedEl) finishedEl.textContent = String(finished);\n}\n\n/**\n * Update entry count badge\n */\nfunction updateEntryCountBadge(): void {\n  const badge = document.getElementById('entry-count-badge');\n  if (badge) {\n    const count = store.getState().entries.length;\n    badge.textContent = String(count);\n    badge.style.display = count > 0 ? 'inline' : 'none';\n  }\n}\n\n/**\n * Update sync status indicator\n */\nfunction updateSyncStatusIndicator(): void {\n  const state = store.getState();\n  const dot = document.querySelector('.sync-dot');\n  const text = document.querySelector('.sync-status-text');\n\n  if (dot) {\n    dot.classList.remove('connected', 'error', 'offline');\n    if (state.syncStatus === 'connected') {\n      dot.classList.add('connected');\n    } else if (state.syncStatus === 'error') {\n      dot.classList.add('error');\n    } else if (state.syncStatus === 'offline') {\n      dot.classList.add('offline');\n    }\n  }\n\n  if (text) {\n    text.textContent = t(state.syncStatus, state.currentLang);\n  }\n}\n\n/**\n * Update GPS indicator\n */\nfunction updateGpsIndicator(): void {\n  const state = store.getState();\n  const dot = document.querySelector('.gps-dot');\n  const text = document.querySelector('.gps-status-text');\n\n  if (dot) {\n    dot.classList.remove('active', 'searching');\n    if (state.gpsStatus === 'active') {\n      dot.classList.add('active');\n    } else if (state.gpsStatus === 'searching') {\n      dot.classList.add('searching');\n    }\n  }\n\n  if (text) {\n    if (state.gpsStatus === 'active' && state.gpsAccuracy) {\n      text.textContent = `${state.gpsAccuracy.toFixed(0)}m`;\n    } else {\n      text.textContent = t(`gps${state.gpsStatus.charAt(0).toUpperCase() + state.gpsStatus.slice(1)}`, state.currentLang);\n    }\n  }\n}\n\n/**\n * Update undo button state\n */\nfunction updateUndoButton(): void {\n  const undoBtn = document.getElementById('undo-btn');\n  if (undoBtn) {\n    undoBtn.toggleAttribute('disabled', !store.canUndo());\n  }\n}\n\n/**\n * Update settings inputs\n */\nfunction updateSettingsInputs(): void {\n  const state = store.getState();\n  const { settings } = state;\n\n  (document.getElementById('simple-mode-toggle') as HTMLInputElement)?.setAttribute('checked', String(settings.simple));\n  (document.getElementById('gps-toggle') as HTMLInputElement)?.setAttribute('checked', String(settings.gps));\n  (document.getElementById('sync-toggle') as HTMLInputElement)?.setAttribute('checked', String(settings.sync));\n  (document.getElementById('auto-toggle') as HTMLInputElement)?.setAttribute('checked', String(settings.auto));\n  (document.getElementById('haptic-toggle') as HTMLInputElement)?.setAttribute('checked', String(settings.haptic));\n  (document.getElementById('sound-toggle') as HTMLInputElement)?.setAttribute('checked', String(settings.sound));\n  (document.getElementById('photo-toggle') as HTMLInputElement)?.setAttribute('checked', String(settings.photoCapture));\n\n  const raceIdInput = document.getElementById('race-id-input') as HTMLInputElement;\n  if (raceIdInput) raceIdInput.value = state.raceId;\n\n  const deviceNameInput = document.getElementById('device-name-input') as HTMLInputElement;\n  if (deviceNameInput) deviceNameInput.value = state.deviceName;\n}\n\n/**\n * Update translations\n */\nfunction updateTranslations(): void {\n  const lang = store.getState().currentLang as Language;\n\n  document.querySelectorAll('[data-i18n]').forEach(el => {\n    const key = el.getAttribute('data-i18n');\n    if (key) {\n      el.textContent = t(key, lang);\n    }\n  });\n\n  document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {\n    const key = el.getAttribute('data-i18n-placeholder');\n    if (key) {\n      (el as HTMLInputElement).placeholder = t(key, lang);\n    }\n  });\n}\n\n/**\n * Apply settings (show/hide UI based on simple mode)\n */\nfunction applySettings(): void {\n  const settings = store.getState().settings;\n\n  // Simple mode UI adjustments\n  const advancedElements = document.querySelectorAll('[data-advanced]');\n  advancedElements.forEach(el => {\n    (el as HTMLElement).style.display = settings.simple ? 'none' : '';\n  });\n\n  // Hide Start timing point in simple mode\n  const startBtn = document.querySelector('[data-point=\"S\"]') as HTMLElement;\n  if (startBtn) {\n    startBtn.style.display = settings.simple ? 'none' : '';\n  }\n\n  // Force Finish point selected in simple mode\n  if (settings.simple) {\n    store.setSelectedPoint('F');\n  }\n}\n\n/**\n * Helper: Get point color\n */\nfunction getPointColor(point: TimingPoint): string {\n  const colors: Record<TimingPoint, string> = {\n    'S': 'var(--success)',\n    'I1': 'var(--primary)',\n    'I2': 'var(--primary)',\n    'I3': 'var(--primary)',\n    'F': 'var(--secondary)'\n  };\n  return colors[point];\n}\n\n/**\n * Helper: Format time for display\n */\nfunction formatTimeDisplay(date: Date): string {\n  const hours = String(date.getHours()).padStart(2, '0');\n  const minutes = String(date.getMinutes()).padStart(2, '0');\n  const seconds = String(date.getSeconds()).padStart(2, '0');\n  const ms = String(date.getMilliseconds()).padStart(3, '0');\n  return `${hours}:${minutes}:${seconds}.${ms}`;\n}\n","import './styles/main.css';\nimport { initApp } from './app';\nimport { getToast } from './components/Toast';\n\n// Initialize toast system\ngetToast();\n\n// Initialize app when DOM is ready\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', initApp);\n} else {\n  initApp();\n}\n\n// Register service worker\nif ('serviceWorker' in navigator) {\n  window.addEventListener('load', async () => {\n    try {\n      const registration = await navigator.serviceWorker.register('/sw.js');\n      console.log('Service Worker registered:', registration.scope);\n\n      // Check for updates\n      registration.addEventListener('updatefound', () => {\n        const newWorker = registration.installing;\n        if (newWorker) {\n          newWorker.addEventListener('statechange', () => {\n            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {\n              // New version available\n              console.log('New version available');\n            }\n          });\n        }\n      });\n    } catch (error) {\n      console.error('Service Worker registration failed:', error);\n    }\n  });\n}\n\n// Handle visibility change (pause/resume)\ndocument.addEventListener('visibilitychange', () => {\n  if (document.visibilityState === 'visible') {\n    // App became visible - could refresh sync here\n    console.log('App resumed');\n  }\n});\n\n// Handle online/offline\nwindow.addEventListener('online', () => {\n  console.log('App is online');\n  // Could trigger sync queue processing here\n});\n\nwindow.addEventListener('offline', () => {\n  console.log('App is offline');\n});\n\n// Prevent accidental navigation\nwindow.addEventListener('beforeunload', () => {\n  // Only warn if there are unsaved changes\n  // For now, always allow navigation\n});\n\n// Debug info\nconsole.log('Ski Race Timer v2.0.0');\n"],"names":["generateEntryId","deviceId","timestamp","random","generateDeviceId","SCHEMA_VERSION","VALID_POINTS","VALID_STATUSES","isValidEntry","entry","isValidSyncQueueItem","item","i","isValidRaceId","raceId","isValidDeviceId","sanitizeString","str","maxLength","sanitizeEntry","e","migrateSchema","data","defaultSettings","d","entries","settings","s","syncQueue","STORAGE_KEYS","DEFAULT_SETTINGS","MAX_UNDO_STACK","Store","__publicField","entriesJson","settingsJson","syncQueueJson","parsed","lang","deviceName","listener","changedKeys","updates","persist","action","undoStack","id","ids","deletedEntries","index","oldEntry","newEntry","redoStack","result","a","b","idsToDelete","entryId","view","bib","sanitized","point","enabled","selectedEntries","isRecording","key","status","name","device","connectedDevices","accuracy","ready","error","cloudEntries","addedCount","existingIds","newEntries","jsonData","migrated","store","formatTime","date","hours","minutes","seconds","milliseconds","formatDate","options","formatBib","digits","escapeHtml","div","getPointColor","debounce","fn","delay","timeoutId","args","CAMERA_CONFIG","PHOTO_QUALITY","PHOTO_MAX_WIDTH","PHOTO_MAX_HEIGHT","CameraService","resolve","reject","errorMessage","ctx","videoWidth","videoHeight","width","height","ratio","base64","track","cameraService","captureTimingPhoto","API_BASE","POLL_INTERVAL_NORMAL","POLL_INTERVAL_ERROR","MAX_RETRIES","RETRY_BACKOFF_BASE","QUEUE_PROCESS_INTERVAL","SyncService","state","event","type","deviceInfo","interval","success","response","added","now","backoffDelay","message","syncService","GPS_OPTIONS","ACCURACY_GOOD","ACCURACY_FAIR","GpsService","position","_a","gpsService","audioContext","getAudioContext","vibrate","pattern","playBeep","frequency","duration","oscillator","gainNode","feedbackSuccess","feedbackWarning","feedbackTap","feedbackDelete","feedbackUndo","resumeAudio","Clock","container","gpsTimestamp","timeStr","el","span","digit","newChar","ITEM_HEIGHT","BUFFER_SIZE","SCROLL_DEBOUNCE","VirtualList","handleScroll","searchTerm","pointFilter","statusFilter","filtered","term","totalHeight","startIndex","endIndex","visibleIds","isSelected","checkbox","bibStr","pointColor","_b","top","DEFAULT_DURATION","Toast","toast","colors","icons","toastInstance","getToast","showToast","PULL_THRESHOLD","RESISTANCE","PullToRefresh","pullDistance","indicator","style","element","parent","distance","clampedDistance","progress","icon","text","content","spinner","translations","t","clock","virtualList","initApp","initClock","initTabs","initNumberPad","initTimingPoints","initTimestampButton","initResultsView","initSettingsView","initModals","handleStateChange","applySettings","updateUI","btn","numPad","num","recordTimestamp","photo","gpsCoords","isDuplicate","showDuplicateWarning","showConfirmation","nextBib","updateLastRecorded","overlay","bibEl","pointEl","timeEl","formatTimeDisplay","warningEl","openEditModal","promptDelete","selected","resultsContainer","searchInput","searchTimeout","applyFilters","initResultsActions","clearAllBtn","openConfirmModal","undoBtn","exportBtn","exportResults","deleteSelectedBtn","updateStats","simpleModeToggle","gpsToggle","syncToggle","autoToggle","hapticToggle","soundToggle","photoToggle","langToggle","newLang","updateTranslations","raceIdInput","deviceNameInput","closeAllModals","confirmDeleteBtn","handleConfirmDelete","saveEditBtn","handleSaveEdit","modal","bibInput","statusSelect","titleEl","textEl","count","headers","rows","csvContent","row","blob","url","link","updateViewVisibility","updateBibDisplay","updateTimingPointSelection","updateEntryCountBadge","updateSyncStatusIndicator","updateGpsIndicator","updateUndoButton","updateSettingsInputs","activeView","bibValue","timestampBtn","total","racers","finished","totalEl","racersEl","finishedEl","badge","dot","_c","_d","_e","_f","_g","startBtn","ms","registration","newWorker"],"mappings":"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"}