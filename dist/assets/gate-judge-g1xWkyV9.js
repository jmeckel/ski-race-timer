import{s as u,a as y,t as f,g as Rt,e as I,b as Y,L as G,m as gt,c as _,f as j,d as S,h as Ct,i as w,j as Ft,k as Mt,l as xt,n as Dt,v as h,o as k,p as b,q as at,r as Nt,u as lt}from"./chief-judge-uEHOwmjD.js";const qt="modulepreload",Gt=function(t){return"/"+t},ut={},jt=function(e,n,a){let s=Promise.resolve();if(n&&n.length>0){let o=function(d){return Promise.all(d.map(l=>Promise.resolve(l).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),r=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));s=o(n.map(d=>{if(d=Gt(d),d in ut)return;ut[d]=!0;const l=d.endsWith(".css"),g=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${g}`))return;const m=document.createElement("link");if(m.rel=l?"stylesheet":qt,l||(m.as="script"),m.crossOrigin="",m.href=d,r&&m.setAttribute("nonce",r),document.head.appendChild(m),l)return new Promise((v,p)=>{m.addEventListener("load",v),m.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(o){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=o,window.dispatchEvent(c),!c.defaultPrevented)throw o}return s.then(o=>{for(const c of o||[])c.status==="rejected"&&i(c.reason);return e().catch(i)})},st=new WeakMap;function ft(t,e){st.set(t,e)}function Ot(t){return st.get(t)??null}function Ee(t){st.delete(t)}const Jt=["a[href]","button:not([disabled])","textarea:not([disabled])","input:not([disabled])","select:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","),z=new WeakMap,Vt=new Set(["confirm-modal","fault-delete-modal","delete-race-confirm-modal","mark-deletion-modal","race-deleted-modal","onboarding-modal"]);function mt(t){return Array.from(t.querySelectorAll(Jt)).filter(e=>!e.hasAttribute("disabled")&&e.tabIndex!==-1)}function _t(t){const e=mt(t);if(e.length>0){e[0].focus();return}t.hasAttribute("tabindex")||t.setAttribute("tabindex","-1"),t.focus()}function Ht(t){const e=a=>{if(a.key==="Escape"){R(t);return}if(a.key!=="Tab")return;const s=mt(t);if(s.length===0){a.preventDefault();return}const i=s[0],o=s[s.length-1],c=document.activeElement;if(a.shiftKey){(!c||c===i||c===t)&&(a.preventDefault(),o.focus());return}c===o&&(a.preventDefault(),i.focus())};t.addEventListener("keydown",e);let n;Vt.has(t.id)||(n=a=>{a.target===t&&R(t)},t.addEventListener("click",n)),z.set(t,{previousFocus:document.activeElement,keydownHandler:e,clickOutsideHandler:n})}function Pt(t){const e=z.get(t);if(!e)return;t.removeEventListener("keydown",e.keydownHandler),e.clickOutsideHandler&&t.removeEventListener("click",e.clickOutsideHandler),z.delete(t);const n=e.previousFocus;n&&typeof n.focus=="function"&&n.focus()}function R(t){!t||!t.classList.contains("show")||(t.classList.add("closing"),setTimeout(()=>{t.classList.remove("show","closing"),Pt(t)},150))}function O(t){if(!t)return;t.hasAttribute("role")||t.setAttribute("role","dialog"),t.setAttribute("aria-modal","true");const e=t.classList.contains("show");t.classList.add("show"),z.has(t)||Ht(t),e||setTimeout(()=>_t(t),0)}function he(){document.querySelectorAll(".modal-overlay.show").forEach(t=>{R(t)})}function Ut(){return document.querySelectorAll(".modal-overlay.show").length>0}const x=new G;let E=null;function ot(t,e,n){const a=u.getState(),s={id:`fault-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,bib:t,run:a.selectedRun,gateNumber:e,faultType:n,timestamp:new Date().toISOString(),deviceId:a.deviceId,deviceName:a.deviceName,gateRange:a.gateAssignment||[1,1]};u.addFaultEntry(s),Ct();const i=u.getState().faultEntries.find(o=>o.id===s.id);i&&(_(i),Wt(i)),y(f("faultRecorded",a.currentLang),"success")}function Wt(t){const e=document.getElementById("fault-confirmation-overlay");if(!e)return;ft(e,{faultId:t.id});const n=e.querySelector(".fault-confirmation-bib"),a=e.querySelector(".fault-confirmation-gate"),s=e.querySelector(".fault-confirmation-type"),i=u.getState();n&&(n.textContent=t.bib),a&&(a.textContent=`${f("gate",i.currentLang)} ${t.gateNumber}`),s&&(s.textContent=Y(t.faultType,i.currentLang)),e.classList.add("show")}function Ie(){const t=document.getElementById("save-fault-edit-btn");t&&x.add(t,"click",zt);const e=document.getElementById("restore-version-btn");e&&x.add(e,"click",Kt);const n=document.getElementById("fault-edit-bib-input");n&&gt(n,3);const a=document.getElementById("fault-edit-run-selector");a&&x.add(a,"click",r=>{const l=r.target.closest(".edit-run-btn");l&&a.querySelectorAll(".edit-run-btn").forEach(g=>{g.classList.toggle("active",g===l),g.setAttribute("aria-checked",g===l?"true":"false")})});const s=document.getElementById("fault-edit-notes"),i=document.getElementById("fault-edit-notes-char-count");s&&i&&x.add(s,"input",()=>{const r=s.value.length;i.textContent=`${r}/500`,i.classList.toggle("near-limit",r>450)});const o=document.getElementById("fault-edit-mic-btn");o&&x.add(o,"click",()=>{window.dispatchEvent(new CustomEvent("fault-edit-mic-click",{detail:{faultId:E}}))});const c=document.getElementById("confirm-mark-deletion-btn");c&&x.add(c,"click",Xt)}function Le(t){if(t.markedForDeletion){const m=u.getState().currentLang;y(f("cannotEditPendingDeletion",m),"warning");return}const e=document.getElementById("fault-edit-modal");if(!e)return;E=t.id;const a=u.getState().currentLang,s=document.getElementById("fault-edit-bib-input"),i=document.getElementById("fault-edit-gate-input"),o=document.getElementById("fault-edit-type-select"),c=document.getElementById("fault-edit-gate-range"),r=document.getElementById("fault-version-select"),d=document.getElementById("fault-edit-notes"),l=document.getElementById("fault-edit-notes-char-count");if(s&&(s.value=t.bib||""),i&&(i.value=String(t.gateNumber)),o&&(o.value=t.faultType),d&&(d.value=t.notes||""),l){const m=(t.notes||"").length;l.textContent=`${m}/500`}c&&t.gateRange&&(c.textContent=`(${f("gates",a)} ${t.gateRange[0]}-${t.gateRange[1]})`);const g=document.getElementById("fault-edit-run-selector");if(g&&g.querySelectorAll(".edit-run-btn").forEach(m=>{const v=m.getAttribute("data-run");m.classList.toggle("active",v===String(t.run))}),r){r.innerHTML="";const m=document.createElement("option");m.value=String(t.currentVersion||1),m.textContent=`v${t.currentVersion||1} - ${f("currentVersion",a)}`,r.appendChild(m);const p=[...t.versionHistory||[]].sort((L,B)=>B.version-L.version).filter(L=>L.version!==t.currentVersion);for(const L of p){const B=document.createElement("option");B.value=String(L.version);const C=new Date(L.timestamp).toLocaleTimeString(Rt(a),{hour:"2-digit",minute:"2-digit"}),tt=L.changeType==="create"?f("originalVersion",a):L.changeType==="restore"?f("restored",a):L.editedBy;B.textContent=`v${L.version} - ${tt} (${C})`,r.appendChild(B)}}O(e)}function zt(){if(!E)return;const t=u.getState(),e=t.faultEntries.find(C=>C.id===E);if(!e)return;const n=document.getElementById("fault-edit-bib-input"),a=document.getElementById("fault-edit-gate-input"),s=document.getElementById("fault-edit-type-select"),i=document.getElementById("fault-edit-run-selector"),o=document.getElementById("fault-edit-notes"),c=(n==null?void 0:n.value.padStart(3,"0"))||e.bib,r=parseInt((a==null?void 0:a.value)||String(e.gateNumber),10),d=(s==null?void 0:s.value)||e.faultType,l=(o==null?void 0:o.value.trim().slice(0,500))||"",g=t.currentLang;e.gateRange&&(r<e.gateRange[0]||r>e.gateRange[1])&&y(f("gateOutOfRange",g),"warning");const m=i==null?void 0:i.querySelector(".edit-run-btn.active"),v=m?parseInt(m.getAttribute("data-run")||"1",10):e.run,p=[];if(c!==e.bib&&p.push(`bib: ${e.bib} → ${c}`),r!==e.gateNumber&&p.push(`gate: ${e.gateNumber} → ${r}`),d!==e.faultType&&p.push(`type: ${e.faultType} → ${d}`),v!==e.run&&p.push(`run: ${e.run} → ${v}`),l!==(e.notes||"")){const C=l?`notes: ${l.slice(0,30)}${l.length>30?"...":""}`:"notes removed";p.push(C)}const L=p.length>0?p.join(", "):void 0,B={bib:c,gateNumber:r,faultType:d,run:v};if(l!==(e.notes||"")&&(B.notes=l||void 0,B.notesSource=l?"manual":void 0,B.notesTimestamp=l?new Date().toISOString():void 0),u.updateFaultEntryWithHistory(E,B,L)){const C=u.getState().faultEntries.find(tt=>tt.id===E);C&&_(C),y(f("saved",g),"success"),j()}R(document.getElementById("fault-edit-modal")),E=null}function Kt(){if(!E)return;const t=document.getElementById("fault-version-select"),e=parseInt((t==null?void 0:t.value)||"0",10);if(!e)return;const n=u.getState(),a=n.faultEntries.find(i=>i.id===E);if(a&&e===a.currentVersion)return;if(u.restoreFaultVersion(E,e)){const i=u.getState().faultEntries.find(c=>c.id===E);i&&_(i);const o=n.currentLang;y(f("versionRestored",o),"success"),j(),R(document.getElementById("fault-edit-modal")),E=null}}function Be(t){const e=document.getElementById("mark-deletion-modal");if(!e)return;E=t.id;const a=u.getState().currentLang,s=document.getElementById("mark-deletion-details");s&&(s.innerHTML=`
      <div>#${I(t.bib.padStart(3,"0"))} T${I(String(t.gateNumber))} (${I(Y(t.faultType,a))}) - ${I(f(t.run===1?"run1":"run2",a))}</div>
    `),O(e)}function Xt(){if(!E)return;if(u.markFaultForDeletion(E)){const e=u.getState().faultEntries.find(a=>a.id===E);e&&_(e);const n=u.getState().currentLang;y(f("markedForDeletion",n),"info"),S()}R(document.getElementById("mark-deletion-modal")),E=null}const D=new G;let $="",T=0,q=null;function bt(){const t=document.getElementById("inline-bib-input");t&&(t.classList.remove("bib-auto-filled"),t.offsetWidth,t.classList.add("bib-auto-filled"))}function Z(){const t=document.getElementById("active-bibs-list"),e=document.getElementById("no-active-bibs");if(!t)return;const n=u.getState(),a=u.getActiveBibs(n.selectedRun);if(t.querySelectorAll(".active-bib-card").forEach(o=>o.remove()),a.length===0){e&&(e.style.display="");return}e&&(e.style.display="none");const s=new Map;n.entries.forEach(o=>{o.point==="S"&&o.run===n.selectedRun&&s.set(o.bib,new Date(o.timestamp))}),[...a].sort((o,c)=>{var l,g;const r=((l=s.get(o))==null?void 0:l.getTime())||0;return(((g=s.get(c))==null?void 0:g.getTime())||0)-r}).forEach(o=>{const c=s.get(o),r=u.getFaultsForBib(o,n.selectedRun),d=r.length>0,l=document.createElement("div");l.className=`active-bib-card${d?" has-fault":""}`,l.setAttribute("data-bib",I(o)),l.setAttribute("role","listitem");const g=c?xt(c):"--:--:--";l.innerHTML=`
      <div class="bib-card-info">
        <span class="bib-card-number">${I(o)}</span>
        <span class="bib-card-time">${I(g)}</span>
        ${d?`<span class="bib-fault-indicator">${r.length} ${f("faultCount",n.currentLang)}</span>`:""}
      </div>
      <div class="bib-card-actions">
        <button class="bib-action-btn fault" data-action="fault" aria-label="${w(f("recordFault",n.currentLang))}">${f("faultMGShort",n.currentLang)}</button>
        <button class="bib-action-btn ok" data-action="ok" aria-label="${w(f("markOk",n.currentLang))}">${f("ok",n.currentLang)}</button>
      </div>
    `,l.addEventListener("click",m=>{const p=m.target.closest(".bib-action-btn");if(p){const L=p.getAttribute("data-action");L==="fault"?(S(),jt(async()=>{const{openFaultRecordingModal:B}=await Promise.resolve().then(()=>ie);return{openFaultRecordingModal:B}},void 0).then(({openFaultRecordingModal:B})=>{B(o)})):L==="ok"&&(S(),y(f("ok",n.currentLang),"success",1e3))}}),t.appendChild(l)})}function yt(){const t=document.getElementById("gate-judge-faults-list"),e=document.getElementById("inline-fault-count"),n=document.getElementById("no-faults-recorded-inline");if(!t)return;const a=u.getState(),s=a.currentLang,i=a.faultEntries.filter(c=>c.run===a.selectedRun&&!c.markedForDeletion);if(e&&(e.textContent=String(i.length),e.setAttribute("data-count",String(i.length))),t.querySelectorAll(".gate-judge-fault-item").forEach(c=>c.remove()),i.length===0){n&&(n.style.display="");return}n&&(n.style.display="none"),[...i].sort((c,r)=>new Date(r.timestamp).getTime()-new Date(c.timestamp).getTime()).forEach(c=>{const r=u.getGateColor(c.gateNumber),d=c.notes&&c.notes.length>0,l=document.createElement("div");l.className="gate-judge-fault-item",l.setAttribute("data-fault-id",c.id),l.innerHTML=`
      <div class="gate-judge-fault-info">
        <span class="gate-judge-fault-bib">${I(c.bib)}</span>
        <div class="gate-judge-fault-details">
          <span class="gate-judge-fault-gate ${I(r)}">T${I(String(c.gateNumber))}</span>
          <span class="gate-judge-fault-type">${I(Y(c.faultType,s))}</span>
          ${d?`<span class="gate-judge-fault-note-icon" title="${w(f("hasNote",s))}" aria-label="${w(f("hasNote",s))}">${Ft(14)}</span>`:""}
        </div>
      </div>
      <button class="gate-judge-fault-delete" aria-label="${f("deleteLabel",s)}">
        ${Mt(18)}
      </button>
    `;const g=l.querySelector(".gate-judge-fault-delete");g&&g.addEventListener("click",m=>{m.stopPropagation(),S(),se(c)}),t.appendChild(l)})}function Qt(){const t=u.getState(),e=u.getActiveBibs(t.selectedRun);!$&&e.length>0&&($=e[0],bt());const n=document.getElementById("inline-bib-input");n&&$&&(n.value=$),F()}function Yt(t){$=t;const e=document.getElementById("inline-bib-input");e&&(e.value=t),F()}function Zt(){const t=document.getElementById("inline-gate-selector");if(!t)return;const e=u.getState(),n=e.currentLang,[a,s]=e.gateAssignment||[1,10];t.innerHTML="";const i=new Map;e.faultEntries.forEach(o=>{o.run===e.selectedRun&&!o.markedForDeletion&&i.set(o.gateNumber,(i.get(o.gateNumber)||0)+1)});for(let o=a;o<=s;o++){const c=u.getGateColor(o),r=i.get(o)||0,d=document.createElement("button");if(d.className=`gate-grid-btn ${c}`,d.setAttribute("data-gate",String(o)),d.setAttribute("role","radio"),d.setAttribute("aria-checked",String(o===T)),d.setAttribute("aria-label",`${f("gateNumberLabel",n)} ${o}${r?` (${r})`:""}`),d.textContent=String(o),r>0){const l=document.createElement("span");l.className="gate-fault-count",l.textContent=String(r),l.setAttribute("aria-hidden","true"),d.appendChild(l)}o===T&&d.classList.add("selected"),d.addEventListener("click",()=>{S(),et(o)}),d.addEventListener("keydown",l=>{const g=Array.from(t.querySelectorAll(".gate-grid-btn")),m=g.indexOf(d);switch(l.key){case" ":case"Enter":l.preventDefault(),S(),et(o);break;case"ArrowLeft":l.preventDefault(),m>0&&g[m-1].focus();break;case"ArrowRight":l.preventDefault(),m<g.length-1&&g[m+1].focus();break;case"ArrowUp":l.preventDefault(),m>=5&&g[m-5].focus();break;case"ArrowDown":l.preventDefault(),m+5<g.length&&g[m+5].focus();break;default:if(/^[0-9]$/.test(l.key)){l.preventDefault();const v=l.key==="0"?10:parseInt(l.key,10);if(v>=a&&v<=s){const p=t.querySelector(`[data-gate="${v}"]`);p&&(S(),et(v),p.focus())}}}}),t.appendChild(d)}}function et(t){if(T===t){T=0,pt(),F(),document.querySelectorAll("#inline-gate-selector .gate-grid-btn").forEach(n=>{n.classList.remove("selected"),n.setAttribute("aria-checked","false")});return}T=t,document.querySelectorAll("#inline-gate-selector .gate-grid-btn").forEach(n=>{const a=n.getAttribute("data-gate")===String(t);n.classList.toggle("selected",a),n.setAttribute("aria-checked",String(a))}),te(t),$||ee(),F()}function te(t){const e=document.getElementById("fault-detail-panel"),n=document.getElementById("fault-detail-gate-label");if(!e)return;const s=u.getState().currentLang,i=u.getGateColor(t);n&&(n.textContent=`${f("gate",s)} ${t}`,n.style.color=i==="red"?"var(--error)":"var(--primary)"),e.style.display=""}function pt(){const t=document.getElementById("fault-detail-panel");t&&(t.style.display="none")}function ee(){const t=u.getState(),e=u.getActiveBibs(t.selectedRun);if(e.length===0)return;const n=new Map;t.entries.forEach(s=>{s.point==="S"&&s.run===t.selectedRun&&n.set(s.bib,new Date(s.timestamp).getTime())});const a=[...e].sort((s,i)=>(n.get(i)||0)-(n.get(s)||0));Yt(a[0]),bt()}function ne(){D.removeAll();const t=document.getElementById("inline-bib-input");t&&(gt(t,3),D.add(t,"input",()=>{t.value&&($=t.value.padStart(3,"0"),F())}));const e=document.getElementById("fault-detail-close");e&&D.add(e,"click",()=>{T=0,q=null,pt(),document.querySelectorAll("#inline-gate-selector .gate-grid-btn").forEach(s=>{s.classList.remove("selected"),s.setAttribute("aria-checked","false")}),document.querySelectorAll("#inline-fault-types .inline-fault-type-btn").forEach(s=>{s.classList.remove("selected"),s.setAttribute("aria-pressed","false")}),F()});const n=document.getElementById("inline-fault-types");if(n){const s=i=>{S(),q=i.getAttribute("data-fault"),n.querySelectorAll(".inline-fault-type-btn").forEach(c=>{c.classList.toggle("selected",c===i),c.setAttribute("aria-pressed",String(c===i))}),F()};D.add(n,"click",i=>{const c=i.target.closest(".inline-fault-type-btn");c&&s(c)}),D.add(n,"keydown",i=>{const o=i,r=o.target.closest(".inline-fault-type-btn");if(r&&(o.key===" "||o.key==="Enter")){o.preventDefault(),s(r);return}const d=o.key.toUpperCase();let l=null;switch(d){case"M":case"G":l="MG";break;case"T":l="STR";break;case"B":case"R":l="BR";break}if(l){o.preventDefault();const g=n.querySelector(`[data-fault="${l}"]`);g&&(s(g),g.focus())}})}const a=document.getElementById("inline-save-fault-btn");a&&D.add(a,"click",ae)}function F(){const t=document.getElementById("inline-save-fault-btn");if(t){const e=$&&T>0&&q;t.disabled=!e}}function ae(){const t=u.getState().currentLang;if(!$){y(f("selectBib",t),"warning");return}if(!T){y(f("selectGate",t),"warning");return}if(!q){y(f("selectFaultType",t),"warning");return}ot($,T,q),q=null,document.querySelectorAll("#inline-fault-types .inline-fault-type-btn").forEach(e=>{e.classList.remove("selected"),e.setAttribute("aria-pressed","false")}),K()}function se(t){const e=document.getElementById("fault-delete-modal");if(!e){u.markFaultForDeletion(t.id);const i=u.getState().faultEntries.find(o=>o.id===t.id);i&&Dt(i),yt(),y(f("faultDeleted",u.getState().currentLang),"success");return}ft(e,{faultId:t.id});const n=u.getState(),a=u.getGateColor(t.gateNumber),s=e.querySelector(".delete-fault-info");s&&(s.innerHTML=`
      <strong>#${I(t.bib)}</strong> -
      <span class="fault-gate ${a}">T${I(String(t.gateNumber))}</span>
      (${I(Y(t.faultType,n.currentLang))}) -
      ${f("run1",n.currentLang).replace("1",String(t.run))}
    `),O(e)}function K(){yt(),Qt(),Zt(),F()}const H=new G;function oe(t){const e=u.getState(),n=e.currentLang,a=u.getActiveBibs(e.selectedRun);H.removeAll();const s=document.getElementById("fault-bib-selector");s&&(s.innerHTML=a.map(r=>`
      <button class="fault-bib-btn ${r===t?"selected":""}" data-bib="${w(r)}" aria-label="${w(f("selectBib",n))} ${w(r)}">${I(r)}</button>
    `).join(""),s.querySelectorAll(".fault-bib-btn").forEach(r=>{H.add(r,"click",()=>{s.querySelectorAll(".fault-bib-btn").forEach(l=>l.classList.remove("selected")),r.classList.add("selected");const d=document.getElementById("fault-bib-input");d&&(d.value=""),u.setSelectedFaultBib(r.getAttribute("data-bib")||"")})}));const i=document.getElementById("fault-bib-input");i&&(i.value=t||"",H.add(i,"input",()=>{s==null||s.querySelectorAll(".fault-bib-btn").forEach(r=>r.classList.remove("selected")),u.setSelectedFaultBib(i.value.padStart(3,"0"))})),u.setSelectedFaultBib(t||"");const o=document.getElementById("fault-gate-selector");if(o&&e.gateAssignment){const[r,d]=e.gateAssignment;let l="";for(let g=r;g<=d;g++){const v=u.getGateColor(g)==="red"?"gate-red":"gate-blue";l+=`<button class="fault-gate-btn ${v}" data-gate="${g}" aria-label="${w(f("gateNumberLabel",n))} ${g}">${g}</button>`}o.innerHTML=l,o.querySelectorAll(".fault-gate-btn").forEach(g=>{H.add(g,"click",()=>{o.querySelectorAll(".fault-gate-btn").forEach(m=>m.classList.remove("selected")),g.classList.add("selected")})})}const c=document.getElementById("fault-type-buttons");c&&c.querySelectorAll(".fault-type-btn").forEach(r=>{r.classList.remove("selected")}),O(document.getElementById("fault-modal"))}const nt=new G;function vt(){const t=document.getElementById("fault-type-buttons");if(t){const n=a=>{const s=t.querySelector(`[data-fault="${a}"]`);s&&(t.querySelectorAll(".fault-type-btn").forEach(i=>i.classList.remove("selected")),s.classList.add("selected"),S())};nt.add(t,"click",a=>{const i=a.target.closest(".fault-type-btn");if(!i)return;const o=i.getAttribute("data-fault");o&&n(o)}),nt.add(t,"keydown",(a=>{const i=a.target.closest(".fault-type-btn");if(i&&(a.key===" "||a.key==="Enter")){a.preventDefault();const c=i.getAttribute("data-fault");c&&n(c);return}const o=a.key.toUpperCase();o==="M"||o==="G"?(a.preventDefault(),n("MG")):o==="T"?(a.preventDefault(),n("STR")):(o==="B"||o==="R")&&(a.preventDefault(),n("BR"))}))}const e=document.getElementById("save-fault-btn");e&&nt.add(e,"click",()=>{const n=document.querySelector("#fault-type-buttons .fault-type-btn.selected");if(!n){const s=u.getState().currentLang;y(f("selectFaultType",s),"warning");return}const a=n.getAttribute("data-fault");a&&St(a)})}function St(t){const e=u.getState();let n=e.selectedFaultBib;if(!n){const i=document.getElementById("fault-bib-input");n=(i==null?void 0:i.value.padStart(3,"0"))||""}if(!n){y(f("selectBib",e.currentLang),"warning");return}const a=document.querySelector("#fault-gate-selector .fault-gate-btn.selected"),s=a?parseInt(a.getAttribute("data-gate")||"0",10):0;if(!s){y(f("selectGate",e.currentLang),"warning");return}ot(n,s,t),R(document.getElementById("fault-modal")),Z()}function Et(t,e,n){const a=u.getState();if(a.gateAssignment){const[s,i]=a.gateAssignment;if(e<s||e>i){y(f("gateOutOfRange",a.currentLang),"warning");return}}ot(t.padStart(3,"0"),e,n),Z()}const ie=Object.freeze(Object.defineProperty({__proto__:null,initFaultRecordingModal:vt,openFaultRecordingModal:oe,recordFault:St,recordFaultFromVoice:Et},Symbol.toStringTag,{value:"Module"})),A=new G;let N=null,V="",U=null,W=null,dt=null;const X=500;function ce(t){const e=document.getElementById("voice-note-modal");if(!e)return;N=t,V="";const a=u.getState().faultEntries.find(o=>o.id===t),s=document.getElementById("voice-note-textarea");s&&(s.value=(a==null?void 0:a.notes)||"",ct());const i=document.getElementById("voice-note-mic-btn");i&&(i.classList.toggle("unsupported",!h.isSupported()),i.classList.remove("loading")),it(!1),h.isSupported()&&h.initialize(),O(e),requestAnimationFrame(()=>s==null?void 0:s.focus())}function J(){h.stop(),ht(),N=null,V="",R(document.getElementById("voice-note-modal")),k.resume()}function re(){if(!N)return;const t=document.getElementById("voice-note-textarea"),e=(t==null?void 0:t.value.trim().slice(0,X))||"",n=u.getState();if(!n.faultEntries.find(c=>c.id===N))return;const s=V?"voice":"manual",i=e?`notes: ${e.slice(0,30)}${e.length>30?"...":""}`:"notes removed";if(u.updateFaultEntryWithHistory(N,{notes:e||void 0,notesSource:e?s:void 0,notesTimestamp:e?new Date().toISOString():void 0},i)){const c=u.getState().faultEntries.find(d=>d.id===N);c&&_(c);const r=n.currentLang;y(f("noteSaved",r),"success"),j()}J()}function le(){const t=u.getState().currentLang;if(!h.isSupported()){y(f("voiceNoteUnsupported",t),"warning");return}const e=document.getElementById("voice-note-mic-btn");e==null||e.classList.add("loading"),k.pause(),U=h.onStatusChange(a=>{e==null||e.classList.remove("loading"),it(a==="listening"),a==="error"&&(y(f("voiceNoteError",t),"warning"),k.resume())}),W=h.onTranscript((a,s)=>{const i=document.getElementById("voice-note-textarea");if(i&&s){V+=(V?" ":"")+a;const o=i.value,c=o?`${o} ${a}`:a;i.value=c.slice(0,X),ct()}}),h.start()?S():(e==null||e.classList.remove("loading"),k.resume())}function ue(){h.stop(),ht(),it(!1),k.resume()}function de(){h.isRecording()?ue():le()}function it(t){const e=document.getElementById("voice-note-listening-indicator"),n=document.getElementById("voice-note-mic-btn");e&&e.classList.toggle("active",t),n&&(n.classList.toggle("recording",t),n.setAttribute("aria-pressed",String(t)))}function ct(){const t=document.getElementById("voice-note-textarea"),e=document.getElementById("voice-note-char-count");if(t&&e){const n=t.value.length;e.textContent=`${n}/${X}`,e.classList.toggle("near-limit",n>X*.9)}}function ht(){U&&(U(),U=null),W&&(W(),W=null)}function ge(){const t=document.getElementById("voice-note-modal"),e=document.getElementById("voice-note-mic-btn");e&&A.add(e,"click",de);const n=document.getElementById("voice-note-save-btn");n&&A.add(n,"click",re);const a=document.getElementById("voice-note-cancel-btn");a&&A.add(a,"click",J);const s=document.getElementById("voice-note-close-btn");s&&A.add(s,"click",J);const i=document.getElementById("voice-note-textarea");i&&A.add(i,"input",ct),t&&(A.add(t,"keydown",(o=>{o.key==="Escape"&&(o.preventDefault(),J())})),A.add(t,"click",o=>{o.target===t&&J()}))}function P(){const t=document.getElementById("fault-confirmation-overlay");t!=null&&t.classList.contains("show")&&t.classList.remove("show")}function fe(){const t=document.getElementById("fault-confirmation-overlay"),e=t==null?void 0:t.querySelector(".fault-confirmation-content"),n=document.getElementById("fault-confirmation-add-note-btn");n&&A.add(n,"click",()=>{var i;S();const s=t?((i=Ot(t))==null?void 0:i.faultId)||t.getAttribute("data-fault-id"):void 0;P(),s&&ce(s)});const a=document.getElementById("fault-confirmation-done-btn");a&&A.add(a,"click",()=>{S(),P()}),t&&e&&A.add(t,"click",s=>{s.target===t&&(S(),P())}),t&&A.add(document,"keydown",(s=>{s.key==="Escape"&&t.classList.contains("show")&&!Ut()&&(s.preventDefault(),P())}))}function me(){let t=!1,e=null,n=null;const a=()=>{e&&(e(),e=null),n&&(n(),n=null)};A.add(window,"fault-edit-mic-click",()=>{const i=u.getState().currentLang,o=document.getElementById("fault-edit-mic-btn"),c=document.getElementById("fault-edit-notes"),r=document.getElementById("fault-edit-notes-char-count");if(!h.isSupported()){y(f("voiceNoteUnsupported",i),"warning");return}if(t){h.stop(),a(),t=!1,o==null||o.classList.remove("recording"),o==null||o.setAttribute("aria-pressed","false"),k.resume();return}k.pause(),e=h.onStatusChange(l=>{l==="error"&&(y(f("voiceNoteError",i),"warning"),a(),t=!1,o==null||o.classList.remove("recording"),o==null||o.setAttribute("aria-pressed","false"),k.resume())}),n=h.onTranscript((l,g)=>{if(g&&c){const m=c.value,v=m?`${m} ${l}`:l;if(c.value=v.slice(0,500),r){const p=c.value.length;r.textContent=`${p}/500`,r.classList.toggle("near-limit",p>450)}}}),h.start()?(t=!0,o==null||o.classList.add("recording"),o==null||o.setAttribute("aria-pressed","true"),S()):k.resume()});const s=document.getElementById("fault-edit-modal");s&&(dt=new MutationObserver(i=>{for(const o of i)if(o.type==="attributes"&&o.attributeName==="class"&&!(s.classList.contains("show")||s.style.display!=="none")&&t){h.stop(),a(),t=!1;const r=document.getElementById("fault-edit-mic-btn");r==null||r.classList.remove("recording"),r==null||r.setAttribute("aria-pressed","false"),k.resume()}}),dt.observe(s,{attributes:!0}))}function be(){ge(),fe(),me()}const M=new G;function It(){const t=b("timer-tab"),e=b("gate-judge-tab"),n=document.querySelector(".tab-bar"),s=u.getState().deviceRole==="gateJudge";t&&(t.style.display=s?"none":""),e&&(e.style.display=s?"":"none"),n&&n.classList.toggle("gate-judge-mode",s)}function ye(){M.removeAll(),window.dispatchEvent(new CustomEvent("update-role-toggle")),It();const t=b("gate-change-btn");t&&M.add(t,"click",()=>{S(),Lt()});const e=b("gate-judge-run-selector");e&&M.add(e,"click",(a=>{const i=a.target.closest(".run-btn");if(!i)return;const o=i.getAttribute("data-run"),c=o?parseInt(o,10):1;u.setSelectedRun(c),S(),e.querySelectorAll(".run-btn").forEach(r=>{r.classList.toggle("active",r===i),r.setAttribute("aria-checked",r===i?"true":"false")}),Z(),K()}));const n=b("ready-toggle-btn");n&&(M.add(n,"click",()=>{const a=u.getState(),s=!a.isJudgeReady;u.setJudgeReady(s),j(),Q();const i=a.currentLang;y(s?f("judgeReady",i):f("judgeNotReady",i),"success")}),Q()),Bt(),vt(),ne(),K(),be(),rt()}function Lt(){const t=u.getState(),e=b("gate-start-input"),n=b("gate-end-input");e&&n&&(t.gateAssignment?(e.value=String(t.gateAssignment[0]),n.value=String(t.gateAssignment[1])):(e.value="1",n.value="10"));const a=b("gate-color-selector");a&&a.querySelectorAll(".gate-color-btn").forEach(s=>{const o=s.getAttribute("data-color")===t.firstGateColor;s.classList.toggle("active",o),s.setAttribute("aria-checked",String(o))}),O(b("gate-assignment-modal"))}function Bt(){const t=b("gate-color-selector");t&&M.add(t,"click",(n=>{const a=n.target.closest(".gate-color-btn");a&&(t.querySelectorAll(".gate-color-btn").forEach(s=>{s.classList.remove("active"),s.setAttribute("aria-checked","false")}),a.classList.add("active"),a.setAttribute("aria-checked","true"),S())}));const e=b("save-gate-assignment-btn");e&&M.add(e,"click",()=>{const n=b("gate-start-input"),a=b("gate-end-input");if(!n||!a)return;const s=parseInt(n.value,10)||1,i=parseInt(a.value,10)||10,o=Math.min(s,i),c=Math.max(s,i),r=document.querySelector("#gate-color-selector .gate-color-btn.active"),d=(r==null?void 0:r.getAttribute("data-color"))||"red";u.setGateAssignment([o,c]),u.setFirstGateColor(d),rt(),R(b("gate-assignment-modal")),j();const l=u.getState().currentLang;y(f("saved",l),"success")})}function rt(){const t=b("gate-range-display"),e=b("gate-color-indicator"),n=b("gate-color-text");if(!t)return;const a=u.getState();if(a.gateAssignment?t.textContent=`${a.gateAssignment[0]}–${a.gateAssignment[1]}`:t.textContent="--",e&&n){const s=a.currentLang,i=a.firstGateColor==="red"?"colorRed":"colorBlue";n.textContent=`${f("firstGateLabel",s)}: ${f(i,s)}`,e.classList.toggle("red",a.firstGateColor==="red"),e.classList.toggle("blue",a.firstGateColor==="blue")}At()}function At(){const t=b("other-judges-coverage"),e=b("other-judges-list");if(!t||!e)return;if(!u.getState().settings.sync){t.style.display="none";return}const a=at.getOtherGateAssignments();if(a.length===0){t.style.display="none";return}t.style.display="flex";const s=u.getState().currentLang;e.innerHTML=a.map(i=>`
    <div class="coverage-badge ${i.isReady?"ready":""}" title="${w(i.deviceName)}${i.isReady?f("readySuffix",s):""}">
      ${i.isReady?`<span class="ready-check" aria-hidden="true">${Nt(14)}</span>`:""}
      <span class="device-name">${I(i.deviceName.slice(0,15))}</span>
      <span class="gate-range">${i.gateStart}–${i.gateEnd}</span>
    </div>
  `).join(""),kt(a),$t()}function Q(){const t=b("ready-toggle-btn");if(!t)return;const e=u.getState();t.classList.toggle("ready",e.isJudgeReady),t.setAttribute("aria-pressed",String(e.isJudgeReady))}function kt(t){const e=b("judges-ready-indicator"),n=b("judges-ready-count");if(!e||!n)return;const a=u.getState();if(!a.settings.sync){e.style.display="none";return}const s=t||at.getOtherGateAssignments();let i=s.length,o=s.filter(c=>c.isReady).length;if(a.deviceRole==="gateJudge"&&a.gateAssignment&&(i++,a.isJudgeReady&&o++),i===0){e.style.display="none";return}e.style.display="flex",n.textContent=`${o}/${i}`,e.classList.toggle("all-ready",o===i&&i>0)}function $t(){const t=b("gps-indicator"),e=b("judge-ready-indicator");if(!e)return;const n=u.getState(),a=n.deviceRole==="gateJudge";if(t&&(t.style.display=!a&&n.settings.gps?"flex":"none"),!a){e.style.display="none";return}e.style.display="flex";const s=at.getOtherGateAssignments();let i=s.length,o=s.filter(c=>c.isReady).length;n.gateAssignment&&(i++,n.isJudgeReady&&o++),e.classList.remove("none-ready","some-ready","all-ready"),o===0||i===0?e.classList.add("none-ready"):o===i?e.classList.add("all-ready"):e.classList.add("some-ready")}function wt(){const t=u.getState(),e=b("gate-judge-run-selector");e&&e.querySelectorAll(".run-btn").forEach(n=>{const a=n.getAttribute("data-run")===String(t.selectedRun);n.classList.toggle("active",a),n.setAttribute("aria-checked",String(a))})}function pe(t){var e,n,a,s;switch(lt.debug("[GateJudgeView] Voice intent:",t.action,t.params),t.action){case"record_fault":(e=t.params)!=null&&e.bib&&((n=t.params)==null?void 0:n.gate)!==void 0&&((a=t.params)!=null&&a.faultType)&&Et(t.params.bib,t.params.gate,t.params.faultType);break;case"toggle_ready":{const i=u.getState(),o=!i.isJudgeReady;u.setJudgeReady(o),j(),Q();const c=i.currentLang;y(o?f("judgeReady",c):f("judgeNotReady",c),"success");break}case"set_run":(s=t.params)!=null&&s.run&&(u.setSelectedRun(t.params.run),wt(),Z(),K(),S());break;default:lt.debug("[GateJudgeView] Unhandled voice intent:",t.action)}}function ve(){M.removeAll()}const Ae=Object.freeze(Object.defineProperty({__proto__:null,cleanupGateJudgeView:ve,handleGateJudgeVoiceIntent:pe,initGateAssignmentModal:Bt,initGateJudgeView:ye,openGateAssignmentModal:Lt,updateGateJudgeRunSelection:wt,updateGateJudgeTabVisibility:It,updateGateRangeDisplay:rt,updateJudgeReadyStatus:$t,updateJudgesReadyIndicator:kt,updateOtherJudgesCoverage:At,updateReadyButtonState:Q},Symbol.toStringTag,{value:"Module"}));export{jt as _,Le as a,Be as b,R as c,yt as d,Ee as e,he as f,Ot as g,$t as h,Ie as i,Z as j,rt as k,wt as l,pe as m,Qt as n,O as o,Zt as p,Ut as q,K as r,ft as s,Ae as t,It as u};
