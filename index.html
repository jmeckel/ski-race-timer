<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#0a1628">
  <meta name="description" content="Precision race timing, GPS-synchronized">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="CHRONO">
  <link rel="manifest" href="/manifest.json">
  <!-- Favicons -->
  <link rel="icon" href="/favicon.ico" sizes="48x48">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="CHRONO ‚Äî Precision Race Timing">
  <meta property="og:description" content="Precision race timing, GPS-synchronized">
  <meta property="og:image" content="/og-image.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="CHRONO ‚Äî Precision Race Timing">
  <meta name="twitter:description" content="Precision race timing, GPS-synchronized">
  <meta name="twitter:image" content="/twitter-image.png">
  <title>CHRONO</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Skip Link -->
  <a href="#main" class="skip-link" data-i18n="skipToMain">Skip to main content</a>

  <div class="app" role="application" aria-label="CHRONO Race Timer">
    <!-- Header -->
    <header class="header glass-frosted-top glass-enable-target">
      <h1 class="header-title">
        <svg class="header-logo" width="28" height="28" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <circle cx="50" cy="54" r="38" stroke="#00d4ff" stroke-width="6" stroke-linecap="round" stroke-dasharray="200 40"/>
          <line x1="50" y1="54" x2="50" y2="28" stroke="#00d4ff" stroke-width="3.5" stroke-linecap="round"/>
          <line x1="50" y1="54" x2="68" y2="54" stroke="#00d4ff" stroke-width="3.5" stroke-linecap="round"/>
          <circle cx="50" cy="54" r="5" fill="#00d4ff"/>
          <line x1="42" y1="12" x2="58" y2="12" stroke="#00d4ff" stroke-width="2.5" stroke-linecap="round"/>
          <line x1="50" y1="12" x2="50" y2="18" stroke="#00d4ff" stroke-width="2.5" stroke-linecap="round"/>
        </svg>
        CHRONO
      </h1>
      <div class="header-status">
        <div class="sync-indicator" id="sync-indicator" style="display: none;">
          <span class="sync-dot" aria-label="Sync status"></span>
          <span class="sync-status-text" data-i18n="connecting">Connecting...</span>
          <span class="sync-device-count" id="sync-device-count" style="display: none;" aria-live="polite"></span>
        </div>
        <span class="judges-ready-indicator" id="judges-ready-indicator" style="display: none;" title="Judges ready" role="status" aria-label="Judges ready: 0 of 0">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" aria-hidden="true">
            <path d="M20 6L9 17l-5-5"/>
          </svg>
          <span class="judges-ready-count" id="judges-ready-count">0/0</span>
        </span>
        <div class="gps-indicator" id="gps-indicator" style="display: none;">
          <span class="gps-dot" aria-label="GPS status"></span>
          <span class="gps-status-text" data-i18n="gpsInactive">GPS Inactive</span>
        </div>
        <div class="judge-ready-indicator" id="judge-ready-indicator" style="display: none;">
          <span class="judge-ready-dot"></span>
          <span class="judge-ready-text" data-i18n="signalReady">Ready</span>
        </div>
        <div class="camera-indicator" id="camera-indicator" style="display: none;">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
            <circle cx="12" cy="13" r="4"/>
          </svg>
        </div>
        <div class="voice-indicator" id="voice-indicator" style="display: none;">
          <span class="voice-dot"></span>
          <span class="voice-status-text" id="voice-status-text"></span>
        </div>
        <span class="entry-count-badge" id="entry-count-badge" style="display: none;" aria-live="polite">0</span>
      </div>
    </header>

    <!-- Offline Banner -->
    <div class="offline-banner hidden" id="offline-banner" role="alert" aria-live="polite">
      <span id="offline-banner-text" data-i18n="offlineBanner">You are offline. Times will be saved locally.</span>
      <button class="offline-banner-dismiss" id="offline-banner-dismiss" aria-label="Dismiss" data-i18n-aria-label="dismiss">&times;</button>
    </div>

    <!-- Main Content -->
    <main id="main">
        <!-- Timer View (Radial Dial Mode) -->
        <div class="view timer-view radial-mode active">
          <!-- Top Row: Bib + Status -->
          <div class="radial-top-row">
            <!-- Top Left: Bib -->
            <div class="radial-bib-corner">
              <div class="radial-bib-label" data-i18n="bib">Bib</div>
              <div class="radial-bib-value" id="radial-bib-value">---</div>
            </div>

            <!-- Top Right: Clear Button -->
            <div class="radial-clear-corner">
              <button class="radial-clear-btn" id="radial-clear-btn" aria-label="Clear bib number" data-i18n-aria-label="clearBibLabel">C</button>
            </div>

            <!-- Status (hidden, using header instead) -->
            <div class="radial-status-corner">
              <div class="radial-status-row" id="radial-gps-status">
                <span class="radial-status-dot inactive"></span>
                <span>GPS</span>
              </div>
              <div class="radial-status-row" id="radial-sync-status" style="display: none;">
                <span class="radial-status-dot"></span>
                <span class="radial-sync-text" data-i18n="synced">Synced</span>
              </div>
            </div>
          </div>

          <!-- Center: Dial -->
          <div class="radial-center-area">
            <div class="dial-container" id="dial-container">
              <!-- Dial Ring -->
              <div class="dial-ring" id="dial-ring">
                <div class="dial-ticks" id="dial-ticks"></div>
              </div>

              <!-- Rotating numbers -->
              <div class="dial-numbers" id="dial-numbers"></div>

              <!-- Gesture area -->
              <div class="dial-gesture-area" id="dial-gesture"></div>

              <!-- Center: Time Display only -->
              <div class="dial-center">
                <div class="radial-time-display" id="radial-time-display">
                  <div class="radial-time-hm" id="radial-time-hm">--:--</div>
                  <div class="radial-time-seconds" id="radial-time-seconds">--</div>
                  <div class="radial-time-subseconds" id="radial-time-subseconds">---</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Controls Row: Timing Point + Run Selector -->
          <div class="radial-controls-row">
            <div class="radial-timing-point" id="radial-timing-point" role="radiogroup" aria-label="Timing point">
              <button class="radial-point-btn start" data-point="S" data-advanced data-i18n="start" role="radio" aria-checked="false">Start</button>
              <button class="radial-point-btn finish active" data-point="F" data-i18n="finish" role="radio" aria-checked="true">Finish</button>
            </div>
            <div class="radial-run-selector" id="radial-run-selector" role="radiogroup" aria-label="Run selector">
              <button class="radial-run-btn active" data-run="1" role="radio" aria-checked="true" aria-label="Run 1" data-i18n="runLabel1">Run 1</button>
              <button class="radial-run-btn" data-run="2" role="radio" aria-checked="false" aria-label="Run 2" data-i18n="runLabel2">Run 2</button>
            </div>
          </div>

          <!-- Bottom Row: Stats + Record Button -->
          <div class="radial-bottom-row">
            <!-- Stats (hidden in portrait, shown in landscape) -->
            <div class="radial-stats-corner">
              <div class="radial-stats-label" data-i18n="lastRecordedShort">Last:</div>
              <div class="radial-stats-last">
                <span class="radial-stats-bib" id="radial-last-bib">---</span>
                <span class="radial-stats-point finish" id="radial-last-point" data-i18n="finishShort">F</span>
              </div>
              <div class="radial-stats-time" id="radial-last-time">--:--:--.---</div>
              <div class="radial-stats-count" id="radial-stats-count" aria-live="polite">---</div>
            </div>

            <!-- Record Button -->
            <div class="radial-time-btn-corner">
              <button class="radial-time-btn" id="radial-time-btn" aria-label="Record timestamp">
                <span data-i18n="time">Record time</span>
              </button>
            </div>
          </div>

          <!-- Confirmation Overlay -->
          <div class="radial-confirmation-overlay" id="radial-confirmation-overlay" aria-hidden="true">
            <div class="radial-confirmation-check" aria-hidden="true">‚úì</div>
            <div class="radial-confirmation-bib" id="radial-confirm-bib">---</div>
            <div class="radial-confirmation-time" id="radial-confirm-time">--:--:--.---</div>
            <div class="radial-confirmation-point finish" id="radial-confirm-point">Finish</div>
          </div>
        </div>

      <!-- Results View -->
      <div class="view results-view">
        <div class="results-header">
          <!-- Chief Judge Toggle -->
          <div class="chief-judge-toggle-row" id="chief-judge-toggle-row">
            <button class="chief-judge-toggle-btn" id="chief-judge-toggle-btn" aria-pressed="false">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                <path d="M2 17l10 5 10-5"/>
                <path d="M2 12l10 5 10-5"/>
              </svg>
              <span data-i18n="chiefJudge">Chief Judge</span>
            </button>
          </div>
          <!-- Info Bar -->
          <div class="results-info-bar" aria-live="polite">
            <div class="results-info-text">
              <span class="stat-value" id="stat-total">0</span>
              <span class="stat-label" data-i18n="entriesRecorded">entries recorded</span>
            </div>
            <div class="results-info-actions">
              <button class="results-info-btn" id="toggle-filters-btn" aria-label="Filter" aria-expanded="false">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>
              </button>
              <span class="results-info-spacer"></span>
              <button class="results-info-btn" id="undo-btn" aria-label="Undo" data-i18n-aria-label="undo" disabled>
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M3 10h10a5 5 0 015 5v2M3 10l4-4M3 10l4 4"/></svg>
              </button>
              <button class="results-info-btn danger" id="clear-all-btn" aria-label="Delete All" data-i18n-aria-label="clearAll">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
              </button>
              <span class="results-info-spacer"></span>
              <button class="results-info-btn" id="quick-export-btn" aria-label="Export" data-i18n-aria-label="export">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
              </button>
            </div>
            <!-- Hidden stat elements for JS updates -->
            <span id="stat-racers" hidden>0</span>
            <span id="stat-finished" hidden>0</span>
            <span id="stat-duplicates" hidden>0</span>
            <span id="stat-duplicates-item" hidden></span>
          </div>

          <!-- Search & Filter (toggled by filter icon) -->
          <div class="search-filter-bar" data-advanced>
            <input type="search" class="search-input" id="search-input" data-i18n-placeholder="search" aria-label="Search results" data-i18n-aria-label="searchResults">
            <select class="filter-select" id="filter-point" aria-label="Filter by point">
              <option value="all" data-i18n="all">All</option>
              <option value="S">Start</option>
              <option value="F">Finish</option>
            </select>
            <select class="filter-select" id="filter-status" aria-label="Filter by status">
              <option value="all" data-i18n="all">All</option>
              <option value="ok">OK</option>
              <option value="dns">DNS</option>
              <option value="dnf">DNF</option>
              <option value="dsq">DSQ</option>
            </select>
          </div>
        </div>

        <!-- Results List (Virtual Scrolling) -->
        <div class="results-list" id="results-list" role="list" aria-label="Results"></div>

        <!-- Chief Judge Panel (shown when chief mode is active) -->
        <div class="chief-judge-panel" id="chief-judge-panel">
          <!-- Gate Judges Overview -->
          <div class="judges-overview" id="judges-overview">
            <div class="judges-overview-header">
              <span class="judges-overview-title" data-i18n="gateJudges">Gate Judges</span>
              <span class="judges-overview-count" id="judges-overview-count">0</span>
            </div>
            <div class="judges-overview-list" id="judges-overview-list" aria-live="polite">
              <!-- Populated dynamically -->
              <div class="judges-overview-empty" id="judges-overview-empty" data-i18n="noJudgesConnected">
                No gate judges connected
              </div>
            </div>
          </div>

          <!-- Penalty Configuration -->
          <div class="penalty-config-row" id="penalty-config-row">
            <div class="penalty-mode-toggle" id="penalty-mode-toggle" role="group" aria-label="Penalty mode">
              <button class="penalty-mode-btn active" data-mode="penalty" aria-pressed="true">
                <span data-i18n="penaltyMode">+Time</span>
              </button>
              <button class="penalty-mode-btn" data-mode="dsq" aria-pressed="false">
                <span>DSQ</span>
              </button>
            </div>
            <div class="penalty-seconds-selector" id="penalty-seconds-selector">
              <button class="penalty-adj-btn" data-adj="-1" aria-label="Decrease penalty seconds">‚àí</button>
              <span class="penalty-seconds-value" id="penalty-seconds-value" aria-live="polite">5</span>
              <span class="penalty-seconds-unit">s</span>
              <button class="penalty-adj-btn" data-adj="+1" aria-label="Increase penalty seconds">+</button>
            </div>
          </div>
          <!-- Pending Deletions Section (Chief Judge approval needed) -->
          <div class="pending-deletions-section" id="pending-deletions-section" style="display: none;">
            <div class="pending-deletions-header">
              <span class="pending-deletions-title">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                  <path d="M12 9v4M12 17h.01"/>
                  <circle cx="12" cy="12" r="10"/>
                </svg>
                <span data-i18n="pendingDeletions">Pending Deletions</span>
              </span>
              <span class="pending-deletions-count" id="pending-deletions-count">0</span>
            </div>
            <div class="pending-deletions-list" id="pending-deletions-list">
              <!-- Populated dynamically -->
            </div>
          </div>

          <div class="fault-summary-header">
            <span class="fault-summary-title" data-i18n="faultSummary">Fault Summary</span>
            <span class="fault-summary-count" id="fault-summary-count">0</span>
          </div>
          <div class="fault-summary-list" id="fault-summary-list">
            <!-- Fault cards will be populated dynamically -->
            <div class="chief-empty-state empty-state" id="chief-empty-state">
              <span class="empty-icon" aria-hidden="true">üèîÔ∏è</span>
              <span data-i18n="noFaultsRecorded">No faults recorded</span>
              <span class="empty-subtitle" data-i18n="cleanRunHint">Clean run so far</span>
            </div>
          </div>

          <!-- Chief Judge Export Actions -->
          <div class="chief-export-actions" id="chief-export-actions">
            <button class="chief-export-btn" id="export-csv-btn">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                <polyline points="14 2 14 8 20 8"/>
                <line x1="16" y1="13" x2="8" y2="13"/>
                <line x1="16" y1="17" x2="8" y2="17"/>
              </svg>
              <span data-i18n="exportCSV">CSV</span>
            </button>
            <button class="chief-export-btn" id="export-summary-btn">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                <polyline points="14 2 14 8 20 8"/>
                <line x1="12" y1="18" x2="12" y2="12"/>
                <line x1="9" y1="15" x2="15" y2="15"/>
              </svg>
              <span data-i18n="summary">Summary</span>
            </button>
            <button class="chief-export-btn whatsapp" id="export-whatsapp-btn">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
              </svg>
              <span data-i18n="exportWhatsApp">WhatsApp</span>
            </button>
          </div>
        </div>

        <!-- Select Mode Bar -->
        <div class="select-mode-bar" id="select-mode-bar">
          <span><span id="selected-count">0</span> <span data-i18n="selected">selected</span></span>
          <button class="modal-btn danger" id="delete-selected-btn" data-i18n="deleteSelected">Delete Selected</button>
        </div>

        <!-- Results Actions -->
        <!-- Bottom action bar removed ‚Äî undo, delete-all, export are now in the info bar -->
      </div>

      <!-- Gate Judge View -->
      <div class="view gate-judge-view">
        <!-- Gate Assignment Header -->
        <div class="gate-judge-header">
          <div class="gate-assignment-display">
            <span class="gate-label" data-i18n="gates">Gates</span>
            <span class="gate-range" id="gate-range-display">--</span>
            <span class="gate-color-indicator" id="gate-color-indicator" aria-live="polite">
              <span class="gate-color-dot" aria-hidden="true"></span>
              <span class="gate-color-text" id="gate-color-text"></span>
            </span>
            <button class="gate-change-btn" id="gate-change-btn" data-i18n="changeGates">Change</button>
          </div>
          <div class="run-selector gate-judge-run-selector" id="gate-judge-run-selector" role="radiogroup" aria-label="Run">
            <button class="run-btn glass-surface-3 active" data-run="1" role="radio" aria-checked="true">
              <span data-i18n="run1">L1</span>
            </button>
            <button class="run-btn glass-surface-3" data-run="2" role="radio" aria-checked="false">
              <span data-i18n="run2">L2</span>
            </button>
          </div>
        </div>

        <!-- Other Judges Coverage (shows when syncing) -->
        <div class="other-judges-coverage" id="other-judges-coverage" style="display: none;">
          <span class="coverage-label" data-i18n="otherJudges">Other judges:</span>
          <div class="coverage-list" id="other-judges-list"></div>
        </div>

        <!-- Gate-First Quick Entry Layout -->
        <div class="gate-first-layout">
          <!-- Gate Grid (PRIMARY UI - large prominent buttons) -->
          <div class="gate-grid-section">
            <div class="gate-grid" id="inline-gate-selector" role="radiogroup" aria-label="Select gate">
              <!-- Populated dynamically based on gate assignment -->
            </div>
          </div>

          <!-- Fault Detail Panel (appears after selecting a gate) -->
          <div class="fault-detail-panel" id="fault-detail-panel" aria-live="polite" style="display: none;">
            <div class="fault-detail-header">
              <span class="fault-detail-gate-label" id="fault-detail-gate-label" aria-live="polite"></span>
              <button class="fault-detail-close" id="fault-detail-close" aria-label="Close" data-i18n-aria-label="close">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                  <path d="M18 6L6 18"/><path d="M6 6l12 12"/>
                </svg>
              </button>
            </div>

            <!-- Fault Type Selection -->
            <div class="inline-fault-types" id="inline-fault-types">
              <button class="inline-fault-type-btn" data-fault="MG" aria-pressed="false">
                <span class="fault-type-short" data-i18n="faultMGShort">MG</span>
                <span class="fault-type-long" data-i18n="faultMG">Missed Gate</span>
              </button>
              <button class="inline-fault-type-btn" data-fault="STR" aria-pressed="false">
                <span class="fault-type-short" data-i18n="faultSTRShort">STR</span>
                <span class="fault-type-long" data-i18n="faultSTR">Straddling</span>
              </button>
              <button class="inline-fault-type-btn" data-fault="BR" aria-pressed="false">
                <span class="fault-type-short" data-i18n="faultBRShort">BR</span>
                <span class="fault-type-long" data-i18n="faultBR">Binding Release</span>
              </button>
            </div>

            <!-- Bib Entry (auto-filled from last starter) -->
            <div class="fault-detail-bib-row">
              <label class="inline-entry-label" for="inline-bib-input" data-i18n="bib">Bib</label>
              <input type="text" class="text-input inline-bib-input" id="inline-bib-input" maxlength="3" inputmode="numeric" pattern="[0-9]*" placeholder="---" data-i18n-aria-label="bib">
            </div>
          </div>

          <!-- Recorded Faults (compact scrollable list) -->
          <div class="gate-judge-faults-section">
            <div class="section-header">
              <span class="section-title" data-i18n="recordedFaults">Recorded Faults</span>
              <span class="fault-count-badge" id="inline-fault-count">0</span>
            </div>
            <div class="gate-judge-faults-list" id="gate-judge-faults-list" aria-live="polite">
              <div class="empty-state" id="no-faults-recorded-inline">
                <span class="empty-icon" aria-hidden="true">üö©</span>
                <span data-i18n="noFaultsRecorded">No faults recorded</span>
                <span class="empty-subtitle" data-i18n="cleanRunHint">Clean run so far</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Footer: Save Fault + Ready (thumb-reachable at bottom) -->
        <div class="gate-judge-footer">
          <button class="inline-save-fault-btn" id="inline-save-fault-btn" disabled data-i18n="saveFault">Save Fault</button>
          <button class="ready-toggle-btn" id="ready-toggle-btn" aria-pressed="false">
            <svg class="ready-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <path d="M20 6L9 17l-5-5"/>
            </svg>
            <span data-i18n="signalReady">Ready</span>
          </button>
        </div>
      </div>

      <!-- Settings View -->
      <div class="view settings-view">
        <!-- ===== Race Setup Group ===== -->
        <div class="settings-group">
          <h3 class="settings-group-title" data-i18n="settingsRaceSetup">Race Setup</h3>
          <!-- Device Role -->
          <div class="settings-section role-section">
            <div class="settings-section-title" data-i18n="deviceRole">Device Role</div>
            <div class="role-cards-settings" id="role-toggle" role="radiogroup" aria-label="Device role">
              <button class="role-card-setting active" data-role="timer" role="radio" aria-checked="true">
                <div class="role-card-icon" aria-hidden="true"><svg aria-hidden="true" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="13" r="8"/><path d="M12 9v4l2 2"/><path d="M12 5V3"/><path d="M10 3h4"/></svg></div>
                <div class="role-card-content">
                  <span class="role-card-title" data-i18n="roleTimer">Timer</span>
                  <span class="role-card-desc" data-i18n="roleTimerDesc">Record start and finish times</span>
                </div>
              </button>
              <button class="role-card-setting" data-role="gateJudge" role="radio" aria-checked="false">
                <div class="role-card-icon" aria-hidden="true"><svg aria-hidden="true" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/></svg></div>
                <div class="role-card-content">
                  <span class="role-card-title" data-i18n="roleGateJudge">Gate Judge</span>
                  <span class="role-card-desc" data-i18n="roleJudgeDesc">Record gate faults (Torrichter)</span>
                </div>
              </button>
            </div>
          </div>
          <!-- Race ID -->
          <div class="settings-section race-setup-section">
            <div class="setting-row" id="race-id-input-row-container">
              <div class="setting-label">
                <span class="setting-title" data-i18n="raceId">Race ID</span>
                <span class="race-exists-indicator" id="race-exists-indicator" style="display: none;">
                  <svg class="race-exists-check" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true">
                    <polyline points="20 6 9 17 4 12"/>
                  </svg>
                  <span class="race-exists-text" id="race-exists-text"></span>
                </span>
              </div>
              <div class="race-id-input-row">
                <input type="text" class="text-input" id="race-id-input" data-i18n-placeholder="raceIdPlaceholder" style="max-width: 120px;" aria-label="Race ID">
                <button class="recent-races-btn" id="settings-recent-races-btn" type="button" aria-label="Recent races" aria-expanded="false" aria-haspopup="listbox">
                  <svg aria-hidden="true" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <polyline points="12 6 12 12 16 14"/>
                  </svg>
                </button>
                <div class="recent-races-dropdown" id="settings-recent-races-dropdown" style="display:none"></div>
              </div>
            </div>
            <!-- Device Name -->
            <div class="setting-row">
              <div class="setting-label">
                <span class="setting-title" data-i18n="deviceName">Device Name</span>
              </div>
              <input type="text" class="text-input" id="device-name-input" data-i18n-placeholder="deviceNamePlaceholder" style="max-width: 150px;" aria-label="Device name">
            </div>
          </div>
        </div>

        <!-- ===== Timing Group ===== -->
        <div class="settings-group">
          <h3 class="settings-group-title" data-i18n="settingsTimingGroup">Timing</h3>
          <!-- GPS -->
          <div class="setting-row">
            <div class="setting-label">
              <span class="setting-title" data-i18n="gps">GPS Sync</span>
              <span class="setting-description" data-i18n="gpsDesc">Use GPS for accurate timestamps</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="gps-toggle">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <!-- Auto-increment -->
          <div class="setting-row">
            <div class="setting-label">
              <span class="setting-title" data-i18n="autoIncrement">Auto-increment Bib</span>
              <span class="setting-description" data-i18n="autoIncrementDesc">Increase bib number after recording</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="auto-toggle" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
          <!-- Photo Capture -->
          <div class="setting-row">
            <div class="setting-label">
              <span class="setting-title" data-i18n="photoCapture">Photo Capture</span>
              <span class="setting-description" data-i18n="photoCaptureDesc">Capture photo on timestamp</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="photo-toggle">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <!-- ===== Sync Group ===== -->
        <div class="settings-group">
          <h3 class="settings-group-title" data-i18n="settingsSyncGroup">Sync</h3>
          <div class="setting-row">
            <div class="setting-label">
              <span class="setting-title" data-i18n="cloudSync">Cloud Sync</span>
              <span class="setting-description" data-i18n="cloudSyncDesc">Sync with other devices</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="sync-toggle">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="setting-row" id="sync-photos-row">
            <div class="setting-label">
              <span class="setting-title" data-i18n="syncPhotos">Sync Photos</span>
              <span class="setting-description" data-i18n="syncPhotosDesc">Share photos across devices via cloud</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="sync-photos-toggle" disabled>
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <!-- ===== Feedback Group ===== -->
        <div class="settings-group">
          <h3 class="settings-group-title" data-i18n="settingsFeedbackGroup">Feedback</h3>
          <!-- Haptic Feedback -->
          <div class="setting-row">
            <div class="setting-label">
              <span class="setting-title" data-i18n="hapticFeedback">Haptic Feedback</span>
              <span class="setting-description" data-i18n="hapticFeedbackDesc">Vibration on actions</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="haptic-toggle" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
          <!-- Sound Feedback -->
          <div class="setting-row">
            <div class="setting-label">
              <span class="setting-title" data-i18n="soundFeedback">Sound Feedback</span>
              <span class="setting-description" data-i18n="soundFeedbackDesc">Audio confirmation</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="sound-toggle">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <!-- Ambient Mode -->
          <div class="setting-row">
            <div class="setting-label">
              <span class="setting-title" data-i18n="ambientMode">Ambient Mode</span>
              <span class="setting-description" data-i18n="ambientModeDesc">Auto-dim after 30s inactivity</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="ambient-mode-toggle" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <!-- ===== Display Group ===== -->
        <div class="settings-group">
          <h3 class="settings-group-title" data-i18n="settingsDisplayGroup">Display</h3>
          <!-- Language -->
          <div class="setting-row">
            <div class="setting-label">
              <span class="setting-title" data-i18n="language">Language</span>
            </div>
            <div class="lang-toggle" id="lang-toggle" role="radiogroup" aria-label="Language selection">
              <span class="lang-option active" data-lang="de" role="radio" tabindex="0" aria-checked="true" aria-label="Deutsch">DE</span>
              <span class="lang-option" data-lang="fr" role="radio" tabindex="0" aria-checked="false" aria-label="Fran√ßais">FR</span>
              <span class="lang-option" data-lang="en" role="radio" tabindex="0" aria-checked="false" aria-label="English">EN</span>
            </div>
          </div>
          <!-- Mode Toggle (hidden - normal mode is now the default) -->
          <div class="setting-row" style="display:none">
            <div class="setting-label">
              <span class="setting-title" data-i18n="simpleMode">Simple Mode</span>
              <span class="setting-description" data-i18n="simpleModeDesc">Simplified interface for basic timing</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="simple-mode-toggle">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <!-- Voice Mode -->
          <div class="setting-row" id="voice-mode-row">
            <div class="setting-label">
              <span class="setting-title" data-i18n="voiceMode">Voice Mode</span>
              <span class="setting-description" data-i18n="voiceModeDesc">Hands-free voice commands (requires internet)</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="voice-mode-toggle">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <!-- Tutorial -->
          <div class="setting-row">
            <div class="setting-label">
              <span class="setting-title" data-i18n="showTutorial">Show Tutorial</span>
              <span class="setting-description" data-i18n="showTutorialDesc">Run the setup wizard again</span>
            </div>
            <button class="action-btn admin-action-btn" id="show-tutorial-btn">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 16v-4M12 8h.01"/>
              </svg>
              <span data-i18n="show">Show</span>
            </button>
          </div>
          <!-- Keyboard Shortcuts -->
          <div class="setting-row">
            <div class="setting-label">
              <span class="setting-title" data-i18n="keyboardShortcuts">Keyboard Shortcuts</span>
              <span class="setting-description" data-i18n="keyboardShortcutsDesc">Show all keyboard shortcuts</span>
            </div>
            <button class="action-btn admin-action-btn" id="show-shortcuts-btn">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <rect x="2" y="4" width="20" height="16" rx="2"/>
                <path d="M6 8h.01M10 8h.01M14 8h.01M18 8h.01M8 12h.01M12 12h.01M16 12h.01M8 16h8"/>
              </svg>
              <span data-i18n="show">Show</span>
            </button>
          </div>
        </div>

        <!-- Admin Section (hidden in simple mode) -->
        <div class="settings-section" id="admin-section">
          <div class="settings-section-title" data-i18n="admin">Admin</div>
          <div class="setting-row">
            <div class="setting-label">
              <span class="setting-title" data-i18n="adminPin">Admin PIN</span>
              <span class="setting-description" id="admin-pin-status" data-i18n="pinNotSet">Not set</span>
            </div>
            <button class="action-btn admin-action-btn" id="change-pin-btn">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                <path d="M7 11V7a5 5 0 0110 0v4"/>
              </svg>
              <span id="change-pin-btn-text" data-i18n="setPin">Set PIN</span>
            </button>
          </div>
          <div class="setting-row">
            <div class="setting-label">
              <span class="setting-title" data-i18n="manageRaces">Manage Races</span>
              <span class="setting-description" data-i18n="manageRacesDesc">View and delete synced races</span>
            </div>
            <button class="action-btn admin-action-btn" id="manage-races-btn">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <path d="M12 20h9"/>
                <path d="M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z"/>
              </svg>
              <span data-i18n="manage">Manage</span>
            </button>
          </div>
        </div>

        <!-- Version (at the very bottom) -->
        <div class="settings-section settings-version-section">
          <button class="version-info-btn" id="version-info-btn" title="Tap to copy debug info" aria-label="Copy debug info" data-i18n-aria-label="copyDebugInfo">
            <span data-i18n="version">Version</span>&nbsp;<span id="app-version"></span>
            <span id="app-version-name" class="version-name"></span>
            <div id="app-version-description" class="version-description"></div>
          </button>
        </div>
      </div>
    </main>

    <!-- Tab Bar -->
    <nav class="tab-bar glass-frosted glass-enable-target" role="tablist" aria-label="Main navigation">
      <button class="tab-btn active" data-view="timer" role="tab" aria-selected="true" id="timer-tab">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <circle cx="12" cy="12" r="10"/>
          <polyline points="12 6 12 12 16 14"/>
        </svg>
        <span data-i18n="timer">Timer</span>
      </button>
      <button class="tab-btn" data-view="results" role="tab" aria-selected="false">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 012-2h2a2 2 0 012 2M9 5h6"/>
        </svg>
        <span data-i18n="results">Results</span>
      </button>
      <button class="tab-btn" data-view="gateJudge" role="tab" aria-selected="false" id="gate-judge-tab" style="display: none;">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/>
          <line x1="4" y1="22" x2="4" y2="15"/>
        </svg>
        <span data-i18n="gateJudgeTab">Gate</span>
      </button>
      <button class="tab-btn" data-view="settings" role="tab" aria-selected="false">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <path d="M12 15a3 3 0 100-6 3 3 0 000 6z"/>
          <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/>
        </svg>
        <span data-i18n="settings">Settings</span>
      </button>
    </nav>
  </div>

  <!-- Confirmation Overlay (outside app, same level as modals) -->
  <div class="confirmation-overlay" id="confirmation-overlay" aria-hidden="true">
    <div class="confirmation-content">
      <div class="snowflake-burst" id="snowflake-burst"></div>
      <div class="confirmation-bib">---</div>
      <div class="confirmation-point">-</div>
      <div class="confirmation-run" data-advanced>-</div>
      <div class="confirmation-time">--:--:--.---</div>
      <div class="confirmation-duplicate" style="display: none;">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <path d="M12 9v4M12 17h.01"/>
          <circle cx="12" cy="12" r="10"/>
        </svg>
        <span data-i18n="duplicateWarning">Duplicate entry</span>
      </div>
      <div class="confirmation-zero-bib" style="display: none;">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <path d="M12 9v4M12 17h.01"/>
          <circle cx="12" cy="12" r="10"/>
        </svg>
        <span data-i18n="zeroBibWarning">Bib 000 - verify entry</span>
      </div>
    </div>
  </div>

  <!-- Edit Modal -->
  <div class="modal-overlay glass-enable-target" id="edit-modal" role="dialog" aria-modal="true" aria-labelledby="edit-modal-title">
    <div class="modal-content glass-surface-1">
      <div class="modal-header">
        <h2 class="modal-title" id="edit-modal-title" data-i18n="edit">Edit Entry</h2>
      </div>
      <div class="modal-body">
        <div style="margin-bottom: 16px;">
          <label for="edit-bib-input" style="display: block; margin-bottom: 8px; color: var(--text-secondary);" data-i18n="bib">Bib</label>
          <input type="text" class="text-input" id="edit-bib-input" maxlength="3" inputmode="numeric" pattern="[0-9]*">
        </div>
        <div>
          <label for="edit-status-select" style="display: block; margin-bottom: 8px; color: var(--text-secondary);" data-i18n="status">Status</label>
          <select class="filter-select" id="edit-status-select" style="width: 100%;">
            <option value="ok">OK</option>
            <option value="dns">DNS</option>
            <option value="dnf">DNF</option>
            <option value="dsq">DSQ</option>
          </select>
        </div>
        <div style="margin-top: 16px;" data-advanced>
          <label id="edit-run-label" style="display: block; margin-bottom: 8px; color: var(--text-secondary);" data-i18n="run">Run</label>
          <div class="edit-run-selector" id="edit-run-selector" role="radiogroup" aria-labelledby="edit-run-label">
            <button class="edit-run-btn active" data-run="1" type="button">1</button>
            <button class="edit-run-btn" data-run="2" type="button">2</button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn secondary" data-action="cancel" data-i18n="cancel">Cancel</button>
        <button class="modal-btn primary" id="save-edit-btn" data-i18n="save">Save</button>
      </div>
    </div>
  </div>

  <!-- Confirm Modal -->
  <div class="modal-overlay glass-enable-target" id="confirm-modal" role="dialog" aria-modal="true" aria-labelledby="confirm-modal-title">
    <div class="modal-content glass-surface-1">
      <div class="modal-header">
        <h2 class="modal-title" id="confirm-modal-title" data-i18n="confirmDelete">Delete Entry</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text" data-i18n="confirmDeleteText">Are you sure you want to delete this entry?</p>
      </div>
      <div class="modal-footer">
        <button class="modal-btn secondary" data-action="cancel" data-i18n="cancel">Cancel</button>
        <button class="modal-btn danger" id="confirm-delete-btn" data-i18n="delete">Delete</button>
      </div>
    </div>
  </div>

  <!-- Fault Delete Confirmation Modal -->
  <div class="modal-overlay glass-enable-target" id="fault-delete-modal" role="dialog" aria-modal="true" aria-labelledby="fault-delete-modal-title">
    <div class="modal-content glass-surface-1">
      <div class="modal-header">
        <h2 class="modal-title" id="fault-delete-modal-title" data-i18n="confirmDelete">Delete Fault</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text" data-i18n="confirmDeleteFault">Delete this fault?</p>
        <p class="delete-fault-info"></p>
      </div>
      <div class="modal-footer">
        <button class="modal-btn secondary" data-action="cancel" data-i18n="cancel">Cancel</button>
        <button class="modal-btn danger" id="confirm-fault-delete-btn" data-i18n="delete">Delete</button>
      </div>
    </div>
  </div>

  <!-- Race Change Modal -->
  <div class="modal-overlay glass-enable-target" id="race-change-modal" role="dialog" aria-modal="true" aria-labelledby="race-change-modal-title">
    <div class="modal-content glass-surface-1">
      <div class="modal-header">
        <h2 class="modal-title" id="race-change-modal-title" data-i18n="raceChangeTitle">Change Race</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text" id="race-change-text" data-i18n="raceChangeUnsyncedText">You have existing results. Keep them or delete before switching?</p>
      </div>
      <div class="modal-footer" style="flex-wrap: wrap; gap: 8px;">
        <button class="modal-btn secondary" data-action="cancel" data-i18n="cancel">Cancel</button>
        <button class="modal-btn primary" id="race-change-keep-btn" data-i18n="keepResults">Keep</button>
        <button class="modal-btn primary" id="race-change-export-btn" data-i18n="export">Export</button>
        <button class="modal-btn danger" id="race-change-delete-btn" data-i18n="delete">Delete</button>
      </div>
    </div>
  </div>

  <!-- Photo Viewer Modal -->
  <div class="modal-overlay glass-enable-target" id="photo-viewer-modal" role="dialog" aria-modal="true" aria-labelledby="photo-viewer-modal-title">
    <div class="modal-content glass-surface-1 photo-viewer-content">
      <div class="modal-header photo-viewer-header">
        <h2 class="modal-title" id="photo-viewer-modal-title" data-i18n="viewPhoto">View Photo</h2>
        <button class="photo-viewer-close" id="photo-viewer-close-btn" aria-label="Close" data-i18n-aria-label="close">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <div class="photo-viewer-image-container">
        <img id="photo-viewer-image" class="photo-viewer-image" src="" alt="Race photo">
      </div>
      <div class="photo-viewer-metadata">
        <span class="photo-viewer-bib" id="photo-viewer-bib">---</span>
        <span class="photo-viewer-point" id="photo-viewer-point">S</span>
        <span class="photo-viewer-time" id="photo-viewer-time">00:00:00.000</span>
      </div>
      <div class="modal-footer">
        <button class="modal-btn text-danger" id="photo-viewer-delete-btn" data-i18n="deletePhoto">Delete Photo</button>
        <button class="modal-btn primary" id="photo-viewer-close-footer-btn" data-i18n="close">Close</button>
      </div>
    </div>
  </div>

  <!-- Race Deleted Modal -->
  <div class="modal-overlay glass-enable-target" id="race-deleted-modal" role="alertdialog" aria-modal="true" aria-labelledby="race-deleted-modal-title">
    <div class="modal-content glass-surface-1">
      <div class="modal-header">
        <h2 class="modal-title" id="race-deleted-modal-title" data-i18n="raceDeleted">Race Deleted</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text" id="race-deleted-text" data-i18n="raceDeletedText">This race has been deleted by an administrator.</p>
      </div>
      <div class="modal-footer">
        <button class="modal-btn primary" id="race-deleted-ok-btn" data-i18n="ok">OK</button>
      </div>
    </div>
  </div>

  <!-- Photo Sync Warning Modal -->
  <div class="modal-overlay glass-enable-target" id="photo-sync-modal" role="dialog" aria-modal="true" aria-labelledby="photo-sync-modal-title">
    <div class="modal-content glass-surface-1">
      <div class="modal-header">
        <h2 class="modal-title" id="photo-sync-modal-title" data-i18n="syncPhotosWarning">Enable Photo Sync</h2>
      </div>
      <div class="modal-body">
        <p data-i18n="syncPhotosWarningText">Enabling photo sync will transfer the following data:</p>
        <div class="photo-sync-stats" id="photo-sync-stats">
          <div class="photo-sync-stat">
            <span class="photo-sync-label" data-i18n="photosToUpload">Photos to upload</span>
            <span class="photo-sync-value" id="photos-upload-count">0</span>
          </div>
          <div class="photo-sync-stat">
            <span class="photo-sync-label" data-i18n="photosToDownload">Photos to download</span>
            <span class="photo-sync-value" id="photos-download-count">0</span>
          </div>
          <div class="photo-sync-stat total">
            <span class="photo-sync-label" data-i18n="totalDataVolume">Total data volume</span>
            <span class="photo-sync-value" id="photos-total-size">0 KB</span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn secondary" id="photo-sync-cancel-btn" data-i18n="cancel">Cancel</button>
        <button class="modal-btn primary" id="photo-sync-confirm-btn" data-i18n="enableSync">Enable Sync</button>
      </div>
    </div>
  </div>

  <!-- Race Management Modal -->
  <div class="modal-overlay glass-enable-target" id="race-management-modal" role="dialog" aria-modal="true" aria-labelledby="race-management-modal-title">
    <div class="modal-content glass-surface-1 race-management-content">
      <div class="modal-header">
        <h2 class="modal-title" id="race-management-modal-title" data-i18n="manageRaces">Manage Races</h2>
      </div>
      <div class="modal-body">
        <div class="race-list" id="race-list" role="region" aria-label="Race list" aria-live="polite">
          <div class="race-list-loading snowflake-loading" id="race-list-loading" aria-busy="true">
            <div class="snowflake-spinner">
              <span class="flake">‚ùÑ</span>
              <span class="flake">‚ùÑ</span>
              <span class="flake">‚ùÑ</span>
            </div>
            <span class="loading-text" data-i18n="loading">Loading...</span>
          </div>
          <div class="race-list-empty empty-state" id="race-list-empty" style="display: none;">
            <span class="empty-icon" aria-hidden="true">‚õ∑Ô∏è</span>
            <span data-i18n="noRaces">No active races</span>
            <span class="empty-subtitle" data-i18n="noRacesHint">Create one in Settings</span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn secondary" data-action="cancel" data-i18n="close">Close</button>
        <button class="modal-btn secondary" id="refresh-races-btn" data-i18n="refresh">Refresh</button>
      </div>
    </div>
  </div>

  <!-- Admin PIN Modal (for verifying PIN to access race management) -->
  <div class="modal-overlay glass-enable-target" id="admin-pin-modal" role="dialog" aria-modal="true" aria-labelledby="admin-pin-modal-title">
    <div class="modal-content glass-surface-1">
      <div class="modal-header">
        <h2 class="modal-title" id="admin-pin-modal-title" data-i18n="enterAdminPin">Enter Admin PIN</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text" id="admin-pin-modal-text" data-i18n="enterPinText">Enter the admin PIN to access race management.</p>
        <input type="tel" inputmode="numeric" pattern="[0-9]*" class="text-input" id="admin-pin-verify-input" placeholder="0000" maxlength="4" style="margin-top: 12px; text-align: center; font-size: 1.5rem; letter-spacing: 0.3em; width: 120px;">
        <p class="admin-pin-error" id="admin-pin-error" style="display: none; color: var(--error); font-size: 0.875rem; margin-top: 8px;" data-i18n="incorrectPin">Incorrect PIN</p>
      </div>
      <div class="modal-footer">
        <button class="modal-btn secondary" data-action="cancel" data-i18n="cancel">Cancel</button>
        <button class="modal-btn primary" id="admin-pin-verify-btn" data-i18n="verify">Verify</button>
      </div>
    </div>
  </div>

  <!-- Set/Change PIN Modal -->
  <div class="modal-overlay glass-enable-target" id="change-pin-modal" role="dialog" aria-modal="true" aria-labelledby="change-pin-modal-title">
    <div class="modal-content glass-surface-1">
      <div class="modal-header">
        <h2 class="modal-title" id="change-pin-modal-title" data-i18n="setPin">Set PIN</h2>
      </div>
      <div class="modal-body">
        <div id="current-pin-row" style="display: none; margin-bottom: 16px;">
          <label for="current-pin-input" style="display: block; margin-bottom: 8px; color: var(--text-secondary);" data-i18n="currentPin">Current PIN</label>
          <input type="tel" inputmode="numeric" pattern="[0-9]*" class="text-input" id="current-pin-input" placeholder="0000" maxlength="4" style="text-align: center; font-size: 1.5rem; letter-spacing: 0.3em; width: 120px;">
          <p class="admin-pin-error" id="current-pin-error" style="display: none; color: var(--error); font-size: 0.875rem; margin-top: 8px;" data-i18n="incorrectPin">Incorrect PIN</p>
        </div>
        <div style="margin-bottom: 16px;">
          <label for="new-pin-input" style="display: block; margin-bottom: 8px; color: var(--text-secondary);" data-i18n="newPin">New PIN (4 digits)</label>
          <input type="tel" inputmode="numeric" pattern="[0-9]*" class="text-input" id="new-pin-input" placeholder="0000" maxlength="4" style="text-align: center; font-size: 1.5rem; letter-spacing: 0.3em; width: 120px;">
        </div>
        <div>
          <label for="confirm-pin-input" style="display: block; margin-bottom: 8px; color: var(--text-secondary);" data-i18n="confirmPin">Confirm PIN</label>
          <input type="tel" inputmode="numeric" pattern="[0-9]*" class="text-input" id="confirm-pin-input" placeholder="0000" maxlength="4" style="text-align: center; font-size: 1.5rem; letter-spacing: 0.3em; width: 120px;">
          <p class="admin-pin-error" id="pin-mismatch-error" style="display: none; color: var(--error); font-size: 0.875rem; margin-top: 8px;" data-i18n="pinMismatch">PINs do not match</p>
          <p class="admin-pin-error" id="pin-format-error" style="display: none; color: var(--error); font-size: 0.875rem; margin-top: 8px;" data-i18n="pinFormatError">PIN must be exactly 4 digits</p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn secondary" data-action="cancel" data-i18n="cancel">Cancel</button>
        <button class="modal-btn primary" id="save-pin-btn" data-i18n="save">Save</button>
      </div>
    </div>
  </div>

  <!-- Delete Race Confirmation Modal -->
  <div class="modal-overlay glass-enable-target" id="delete-race-confirm-modal" role="alertdialog" aria-modal="true" aria-labelledby="delete-race-confirm-modal-title">
    <div class="modal-content glass-surface-1">
      <div class="modal-header">
        <h2 class="modal-title" id="delete-race-confirm-modal-title" data-i18n="confirmDeleteRace">Delete Race</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text" id="delete-race-confirm-text">Are you sure you want to delete this race?</p>
      </div>
      <div class="modal-footer">
        <button class="modal-btn secondary" data-action="cancel" data-i18n="cancel">Cancel</button>
        <button class="modal-btn danger" id="confirm-delete-race-btn" data-i18n="delete">Delete</button>
      </div>
    </div>
  </div>

  <!-- Gate Assignment Modal -->
  <div class="modal-overlay glass-enable-target" id="gate-assignment-modal" role="dialog" aria-modal="true" aria-labelledby="gate-assignment-modal-title">
    <div class="modal-content glass-surface-1">
      <div class="modal-header">
        <h2 class="modal-title" id="gate-assignment-modal-title" data-i18n="gateAssignment">Gate Assignment</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text" data-i18n="gateAssignmentInstructions" style="margin-bottom: 16px;">Enter the gate range you are responsible for:</p>
        <div class="gate-range-inputs">
          <div class="gate-input-group">
            <label for="gate-start-input" data-i18n="gatesFrom">From</label>
            <input type="number" class="text-input gate-input" id="gate-start-input" min="1" max="99" value="1">
          </div>
          <span class="gate-range-separator">‚Äì</span>
          <div class="gate-input-group">
            <label for="gate-end-input" data-i18n="gatesTo">To</label>
            <input type="number" class="text-input gate-input" id="gate-end-input" min="1" max="99" value="10">
          </div>
        </div>
        <!-- First Gate Color Selection -->
        <div class="first-gate-color-section" style="margin-top: 20px;">
          <label data-i18n="firstGateColor" style="display: block; margin-bottom: 8px; font-size: 0.9rem;">Color of first gate</label>
          <div class="gate-color-selector" id="gate-color-selector" role="radiogroup" aria-label="First gate color">
            <button type="button" class="gate-color-btn red active" data-color="red" role="radio" aria-checked="true">
              <span class="gate-color-dot" style="background: #ef4444;"></span>
              <span data-i18n="colorRed">Red</span>
            </button>
            <button type="button" class="gate-color-btn blue" data-color="blue" role="radio" aria-checked="false">
              <span class="gate-color-dot" style="background: #3b82f6;"></span>
              <span data-i18n="colorBlue">Blue</span>
            </button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn secondary" data-action="cancel" data-i18n="cancel">Cancel</button>
        <button class="modal-btn primary" id="save-gate-assignment-btn" data-i18n="save">Save</button>
      </div>
    </div>
  </div>

  <!-- Fault Recording Modal -->
  <div class="modal-overlay glass-enable-target" id="fault-modal" role="dialog" aria-modal="true" aria-labelledby="fault-modal-title">
    <div class="modal-content glass-surface-1 fault-modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="fault-modal-title" data-i18n="recordFault">Record Fault</h2>
      </div>
      <div class="modal-body">
        <!-- Bib Selection -->
        <div class="fault-bib-section">
          <label data-i18n="selectBib">Select Bib</label>
          <div class="fault-bib-selector" id="fault-bib-selector">
            <!-- Populated dynamically with active bibs -->
          </div>
          <div class="manual-bib-row">
            <span data-i18n="orEnterManually">or enter:</span>
            <input type="text" class="text-input" id="fault-bib-input" maxlength="3" inputmode="numeric" pattern="[0-9]*" placeholder="---">
          </div>
        </div>

        <!-- Gate Selection -->
        <div class="fault-gate-section">
          <label data-i18n="selectGate">Gate</label>
          <div class="fault-gate-selector" id="fault-gate-selector">
            <!-- Populated dynamically based on gate assignment -->
          </div>
        </div>

        <!-- Fault Type Selection -->
        <div class="fault-type-section">
          <label data-i18n="faultType">Fault Type</label>
          <div class="fault-type-buttons" id="fault-type-buttons">
            <button class="fault-type-btn" data-fault="MG" aria-pressed="false">
              <span class="fault-type-short" data-i18n="faultMGShort">MG</span>
              <span class="fault-type-label" data-i18n="faultMG">Missed Gate</span>
            </button>
            <button class="fault-type-btn" data-fault="STR" aria-pressed="false">
              <span class="fault-type-short" data-i18n="faultSTRShort">STR</span>
              <span class="fault-type-label" data-i18n="faultSTR">Straddling</span>
            </button>
            <button class="fault-type-btn" data-fault="BR" aria-pressed="false">
              <span class="fault-type-short" data-i18n="faultBRShort">BR</span>
              <span class="fault-type-label" data-i18n="faultBR">Binding Release</span>
            </button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn secondary" data-action="cancel" data-i18n="cancel">Cancel</button>
        <button class="modal-btn primary" id="save-fault-btn" data-i18n="saveFault">Save Fault</button>
      </div>
    </div>
  </div>

  <!-- Fault Edit Modal -->
  <div class="modal-overlay glass-enable-target" id="fault-edit-modal" role="dialog" aria-modal="true" aria-labelledby="fault-edit-modal-title">
    <div class="modal-content glass-surface-1">
      <div class="modal-header">
        <h2 class="modal-title" id="fault-edit-modal-title" data-i18n="editFault">Edit Fault</h2>
      </div>
      <div class="modal-body">
        <!-- Bib Input -->
        <div style="margin-bottom: 16px;">
          <label for="fault-edit-bib-input" style="display: block; margin-bottom: 8px; color: var(--text-secondary);" data-i18n="bib">Bib</label>
          <input type="text" class="text-input" id="fault-edit-bib-input" maxlength="3" inputmode="numeric" pattern="[0-9]*">
        </div>
        <!-- Gate Input -->
        <div style="margin-bottom: 16px;">
          <label for="fault-edit-gate-input" style="display: block; margin-bottom: 8px; color: var(--text-secondary);" data-i18n="gate">Gate</label>
          <input type="number" class="text-input" id="fault-edit-gate-input" min="1" max="99" style="width: 80px;">
          <span class="fault-edit-gate-range" id="fault-edit-gate-range" style="font-size: 0.75rem; color: var(--text-tertiary); margin-left: 8px;"></span>
        </div>
        <!-- Fault Type -->
        <div style="margin-bottom: 16px;">
          <label for="fault-edit-type-select" style="display: block; margin-bottom: 8px; color: var(--text-secondary);" data-i18n="faultType">Fault Type</label>
          <select class="filter-select" id="fault-edit-type-select" style="width: 100%;">
            <option value="MG" data-i18n="faultMG">Missed Gate</option>
            <option value="STR" data-i18n="faultSTR">Straddling</option>
            <option value="BR" data-i18n="faultBR">Binding Release</option>
          </select>
        </div>
        <!-- Run Selector -->
        <div style="margin-bottom: 16px;">
          <label id="fault-edit-run-label" style="display: block; margin-bottom: 8px; color: var(--text-secondary);" data-i18n="run">Run</label>
          <div class="edit-run-selector" id="fault-edit-run-selector" role="radiogroup" aria-labelledby="fault-edit-run-label">
            <button class="edit-run-btn active" data-run="1" type="button">1</button>
            <button class="edit-run-btn" data-run="2" type="button">2</button>
          </div>
        </div>
        <!-- Notes -->
        <div class="fault-edit-notes-section" style="margin-bottom: 16px;">
          <label for="fault-edit-notes" style="display: block; margin-bottom: 8px; color: var(--text-secondary);" data-i18n="faultNotes">Notes</label>
          <div class="fault-edit-notes-row">
            <textarea class="text-input fault-edit-notes" id="fault-edit-notes" maxlength="500" rows="2" data-i18n-placeholder="typeNote" placeholder="Type or speak your note..." aria-label="Note text"></textarea>
            <button class="fault-edit-mic-btn" id="fault-edit-mic-btn" type="button" aria-label="Record voice note" aria-pressed="false">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                <line x1="12" y1="19" x2="12" y2="23"/>
                <line x1="8" y1="23" x2="16" y2="23"/>
              </svg>
            </button>
          </div>
          <div class="fault-edit-notes-footer">
            <span class="fault-edit-notes-char-count" id="fault-edit-notes-char-count">0/500</span>
          </div>
        </div>
        <!-- Version History -->
        <div class="fault-version-history" style="margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--surface-elevated);">
          <label for="fault-version-select" style="display: block; margin-bottom: 8px; color: var(--text-secondary);" data-i18n="versionHistory">Version History</label>
          <select class="filter-select" id="fault-version-select" style="width: 100%;">
            <!-- Populated dynamically -->
          </select>
          <button class="modal-btn secondary" id="restore-version-btn" style="margin-top: 8px; width: 100%;" data-i18n="restoreVersion">Restore Selected Version</button>
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn secondary" data-action="cancel" data-i18n="cancel">Cancel</button>
        <button class="modal-btn primary" id="save-fault-edit-btn" data-i18n="save">Save</button>
      </div>
    </div>
  </div>

  <!-- Mark Fault for Deletion Modal -->
  <div class="modal-overlay glass-enable-target" id="mark-deletion-modal" role="dialog" aria-modal="true" aria-labelledby="mark-deletion-modal-title">
    <div class="modal-content glass-surface-1">
      <div class="modal-header">
        <h2 class="modal-title" id="mark-deletion-modal-title" data-i18n="markForDeletion">Mark for Deletion</h2>
      </div>
      <div class="modal-body">
        <p class="modal-text" data-i18n="markForDeletionText">This fault will be marked for deletion and requires Chief Judge approval to permanently delete.</p>
        <div class="mark-deletion-details" id="mark-deletion-details" style="margin-top: 12px; padding: 12px; background: var(--surface-elevated); border-radius: var(--radius); font-family: 'JetBrains Mono', monospace;">
          <!-- Populated dynamically -->
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn secondary" data-action="cancel" data-i18n="cancel">Cancel</button>
        <button class="modal-btn danger" id="confirm-mark-deletion-btn" data-i18n="markForDeletion">Mark for Deletion</button>
      </div>
    </div>
  </div>

  <!-- Fault Confirmation Overlay -->
  <div class="fault-confirmation-overlay" id="fault-confirmation-overlay" role="alertdialog" aria-modal="true" aria-hidden="true" aria-labelledby="fault-confirmation-title">
    <div class="fault-confirmation-content">
      <div class="fault-confirmation-icon" aria-hidden="true">‚úì</div>
      <div class="fault-confirmation-bib" id="fault-confirmation-title">---</div>
      <div class="fault-confirmation-gate">Gate --</div>
      <div class="fault-confirmation-type">--</div>
      <div class="fault-confirmation-actions">
        <button class="fault-confirmation-btn note" id="fault-confirmation-add-note-btn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
            <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
            <line x1="12" y1="19" x2="12" y2="23"/>
            <line x1="8" y1="23" x2="16" y2="23"/>
          </svg>
          <span data-i18n="addNote">Add Note</span>
        </button>
        <button class="fault-confirmation-btn done" id="fault-confirmation-done-btn" data-i18n="done">Done</button>
      </div>
    </div>
  </div>

  <!-- Voice Note Modal -->
  <div class="modal-overlay glass-enable-target" id="voice-note-modal" role="dialog" aria-modal="true" aria-labelledby="voice-note-modal-title">
    <div class="modal-content glass-surface-1 voice-note-modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="voice-note-modal-title" data-i18n="recordNote">Record Note</h2>
        <button class="modal-close-btn" id="voice-note-close-btn" aria-label="Close" data-i18n-aria-label="close">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <!-- Listening Indicator -->
        <div class="voice-note-listening-indicator" id="voice-note-listening-indicator" aria-live="polite">
          <div class="voice-note-pulse-ring"></div>
          <div class="voice-note-mic-icon">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
              <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
              <line x1="12" y1="19" x2="12" y2="23"/>
              <line x1="8" y1="23" x2="16" y2="23"/>
            </svg>
          </div>
          <span class="voice-note-status-text" data-i18n="listening">Listening...</span>
        </div>

        <!-- Note Textarea -->
        <div class="voice-note-input-section">
          <textarea
            class="voice-note-textarea"
            id="voice-note-textarea"
            maxlength="500"
            rows="4"
            data-i18n-placeholder="typeNote"
            placeholder="Type or speak your note..."
            aria-label="Note text"
            data-i18n-aria-label="noteTextLabel"
          ></textarea>
          <div class="voice-note-input-footer">
            <span class="voice-note-char-count" id="voice-note-char-count">0/500</span>
            <button class="voice-note-mic-btn" id="voice-note-mic-btn" type="button" aria-label="Record voice note" aria-pressed="false" data-i18n-aria-label="recordVoiceNoteLabel">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                <line x1="12" y1="19" x2="12" y2="23"/>
                <line x1="8" y1="23" x2="16" y2="23"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn secondary" id="voice-note-cancel-btn" data-i18n="cancel">Cancel</button>
        <button class="modal-btn primary" id="voice-note-save-btn" data-i18n="save">Save</button>
      </div>
    </div>
  </div>

  <!-- Keyboard Shortcuts Modal -->
  <div class="modal-overlay glass-enable-target" id="keyboard-shortcuts-modal" role="dialog" aria-modal="true" aria-labelledby="keyboard-shortcuts-modal-title">
    <div class="modal-content glass-surface-1 shortcuts-modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="keyboard-shortcuts-modal-title" data-i18n="keyboardShortcuts">Keyboard Shortcuts</h2>
        <button class="modal-close-btn" id="shortcuts-close-btn" aria-label="Close" data-i18n-aria-label="close">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <div class="modal-body shortcuts-body">
        <!-- Timer Section -->
        <div class="shortcuts-section">
          <h3 class="shortcuts-section-title" data-i18n="shortcutSection_timer">Timer</h3>
          <dl class="shortcuts-list">
            <div class="shortcut-row"><dt><kbd>0</kbd>-<kbd>9</kbd></dt><dd data-i18n="shortcut_enterDigit">Enter bib digit</dd></div>
            <div class="shortcut-row"><dt><kbd>S</kbd></dt><dd data-i18n="shortcut_selectStart">Select Start</dd></div>
            <div class="shortcut-row"><dt><kbd>F</kbd></dt><dd data-i18n="shortcut_selectFinish">Select Finish</dd></div>
            <div class="shortcut-row"><dt><kbd>Alt</kbd>+<kbd>1</kbd></dt><dd data-i18n="shortcut_selectRun1">Select Run 1</dd></div>
            <div class="shortcut-row"><dt><kbd>Alt</kbd>+<kbd>2</kbd></dt><dd data-i18n="shortcut_selectRun2">Select Run 2</dd></div>
            <div class="shortcut-row"><dt><kbd>Space</kbd> / <kbd>Enter</kbd></dt><dd data-i18n="shortcut_recordTime">Record timestamp</dd></div>
            <div class="shortcut-row"><dt><kbd>Esc</kbd> / <kbd>Del</kbd></dt><dd data-i18n="shortcut_clearBib">Clear bib</dd></div>
            <div class="shortcut-row"><dt><kbd>Backspace</kbd></dt><dd data-i18n="shortcut_deleteLastDigit">Delete last digit</dd></div>
          </dl>
        </div>
        <!-- Gate Judge Section -->
        <div class="shortcuts-section">
          <h3 class="shortcuts-section-title" data-i18n="shortcutSection_gateJudge">Gate Judge</h3>
          <dl class="shortcuts-list">
            <div class="shortcut-row"><dt><kbd>M</kbd> / <kbd>G</kbd></dt><dd data-i18n="shortcut_missedGate">Missed Gate</dd></div>
            <div class="shortcut-row"><dt><kbd>T</kbd></dt><dd data-i18n="shortcut_straddled">Straddled</dd></div>
            <div class="shortcut-row"><dt><kbd>B</kbd> / <kbd>R</kbd></dt><dd data-i18n="shortcut_broken">Broken gate</dd></div>
            <div class="shortcut-row"><dt><kbd>1</kbd>-<kbd>0</kbd></dt><dd data-i18n="shortcut_selectGate">Select gate</dd></div>
            <div class="shortcut-row"><dt><kbd>&larr;</kbd><kbd>&rarr;</kbd></dt><dd data-i18n="shortcut_navigateBtns">Navigate buttons</dd></div>
            <div class="shortcut-row"><dt><kbd>Space</kbd> / <kbd>Enter</kbd></dt><dd data-i18n="shortcut_confirmSelection">Confirm selection</dd></div>
          </dl>
        </div>
        <!-- Results Section -->
        <div class="shortcuts-section">
          <h3 class="shortcuts-section-title" data-i18n="shortcutSection_results">Results</h3>
          <dl class="shortcuts-list">
            <div class="shortcut-row"><dt><kbd>&uarr;</kbd><kbd>&darr;</kbd></dt><dd data-i18n="shortcut_navigateItems">Navigate items</dd></div>
            <div class="shortcut-row"><dt><kbd>Enter</kbd> / <kbd>E</kbd></dt><dd data-i18n="shortcut_editItem">Edit item</dd></div>
            <div class="shortcut-row"><dt><kbd>Del</kbd> / <kbd>D</kbd></dt><dd data-i18n="shortcut_deleteItem">Delete item</dd></div>
          </dl>
        </div>
        <!-- Global Section -->
        <div class="shortcuts-section">
          <h3 class="shortcuts-section-title" data-i18n="shortcutSection_global">Global</h3>
          <dl class="shortcuts-list">
            <div class="shortcut-row"><dt><kbd>Tab</kbd></dt><dd data-i18n="shortcut_moveTab">Move between tabs</dd></div>
            <div class="shortcut-row"><dt><kbd>Esc</kbd></dt><dd data-i18n="shortcut_closeModal">Close modal</dd></div>
            <div class="shortcut-row"><dt><kbd>&larr;</kbd><kbd>&rarr;</kbd></dt><dd data-i18n="shortcut_navigateInComponent">Navigate in component</dd></div>
            <div class="shortcut-row"><dt><kbd>?</kbd></dt><dd data-i18n="shortcut_showShortcuts">Show shortcuts</dd></div>
          </dl>
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn primary" id="shortcuts-done-btn" data-i18n="done">Done</button>
      </div>
    </div>
  </div>

  <!-- Onboarding Modal (Full-screen setup wizard) -->
  <div class="modal-overlay onboarding-fullscreen" id="onboarding-modal" role="dialog" aria-modal="true" aria-label="Setup wizard">
    <div class="onboarding-container">
      <button class="onboarding-skip-btn" data-action="dismiss" aria-label="Skip setup" data-i18n="skipSetup">Skip</button>
      <div class="onboarding-progress" id="onboarding-progress">
        <span class="progress-dot active"></span>
        <span class="progress-dot"></span>
        <span class="progress-dot"></span>
        <span class="progress-dot"></span>
        <span class="progress-dot"></span>
        <span class="progress-dot"></span>
      </div>
      <div class="onboarding-progress-label" id="onboarding-progress-label" aria-live="polite"></div>

      <div class="onboarding-cards">
        <!-- Card 1: Welcome + Language -->
        <div class="onboarding-card" data-step="1">
          <div class="onboarding-icon"><svg aria-hidden="true" width="48" height="48" viewBox="0 0 64 64" fill="none"><circle cx="32" cy="34" r="24" stroke="#00d4ff" stroke-width="6"/><line x1="32" y1="34" x2="32" y2="18" stroke="#00d4ff" stroke-width="3.5" stroke-linecap="round"/><circle cx="32" cy="34" r="5" fill="#00d4ff"/><line x1="32" y1="10" x2="32" y2="4" stroke="#ffd700" stroke-width="2.5" stroke-linecap="round"/><line x1="26" y1="5" x2="38" y2="5" stroke="#ffd700" stroke-width="2.5" stroke-linecap="round"/></svg></div>
          <h2 data-i18n="onboardingWelcome">Welcome to CHRONO</h2>
          <p data-i18n="onboardingWelcomeDesc">GPS-synchronized timing for ski races</p>
          <div class="onboarding-lang-select">
            <button class="lang-btn" data-lang="de">Deutsch</button>
            <button class="lang-btn" data-lang="fr">Fran√ßais</button>
            <button class="lang-btn" data-lang="en">English</button>
          </div>
          <button class="onboarding-btn primary" data-action="next" data-i18n="getStarted">Get Started</button>
        </div>

        <!-- Card 2: Role Selection (NEW) -->
        <div class="onboarding-card" data-step="2" style="display:none">
          <h2 data-i18n="onboardingRole">What's Your Role?</h2>
          <p data-i18n="onboardingRoleDesc">Choose how you'll be helping at the race</p>
          <div class="onboarding-role-select" role="radiogroup" aria-label="Role selection">
            <button class="role-card selected" data-role="timer" id="onboarding-role-timer" role="radio" aria-checked="true">
              <div class="role-card-icon" aria-hidden="true"><svg aria-hidden="true" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="13" r="8"/><path d="M12 9v4l2 2"/><path d="M12 5V3"/><path d="M10 3h4"/></svg></div>
              <div class="role-card-content">
                <span class="role-card-title" data-i18n="roleTimerTitle">Timer</span>
                <span class="role-card-desc" data-i18n="roleTimerDesc">Record start and finish times</span>
              </div>
              <div class="role-card-check" aria-hidden="true"><svg aria-hidden="true" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 6L9 17l-5-5"/></svg></div>
            </button>
            <button class="role-card" data-role="gateJudge" id="onboarding-role-judge" role="radio" aria-checked="false">
              <div class="role-card-icon" aria-hidden="true"><svg aria-hidden="true" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/></svg></div>
              <div class="role-card-content">
                <span class="role-card-title" data-i18n="roleJudgeTitle">Gate Judge</span>
                <span class="role-card-desc" data-i18n="roleJudgeDesc">Record gate faults (Torrichter)</span>
              </div>
              <div class="role-card-check" aria-hidden="true"><svg aria-hidden="true" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 6L9 17l-5-5"/></svg></div>
            </button>
          </div>
          <div class="onboarding-btn-row">
            <button class="onboarding-btn secondary" data-action="back" data-i18n="back">Back</button>
            <button class="onboarding-btn primary" data-action="next" data-i18n="continue">Continue</button>
          </div>
        </div>

        <!-- Card 3: Device Name -->
        <div class="onboarding-card" data-step="3" style="display:none">
          <h2 data-i18n="onboardingDeviceName" id="onboarding-device-name-title">Name Your Timer</h2>
          <p data-i18n="onboardingDeviceNameDesc" id="onboarding-device-name-desc">This identifies your device when syncing</p>
          <div class="onboarding-input-row">
            <input type="text" class="text-input" id="onboarding-device-name" maxlength="30" aria-label="Device name">
            <button class="onboarding-regenerate-btn" id="onboarding-regenerate-name" type="button" aria-label="Generate new name">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <path d="M23 4v6h-6M1 20v-6h6"/>
                <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
              </svg>
            </button>
          </div>
          <div class="onboarding-btn-row">
            <button class="onboarding-btn secondary" data-action="back" data-i18n="back">Back</button>
            <button class="onboarding-btn primary" data-action="next" data-i18n="continue">Continue</button>
          </div>
        </div>

        <!-- Card 4a: Photo Capture (Timer path only) -->
        <div class="onboarding-card" data-step="4" data-path="timer" style="display:none">
          <div class="onboarding-icon"><svg aria-hidden="true" width="32" height="32" viewBox="0 0 24 24" fill="currentColor"><path d="M12 15.2a3.2 3.2 0 100-6.4 3.2 3.2 0 000 6.4z"/><path d="M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/></svg></div>
          <h2 data-i18n="onboardingPhoto">Photo Documentation</h2>
          <p data-i18n="onboardingPhotoDesc">Automatically capture a photo when recording each timestamp. Useful for verifying bib numbers and resolving disputes.</p>
          <label class="onboarding-toggle-row">
            <span data-i18n="enablePhotoCapture">Enable Photo Capture</span>
            <label class="toggle-switch">
              <input type="checkbox" id="onboarding-photo-toggle">
              <span class="toggle-slider"></span>
            </label>
          </label>
          <div class="onboarding-btn-row">
            <button class="onboarding-btn secondary" data-action="back" data-i18n="back">Back</button>
            <button class="onboarding-btn primary" data-action="next" data-i18n="continue">Continue</button>
          </div>
        </div>

        <!-- Card 4b: Gate Assignment (Gate Judge path only) -->
        <div class="onboarding-card" data-step="4" data-path="gateJudge" style="display:none">
          <div class="onboarding-icon"><svg aria-hidden="true" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/></svg></div>
          <h2 data-i18n="onboardingGates">Your Gate Assignment</h2>
          <p data-i18n="onboardingGatesDesc">Enter the gate numbers you'll be watching. You can change this later.</p>
          <div class="onboarding-gate-inputs">
            <div class="gate-input-group">
              <label for="onboarding-gate-start" data-i18n="gatesFrom">From</label>
              <input type="number" class="text-input gate-input" id="onboarding-gate-start" min="1" max="99" value="1">
            </div>
            <span class="gate-range-separator">‚Äì</span>
            <div class="gate-input-group">
              <label for="onboarding-gate-end" data-i18n="gatesTo">To</label>
              <input type="number" class="text-input gate-input" id="onboarding-gate-end" min="1" max="99" value="10">
            </div>
          </div>
          <div class="onboarding-btn-row">
            <button class="onboarding-btn secondary" data-action="back" data-i18n="back">Back</button>
            <button class="onboarding-btn primary" data-action="next" data-i18n="continue">Continue</button>
          </div>
        </div>

        <!-- Card 5: Race Setup -->
        <div class="onboarding-card" data-step="5" style="display:none">
          <h2 data-i18n="onboardingRaceSetup">Join a Race</h2>
          <p data-i18n="onboardingRaceSetupDesc">Enter a race ID to sync with other timers</p>
          <div class="race-id-input-row">
            <input type="text" class="text-input" id="onboarding-race-id" placeholder="e.g. RACE-2024" aria-label="Race ID">
            <button class="recent-races-btn" id="onboarding-recent-races-btn" type="button" aria-label="Recent races" aria-expanded="false" aria-haspopup="listbox">
              <svg aria-hidden="true" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
              </svg>
            </button>
            <div class="recent-races-dropdown" id="onboarding-recent-races-dropdown" style="display:none"></div>
          </div>
          <div class="race-status" id="onboarding-race-status"></div>
          <input type="password" class="text-input" id="onboarding-pin" placeholder="PIN (4 digits)" maxlength="4" inputmode="numeric" style="display:none" aria-label="PIN">
          <label class="onboarding-toggle-row">
            <span data-i18n="enableSync">Enable Cloud Sync</span>
            <label class="toggle-switch">
              <input type="checkbox" id="onboarding-sync-toggle" checked>
              <span class="toggle-slider"></span>
            </label>
          </label>
          <div class="onboarding-btn-row">
            <button class="onboarding-btn secondary" data-action="back" data-i18n="back">Back</button>
            <button class="onboarding-btn primary" data-action="next" data-i18n="continue">Continue</button>
          </div>
          <button class="onboarding-btn text" data-action="skip" data-i18n="skipForNow">Skip for now</button>
        </div>

        <!-- Card 6: Ready -->
        <div class="onboarding-card" data-step="6" style="display:none">
          <div class="onboarding-icon success"><svg aria-hidden="true" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 6L9 17l-5-5"/></svg></div>
          <h2 data-i18n="onboardingReady" id="onboarding-ready-title">Ready to Time!</h2>
          <div class="onboarding-summary" id="onboarding-summary"></div>
          <p class="onboarding-tip" data-i18n="onboardingTip" id="onboarding-ready-tip">Tap the big red button to record timestamps</p>
          <button class="onboarding-btn primary" data-action="finish" data-i18n="startTiming" id="onboarding-finish-btn">Start Timing</button>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="/src/main.ts"></script>
</body>
</html>
